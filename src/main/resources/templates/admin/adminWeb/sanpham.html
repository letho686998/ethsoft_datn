<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{admin/layout/Layout}">

<head>
    <title layout:title="Qu·∫£n l√Ω s·∫£n ph·∫©m"></title>

    <style>
        html,
        body {
            height: 100%;
            background-color: #f4f6f9;
            overflow: hidden;
        }

        /* 1Ô∏è‚É£ KHU V·ª∞C T·ªîNG TH·ªÇ */
        .page-content-section {
            height: calc(100vh - 40px);
            box-sizing: border-box;
        }

        .card {
            display: flex;
            flex-direction: column;
            height: 100%;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
            background: #fff;
        }

        .card-body {
            flex: 1;
            padding: 8px 15px 10px 15px !important;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            overflow: visible !important;
            /* Cho ph√©p pagination hi·ªÉn th·ªã */
        }

        /* 2Ô∏è‚É£ FORM CHUNG TR√äN TRANG */
        .form-row .form-control {
            height: 34px;
            font-size: 0.9rem;
        }

        /* 3Ô∏è‚É£ DROPDOWN (D√ôNG CHUNG C·∫¢ TRANG & POPUP) */
        .dropdown-input {
            cursor: pointer;
            background-color: #fff;
            transition: all 0.2s ease;
        }

        /* ‚úÖ H·ª¢P NH·∫§T TO√ÄN B·ªò .dropdown-list */
        .dropdown-list {
            display: none;
            position: absolute;
            top: 36px;
            left: 0;
            width: 100%;
            background: #fff;
            border: 1px solid #ced4da;
            border-radius: 6px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            max-height: 180px;
            overflow-y: auto;
            z-index: 3000;
            /* ƒë·∫£m b·∫£o n·ªïi tr√™n c√°c n√∫t */
            padding: 4px 0;
            opacity: 0;
            transform: translateY(-5px);
            transition: all 0.2s ease-in-out;
        }

        /* ‚ö° H·ª¢P NH·∫§T .dropdown-list.show */
        .dropdown-list.show {
            display: block !important;
            opacity: 1;
            transform: translateY(0);
        }

        /* ‚úÖ H·ª¢P NH·∫§T .dropdown-item */
        .dropdown-item {
            padding: 6px 12px;
            font-size: 0.9rem;
            cursor: pointer;
            color: #212529;
            transition: background 0.2s, color 0.2s;
        }

        .dropdown-item:hover {
            background: #e7f1ff;
            color: #0d6efd;
        }

        /* üéØ Style ri√™ng cho dropdown ‚ÄúS·∫Øp x·∫øp theo‚Äù */
        #sortInput {
            min-width: 200px;
            height: 34px;
            padding: 4px 32px 4px 12px;
            /* t·∫°o kh√¥ng gian cho icon m≈©i t√™n */
            font-size: 0.9rem;
            font-weight: 500;
            color: #001f3f;
            /* xanh ƒë·∫≠m ƒë·ªìng b·ªô header */
            background: #fff;
            border: 1.5px solid #d0d7de;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            appearance: none;
            /* ·∫©n m≈©i t√™n m·∫∑c ƒë·ªãnh */
            background-image: linear-gradient(45deg, transparent 50%, #007bff 50%),
                linear-gradient(135deg, #007bff 50%, transparent 50%);
            background-position: calc(100% - 18px) 13px, calc(100% - 13px) 13px;
            background-size: 6px 6px, 6px 6px;
            background-repeat: no-repeat;
            transition: all 0.25s ease;
        }

        /* üü¶ Hover: s√°ng nh·∫π vi·ªÅn + ƒë·ªï b√≥ng */
        #sortInput:hover {
            border-color: #007bff;
            box-shadow: 0 0 6px rgba(0, 123, 255, 0.15);
        }

        /* üü© Focus: vi·ªÅn ƒë·∫≠m v√† b√≥ng m·ªù */
        #sortInput:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 6px rgba(0, 123, 255, 0.25);
        }

        /* üü¶ D√£n kho·∫£ng c√°ch gi·ªØa "S·∫Øp x·∫øp theo" v√† n√∫t Th√™m m·ªõi */
        .toolbar-sort-add {
            gap: 18px !important;         /* tƒÉng kho·∫£ng c√°ch gi·ªØa 2 ph·∫ßn */
            margin-bottom: 6px;           /* t·∫°o kho·∫£ng d∆∞·ªõi thanh */
        }

        @media (max-width: 768px) {
            .toolbar-sort-add {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
        }


        /* 4Ô∏è‚É£ B·∫¢NG S·∫¢N PH·∫®M */
        .table-container {
            background: #fff;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            margin-top: 2px;
            position: relative;
            top: -6px;
            transition: opacity 0.25s ease-in-out;
        }

        .table thead th {
            background: #f8f9fa;
            position: sticky;
            top: 0;
            font-weight: 600;
            text-align: center;
        }

        .table td {
            text-align: center;
            vertical-align: middle !important;
            font-size: 0.9rem;
        }

        .table tr.selected {
            background-color: #d0ebff !important;
            transition: background-color 0.25s ease-in-out;
        }

        /* 5Ô∏è‚É£ PH√ÇN TRANG + N√öT CHUNG */
        .pagination {
            margin: 8px 0 4px !important;
            position: relative;
            z-index: 2;
        }

        #btn-toggle-view {
            float: right;
            border-radius: 20px;
            transition: all 0.25s ease;
        }

        #btn-toggle-view:hover {
            background: linear-gradient(135deg, #14F5F1, #007bff);
            color: #fff !important;
            transform: scale(1.05);
        }

        #btn-open-add-modal {
            border-radius: 20px;
            transition: all 0.25s ease;
        }

        #btn-open-add-modal:hover {
            transform: scale(1.05);
        }

        /* 6Ô∏è‚É£ T√åM KI·∫æM */
        #search-input {
            max-width: 300px;
            border-radius: 20px;
            transition: all 0.3s ease;
            padding-left: 14px;
        }

        /* 7Ô∏è‚É£ HI·ªÜU ·ª®NG SHIMMER KHI LOADING */
        .shimmer {
            position: relative;
            overflow: hidden;
            background: linear-gradient(to right, #f6f7f8 0%, #edeef1 20%, #f6f7f8 40%, #f6f7f8 100%);
            background-repeat: no-repeat;
            background-size: 800px 100%;
            animation: shimmer 1.2s linear infinite forwards;
        }

        @keyframes shimmer {
            0% {
                background-position: -800px 0;
            }

            100% {
                background-position: 800px 0;
            }
        }

        .skeleton-row {
            height: 36px;
        }

        .skeleton-cell {
            height: 14px;
            width: 80%;
            border-radius: 6px;
            margin: 6px auto;
        }

        /* 8Ô∏è‚É£ RESPONSIVE */
        @media (max-width: 1200px) {

            .form-row .col-md-2,
            .form-row .col-md-3 {
                flex: 0 0 50%;
                max-width: 50%;
                margin-bottom: 8px;
            }

            #search-input {
                width: 100%;
                margin-top: 6px;
            }
        }

        @media (max-width: 992px) {
            .form-row {
                display: flex;
                flex-wrap: wrap;
            }

            .form-row .col-md-2,
            .form-row .col-md-3,
            .form-row .col-md-1 {
                flex: 0 0 100%;
                max-width: 100%;
                margin-bottom: 10px;
            }


            .card-header h5 {
                font-size: 1rem;
            }

            #btn-toggle-view {
                font-size: 0.85rem;
                padding: 4px 8px;
            }
        }

        @media (max-width: 768px) {
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .table {
                min-width: 800px;
            }

            .pagination {
                flex-wrap: wrap;
            }

            .pagination .page-item {
                margin: 2px 3px;
            }

            .page-content-section {
                padding: 8px;
            }
        }

        @media (max-width: 576px) {
            .card-header {
                flex-direction: column;
                align-items: flex-start !important;
            }

            #btn-toggle-view {
                margin-top: 8px;
                width: 100%;
            }

            .table td,
            .table th {
                font-size: 0.8rem;
                padding: 4px;
            }

            .btn-sm {
                padding: 3px 6px;
                font-size: 0.8rem;
            }

            #search-input {
                width: 100%;
            }
        }

        /* 9Ô∏è‚É£ POPUP (MODAL) */
        /* 9Ô∏è‚É£ POPUP (MODAL) */
        .modal-dialog.modal-lg {
            max-width: 720px; /* ‚úÖ nh·ªè g·ªçn ~45% m√†n h√¨nh, theo t·ªâ l·ªá v√†ng 1 : 1.618 */
            margin: 2.5rem auto; /* canh gi·ªØa ƒë·∫πp h∆°n */
        }

        .modal-content {
            min-height: 56vh; /* ‚úÖ gi·∫£m nh·∫π chi·ªÅu cao ƒë·ªÉ c√¢n ƒë·ªëi */
            max-height: 80vh; /* tr√°nh tr√†n m√†n h√¨nh nh·ªè */
            border-radius: 14px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header & body c√¢n ƒë·ªëi theo t·ªâ l·ªá v√†ng */
        .modal-header {
            flex: 0 0 auto;
            background: linear-gradient(135deg, #007bff, #004f9e);
            color: #fff;
            padding: 10px 20px;
            border: none;
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 22px 28px;
            background-color: #fafbfc;
        }

        .modal-footer {
            flex: 0 0 auto;
            background: #f8f9fa;
            padding: 10px 20px;
            border-top: 1px solid #dee2e6;
        }


        /* üåü B·ªë c·ª•c form trong popup */
        #productModal .row.g-3 {
            row-gap: 12px !important;
        }

        #productModal .form-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        #productModal .form-control,
        #productModal .dropdown-input {
            height: 38px;
            border-radius: 8px;
            border: 1px solid #d5d9e0;
            transition: all 0.2s ease;
        }

        #productModal .form-control:hover,
        #productModal .dropdown-input:hover {
            background-color: #f8faff;
        }

        #productModal .form-control:focus {
            border-color: #1e90ff;
            box-shadow: 0 0 0 3px rgba(30, 144, 255, 0.15);
        }

        /* üü¢ N√∫t l∆∞u trong popup */
        #btn-save-product {
            padding: 6px 14px;
            border-radius: 8px;
            font-weight: 600;
            background: linear-gradient(135deg, #28a745, #20c997);
            border: none;
            transition: all 0.25s ease;
        }

        #btn-save-product:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.25);
        }

        /* üîµ Badge tr·∫°ng th√°i */
        .badge {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
        }

        .bg-success-subtle {
            background-color: #e6f9ed !important;
        }

        .bg-danger-subtle {
            background-color: #fdeaea !important;
        }


        /* üëÜ ƒê·ªìng b·ªô n√∫t l∆∞u */
        #btn-save-product {
            min-width: 130px;
            text-align: center;
        }

        /* üåà Thanh cu·ªôn phong c√°ch iOS */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.18);
            border-radius: 50px;
            backdrop-filter: blur(4px);
            transition: background-color 0.25s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: rgba(0, 0, 0, 0.35);
        }

        /* ü™Ñ C·∫£i thi·ªán c·∫£m gi√°c cu·ªôn cho modal & b·∫£ng */
        .modal-body,
        .table-container,
        .dropdown-list {
            -webkit-overflow-scrolling: touch; /* iOS-like momentum scroll */
            scroll-behavior: smooth;
        }

    </style>




</head>

<body>
    <section layout:fragment="content" class="page-content-section container-fluid">
        <div class="card shadow-sm border-0">
            <div class="card-header text-white py-2 d-flex justify-content-between align-items-center"
                style="background: linear-gradient(135deg, #007bff, #14F5F1)">
                <h5 class="mb-0"><i class="fas fa-box"></i> Qu·∫£n l√Ω s·∫£n ph·∫©m</h5>
            </div>

            <div class="card-body">
                <!-- üîç √î t√¨m ki·∫øm + n√∫t chuy·ªÉn ƒë·ªïi + s·∫Øp x·∫øp -->
                <div class="d-flex align-items-center justify-content-between mb-2 flex-wrap gap-2">
                    <!-- üîç √î t√¨m ki·∫øm b√™n tr√°i -->
                    <input type="text" id="search-input" class="form-control form-control-sm"
                        placeholder="üîç T√¨m ki·∫øm s·∫£n ph·∫©m... (T√™n, M√£, Danh m·ª•c, Th∆∞∆°ng hi·ªáu)"
                        style="max-width: 300px;">

                    <!-- üîÅ N√∫t xem s·∫£n ph·∫©m ·ªü gi·ªØa -->
                    <button id="btn-toggle-view" class="btn btn-outline-primary btn-sm fw-semibold px-3 py-1 shadow-sm">
                        <i class="fas fa-layer-group me-1"></i>
                        <span>Hi·ªÉn th·ªã: T·∫•t c·∫£ s·∫£n ph·∫©m</span>
                    </button>

                    <!-- üîΩ Dropdown s·∫Øp x·∫øp + ‚ûï N√∫t th√™m -->
                    <div class="d-flex align-items-center toolbar-sort-add">
                        <div class="position-relative" style="width: 200px;">
                            <input type="text" id="sortInput" class="form-control dropdown-input"
                                placeholder="S·∫Øp x·∫øp theo..." readonly>
                            <div class="dropdown-list" id="sortList">
                                <div class="dropdown-item" data-sort="newest">Ng√†y t·∫°o (m·ªõi nh·∫•t)</div>
                                <div class="dropdown-item" data-sort="oldest">Ng√†y t·∫°o (c≈© nh·∫•t)</div>
                                <div class="dropdown-item" data-sort="code-asc">M√£ s·∫£n ph·∫©m (A ‚Üí Z)</div>
                                <div class="dropdown-item" data-sort="code-desc">M√£ s·∫£n ph·∫©m (Z ‚Üí A)</div>
                                <div class="dropdown-item" data-sort="name-asc">T√™n s·∫£n ph·∫©m (A ‚Üí Z)</div>
                                <div class="dropdown-item" data-sort="name-desc">T√™n s·∫£n ph·∫©m (Z ‚Üí A)</div>
                                <div class="dropdown-item" data-sort="qty-desc">S·ªë l∆∞·ª£ng t·ªìn (cao ‚Üí th·∫•p)</div>
                                <div class="dropdown-item" data-sort="qty-asc">S·ªë l∆∞·ª£ng t·ªìn (th·∫•p ‚Üí cao)</div>
                            </div>
                        </div>

                        <button type="button" class="btn btn-primary btn-sm fw-semibold px-3 py-1 shadow-sm"
                            id="btn-open-add-modal">
                            <i class="fas fa-plus"></i> Th√™m m·ªõi
                        </button>
                    </div>
                </div>


                <!-- üü¢ B·∫¢NG S·∫¢N PH·∫®M -->
                <!-- üåç B·∫¢NG T·∫§T C·∫¢ S·∫¢N PH·∫®M -->
                <div id="all-container" style="display:block;">
                    <div class="table-container" id="all-table-wrap">
                        <table class="table table-hover table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>M√£ SP</th>
                                    <th>T√™n s·∫£n ph·∫©m</th>
                                    <th>S·ªë l∆∞·ª£ng t·ªìn</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>Ng√†y t·∫°o</th>
                                    <th>Thao t√°c</th>
                                </tr>
                            </thead>
                            <tbody id="table-all"></tbody>
                        </table>
                    </div>
                    <ul class="pagination justify-content-center" id="pagination-all"></ul>
                </div>

                <div id="active-container" style="display:none;">
                    <div class="table-container" id="active-table-wrap">
                        <table class="table table-hover table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>M√£ SP</th>
                                    <th>T√™n s·∫£n ph·∫©m</th>
                                    <th>S·ªë l∆∞·ª£ng t·ªìn</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>Ng√†y t·∫°o</th>
                                    <th>Thao t√°c</th>
                                </tr>
                            </thead>
                            <tbody id="table-active"></tbody>
                        </table>
                    </div>
                    <ul class="pagination justify-content-center" id="pagination-active"></ul>
                </div>

                <!-- üî¥ B·∫¢NG NG·ª™NG KD -->
                <div id="inactive-container" style="display:none;">
                    <div class="table-container" id="inactive-table-wrap">
                        <table class="table table-hover table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>M√£ SP</th>
                                    <th>T√™n s·∫£n ph·∫©m</th>
                                    <th>S·ªë l∆∞·ª£ng t·ªìn</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>Ng√†y t·∫°o</th>
                                    <th>Thao t√°c</th>
                                </tr>
                            </thead>
                            <tbody id="table-inactive"></tbody>
                        </table>
                    </div>
                    <ul class="pagination justify-content-center" id="pagination-inactive"></ul>
                </div>
            </div>
        </div>

        <!-- ü™ü POPUP XEM S·∫¢N PH·∫®M -->
        <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content rounded-3 shadow">
                    <div class="modal-header bg-primary text-white py-2">
                        <h6 class="modal-title fw-semibold" id="productModalLabel">
                            <i class="fas fa-box"></i> Th√™m s·∫£n ph·∫©m
                        </h6>
                    </div>

                    <div class="modal-body">
                        <form id="product-form">
                            <input type="hidden" id="product-id">

                            <!-- üîπ NH√ìM 1: TH√îNG TIN CH√çNH -->
                            <div class="section-title mt-1">Th√¥ng tin ch√≠nh</div>
                            <div class="row g-3 mt-1">
                                <div class="col-md-3">
                                    <label class="form-label mb-1 fw-semibold small">M√£ SP</label>
                                    <input type="text" class="form-control form-control-sm" id="maSanPham" readonly>
                                </div>

                                <div class="col-md-9">
                                    <label class="form-label mb-1 fw-semibold small">T√™n s·∫£n ph·∫©m</label>
                                    <input type="text" class="form-control form-control-sm" id="tenSanPham" readonly>
                                </div>
                            </div>

                            <!-- üîπ NH√ìM 2: PH√ÇN LO·∫†I -->
                            <div class="section-title mt-3">Ph√¢n lo·∫°i</div>
                            <div class="row g-3 mt-1">
                                <div class="col-md-4">
                                    <label class="form-label mb-1 fw-semibold small">Th∆∞∆°ng hi·ªáu</label>
                                    <input type="text" class="form-control form-control-sm" id="thuongHieuInput" readonly>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label mb-1 fw-semibold small">Danh m·ª•c</label>
                                    <input type="text" class="form-control form-control-sm" id="danhMucInput" readonly>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label mb-1 fw-semibold small">Tr·∫°ng th√°i</label>
                                    <input type="text" class="form-control form-control-sm" id="trangThaiInput" readonly>
                                </div>
                            </div>

                            <!-- üîπ NH√ìM 3: THU·ªòC T√çNH B·ªî SUNG -->
                            <div class="section-title mt-3">Thu·ªôc t√≠nh b·ªï sung</div>
                            <div class="row g-3 mt-1">
                                <div class="col-md-4">
                                    <label class="form-label mb-1 fw-semibold small">Ch·∫•t li·ªáu</label>
                                    <input type="text" class="form-control form-control-sm" id="chatLieuInput" readonly>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label mb-1 fw-semibold small">ƒê·∫ø gi√†y</label>
                                    <input type="text" class="form-control form-control-sm" id="deGiayInput" readonly>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label mb-1 fw-semibold small">Gi·ªõi t√≠nh</label>
                                    <input type="text" class="form-control form-control-sm" id="gioiTinhInput" readonly>
                                </div>

                                <div class="col-12">
                                    <label class="form-label mb-1 fw-semibold small">M√¥ t·∫£ s·∫£n ph·∫©m</label>
                                    <textarea class="form-control form-control-sm" id="moTa" rows="3"
                                              placeholder="Nh·∫≠p m√¥ t·∫£ chi ti·∫øt s·∫£n ph·∫©m..."></textarea>
                                </div>
                            </div>

                            <!-- üîπ NH√ìM 4: TH√îNG TIN H·ªÜ TH·ªêNG -->
                            <div class="section-title mt-3">Th√¥ng tin h·ªá th·ªëng</div>
                            <div class="row g-3 mt-1">
                                <div class="col-md-3">
                                    <label class="form-label mb-1 fw-semibold small">Ng∆∞·ªùi t·∫°o</label>
                                    <input type="text" class="form-control form-control-sm" id="nguoiTao" readonly>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label mb-1 fw-semibold small">Ng√†y t·∫°o</label>
                                    <input type="text" class="form-control form-control-sm" id="ngayTao" readonly>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label mb-1 fw-semibold small">Ng∆∞·ªùi c·∫≠p nh·∫≠t</label>
                                    <input type="text" class="form-control form-control-sm" id="nguoiCapNhat" readonly>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label mb-1 fw-semibold small">Ng√†y c·∫≠p nh·∫≠t</label>
                                    <input type="text" class="form-control form-control-sm" id="ngayCapNhat" readonly>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="modal-footer py-2">
                        <button type="button" class="btn btn-success btn-sm" id="btn-save-product">
                            <i class="fas fa-save"></i> L∆∞u
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- üåø SCRIPT -->
    <div layout:fragment="scripts">
        <script>
            $(document).ready(function () {

                // ===========================
                // üåà Aurora Toast Notification
                // ===========================
                function showToast(message, type = 'success') {
                    // N·∫øu container ch∆∞a c√≥, t·∫°o 1 c√°i
                    let container = document.querySelector('.aurora-toast-container');
                    if (!container) {
                        container = document.createElement('div');
                        container.className = 'aurora-toast-container';
                        Object.assign(container.style, {
                            position: 'fixed',
                            top: '20px',
                            right: '20px',
                            display: 'flex',
                            flexDirection: 'column',
                            gap: '10px',
                            zIndex: 9999,
                            pointerEvents: 'none' // kh√¥ng ch·∫∑n click c√°c ph·∫ßn t·ª≠ kh√°c
                        });
                        document.body.appendChild(container);
                    }

                    // T·∫°o ph·∫ßn t·ª≠ toast
                    const toast = document.createElement('div');
                    toast.className = `aurora-toast ${type}`;
                    toast.innerHTML = `
        <div class="aurora-toast-content">
            ${message}
        </div>
    `;

                    // Style Aurora/iOS-like
                    Object.assign(toast.style, {
                        minWidth: '240px',
                        padding: '10px 16px',
                        borderRadius: '12px',
                        color: '#fff',
                        fontSize: '14px',
                        fontWeight: '500',
                        boxShadow: '0 4px 20px rgba(0,0,0,0.1)',
                        backdropFilter: 'blur(12px)',
                        WebkitBackdropFilter: 'blur(12px)',
                        opacity: 0,
                        transform: 'translateY(-10px)',
                        transition: 'all 0.3s ease',
                        pointerEvents: 'auto'
                    });

                    // M√†u theo lo·∫°i
                    if (type === 'error') {
                        toast.style.background = 'linear-gradient(135deg, #ff5f6d, #d43f8d)';
                    } else if (type === 'warning') {
                        toast.style.background = 'linear-gradient(135deg, #f7971e, #ffd200)';
                        toast.style.color = '#333';
                    } else {
                        toast.style.background = 'linear-gradient(135deg, var(--aurora-primary, #00b4d8), #007bff)';
                    }

                    // Th√™m v√†o container
                    container.appendChild(toast);

                    // Hi·ªán l√™n
                    requestAnimationFrame(() => {
                        toast.style.opacity = 1;
                        toast.style.transform = 'translateY(0)';
                    });

                    // T·ª± ·∫©n sau 3s
                    setTimeout(() => {
                        toast.style.opacity = 0;
                        toast.style.transform = 'translateY(-10px)';
                        setTimeout(() => toast.remove(), 400);
                    }, 2000);
                }

                // --- CHUY·ªÇN TRANG TH√äM M·ªöI ---
                $('#btn-open-add-modal').click(() => {
                    window.location.href = '/admin/san-pham/them-san-pham';
                });

                // --- DROPDOWN S·∫ÆP X·∫æP ---
                $(document).on('click', '.dropdown-input', function () {
                    const listId = '#' + $(this).attr('id').replace('Input', 'List');
                    $('.dropdown-list').not(listId).removeClass('show');
                    $(listId).toggleClass('show');
                });

                $(document).on('click', '#sortList .dropdown-item', function () {
                    const sortType = $(this).data('sort');
                    const text = $(this).text();
                    $('#sortInput').val(text);
                    $('#sortList').removeClass('show');

                    function sortProducts(list) {
                        switch (sortType) {
                            case 'newest': return [...list].sort((a, b) => new Date(b.ngayTao) - new Date(a.ngayTao));
                            case 'oldest': return [...list].sort((a, b) => new Date(a.ngayTao) - new Date(b.ngayTao));
                            case 'code-asc': return [...list].sort((a, b) => (a.maSanPham || '').localeCompare(b.maSanPham || ''));
                            case 'code-desc': return [...list].sort((a, b) => (b.maSanPham || '').localeCompare(a.maSanPham || ''));
                            case 'name-asc': return [...list].sort((a, b) => a.tenSanPham.localeCompare(b.tenSanPham));
                            case 'name-desc': return [...list].sort((a, b) => b.tenSanPham.localeCompare(a.tenSanPham));
                            case 'qty-desc': return [...list].sort((a, b) => (b.tongSoLuong ?? 0) - (a.tongSoLuong ?? 0));
                            case 'qty-asc': return [...list].sort((a, b) => (a.tongSoLuong ?? 0) - (b.tongSoLuong ?? 0));
                            default: return list;
                        }
                    }

                    // G·ªçi render l·∫°i b·∫£ng hi·ªán t·∫°i
                    if (currentView === 'all') {
                        const allList = [...filteredActive, ...filteredInactive];
                        const sorted = sortProducts(allList);
                        renderTable('#table-all', sorted, 1, '#pagination-all', null);
                    } else if (currentView === 'active') {
                        filteredActive = sortProducts(filteredActive);
                        renderTable('#table-active', filteredActive, activePage, '#pagination-active', true);
                    } else if (currentView === 'inactive') {
                        filteredInactive = sortProducts(filteredInactive);
                        renderTable('#table-inactive', filteredInactive, inactivePage, '#pagination-inactive', false);
                    }
                });

                // ·∫®n dropdown khi click ra ngo√†i
                $(document).click(function (e) {
                    if (!$(e.target).closest('.dropdown-input, .dropdown-list').length)
                        $('.dropdown-list').removeClass('show');
                });


                // --- L∆ØU M√î T·∫¢ ---
                $('#btn-save-product').click(async function () {
                    try {
                        const id = $('#product-id').val();
                        const moTa = $('#moTa').val().trim();
                        if (!id) return alert('‚ö†Ô∏è Ch∆∞a c√≥ s·∫£n ph·∫©m ƒë∆∞·ª£c ch·ªçn!');
                        await axios.put(`/api/san-pham/update/${id}`, { moTa });
                        alert('‚úÖ C·∫≠p nh·∫≠t m√¥ t·∫£ th√†nh c√¥ng!');
                        $('#productModal').modal('hide');
                        loadProducts();
                    } catch (err) {
                        console.error(err);
                        alert('‚ùå L·ªói khi c·∫≠p nh·∫≠t m√¥ t·∫£ s·∫£n ph·∫©m!');
                    }
                });

                const pageSize = 7;
                let activeList = [], inactiveList = [], filteredActive = [], filteredInactive = [];
                let activePage = 1, inactivePage = 1;
                let currentView = "all";

                // --- HI·ªÜU ·ª®NG SHIMMER ---
                function showSkeleton(tableId, rowCount = 7, colCount = 7) {
                    const $table = $(tableId).empty();
                    for (let i = 0; i < rowCount; i++) {
                        let row = '<tr class="skeleton-row">';
                        for (let j = 0; j < colCount; j++) row += `<td><div class="shimmer skeleton-cell"></div></td>`;
                        row += '</tr>';
                        $table.append(row);
                    }
                }

                // --- LOAD D·ªÆ LI·ªÜU S·∫¢N PH·∫®M ---
                async function loadProducts() {
                    showSkeleton('#table-all', 7, 7);
                    showSkeleton('#table-active', 7, 7);
                    showSkeleton('#table-inactive', 7, 7);

                    try {
                        const res = await axios.get('/api/san-pham/getAll');
                        const data = res.data || [];
                        activeList = data.filter(sp => sp.trangThai === 1);
                        inactiveList = data.filter(sp => sp.trangThai === 0);
                        filteredActive = activeList;
                        filteredInactive = inactiveList;
                        setTimeout(renderTables, 600);
                    } catch {
                        alert('‚ùå L·ªói khi t·∫£i d·ªØ li·ªáu s·∫£n ph·∫©m!');
                    }
                }

                // --- RENDER B·∫¢NG ---
                function renderTables() {
                    const allList = [...filteredActive, ...filteredInactive].sort((a, b) => b.id - a.id);
                    renderTable('#table-all', allList, 1, '#pagination-all', null);
                    renderTable('#table-active', filteredActive, activePage, '#pagination-active', true);
                    renderTable('#table-inactive', filteredInactive, inactivePage, '#pagination-inactive', false);
                }

                function renderTable(tableId, list, page, paginationId, isActive) {
                    const start = (page - 1) * pageSize;
                    const slice = list.slice(start, start + pageSize);
                    const $table = $(tableId).empty();

                    if (!slice.length) {
                        $table.append('<tr><td colspan="9" class="text-center text-muted">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>');
                        return;
                    }

                    slice.forEach((sp, index) => {
                        const stt = start + index + 1;
                        const trangThaiText = sp.trangThai === 1 ? 'ƒêang b√°n' : 'Ng·ª´ng b√°n';
                        const trangThaiClass = sp.trangThai === 1
                            ? 'badge bg-success-subtle text-success border border-success'
                            : 'badge bg-danger-subtle text-danger border border-danger';
                        const soLuong = sp.tongSoLuong ? sp.tongSoLuong.toLocaleString('vi-VN') : '0';
                        const toggleBtnClass = sp.trangThai === 1 ? 'btn-warning' : 'btn-success';
                        const toggleIcon = sp.trangThai === 1 ? 'fa-ban' : 'fa-undo';
                        const toggleTitle = sp.trangThai === 1 ? 'Ng·ª´ng kinh doanh' : 'Kh√¥i ph·ª•c kinh doanh';

                        $table.append(`
                <tr class="product-row" data-id="${sp.id}">
                    <td>${stt}</td>
                    <td>${sp.maSanPham}</td>
                    <td>${sp.tenSanPham}</td>
                    <td><span class="fw-semibold text-primary">${soLuong}</span></td>
                    <td><span class="${trangThaiClass}">${trangThaiText}</span></td>
                    <td>${sp.ngayTao ? new Date(sp.ngayTao).toLocaleDateString('vi-VN') : ''}</td>
                    <td>
                        <button class="btn btn-sm btn-info btn-view" data-id="${sp.id}" title="Xem chi ti·∫øt">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-primary btn-edit" data-id="${sp.id}" title="S·ª≠a s·∫£n ph·∫©m">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm ${toggleBtnClass} btn-toggle" data-id="${sp.id}" title="${toggleTitle}">
                            <i class="fas ${toggleIcon}"></i>
                        </button>
                    </td>
                </tr>`);
                    });

                    const totalPages = Math.ceil(list.length / pageSize);
                    const $pagination = $(paginationId).empty();
                    for (let i = 1; i <= totalPages; i++) {
                        $pagination.append(`<li class="page-item ${i === page ? 'active' : ''}">
                                <a class="page-link" href="#">${i}</a></li>`);
                    }
                    $pagination.find('.page-link').click(e => {
                        e.preventDefault();
                        const newPage = parseInt($(e.target).text());
                        if (isActive) activePage = newPage; else inactivePage = newPage;
                        renderTables();
                    });
                }

                // --- XEM S·∫¢N PH·∫®M ---
                $(document).on('click', '.btn-view', async function () {
                    const id = $(this).data('id');
                    if (!id) return;
                    try {
                        const res = await axios.get(`/api/san-pham/${id}`);
                        const sp = res.data;
                        $('#product-id').val(sp.id);
                        $('#maSanPham').val(sp.maSanPham);
                        $('#tenSanPham').val(sp.tenSanPham);
                        $('#thuongHieuInput').val(sp.tenThuongHieu || '‚Äî');
                        $('#danhMucInput').val(sp.tenDanhMuc || '‚Äî');
                        $('#trangThaiInput').val(sp.trangThai === 1 ? 'ƒêang kinh doanh' : 'Ng·ª´ng kinh doanh');
                        $('#chatLieuInput').val(sp.tenChatLieu || '‚Äî');
                        $('#deGiayInput').val(sp.tenDeGiay || '‚Äî');
                        $('#gioiTinhInput').val(sp.gioiTinh === 0 ? 'Nam' : sp.gioiTinh === 1 ? 'N·ªØ' : 'Nam v√† N·ªØ');
                        $('#moTa').val(sp.moTa || '');
                        $('#nguoiTao').val(sp.nguoiTao || '');
                        $('#ngayTao').val(sp.ngayTao ? new Date(sp.ngayTao).toLocaleDateString('vi-VN') : '');
                        $('#nguoiCapNhat').val(sp.nguoiCapNhat || '');
                        $('#ngayCapNhat').val(sp.ngayCapNhat ? new Date(sp.ngayCapNhat).toLocaleDateString('vi-VN') : '');
                        $('#productModalLabel').text('Xem th√¥ng tin s·∫£n ph·∫©m');
                        $('#productModal').modal('show');
                    } catch {
                        alert('‚ùå Kh√¥ng th·ªÉ t·∫£i th√¥ng tin s·∫£n ph·∫©m!');
                    }
                });

                // --- S·ª¨A S·∫¢N PH·∫®M ---
                $(document).on('click', '.btn-edit', function () {
                    const id = $(this).data('id');
                    if (id) window.location.href = `/admin/san-pham/san-pham-chi-tiet?id=${id}`;
                });




                $(document).on('click', '.btn-toggle', async function () {
                    const id = $(this).data('id');
                    const isActive = $(this).hasClass('btn-warning');
                    const newStatus = isActive ? 0 : 1;

                    const confirmMsg = newStatus === 0
                        ? "B·∫°n c√≥ ch·∫Øc mu·ªën NG·ª™NG B√ÅN s·∫£n ph·∫©m n√†y? T·∫•t c·∫£ bi·∫øn th·ªÉ con s·∫Ω b·ªã ng·ª´ng b√°n."
                        : "B·∫°n c√≥ ch·∫Øc mu·ªën M·ªû B√ÅN s·∫£n ph·∫©m n√†y? T·∫•t c·∫£ bi·∫øn th·ªÉ con s·∫Ω ƒë∆∞·ª£c m·ªü b√°n.";

                    if (!confirm(confirmMsg)) return;

                    try {
                        await axios.put(`/api/san-pham/update-trang-thai/${id}?trangThai=${newStatus}`);
                        showToast('C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng!');
                        loadProducts();
                    } catch (err) {
                        console.error(err);
                        showToast('L·ªói khi c·∫≠p nh·∫≠t tr·∫°ng th√°i!', 'error');
                    }
                });


                // --- T√åM KI·∫æM ---
                $('#search-input').on('input', function () {
                    const keyword = $(this).val().toLowerCase().trim();
                    filteredActive = activeList.filter(sp =>
                        (sp.maSanPham || '').toLowerCase().includes(keyword) ||
                        (sp.tenSanPham || '').toLowerCase().includes(keyword)
                    );
                    filteredInactive = inactiveList.filter(sp =>
                        (sp.maSanPham || '').toLowerCase().includes(keyword) ||
                        (sp.tenSanPham || '').toLowerCase().includes(keyword)
                    );
                    renderTables();
                });

                // --- CHUY·ªÇN GI·ªÆA 3 B·∫¢NG ---
                $('#btn-toggle-view').click(() => {
                    const $btn = $('#btn-toggle-view');
                    $('#all-container, #active-container, #inactive-container').hide();
                    if (currentView === 'all') {
                        currentView = 'active';
                        $('#active-container').fadeIn(200);
                        $btn.html('<i class="fas fa-play-circle me-1"></i> <span>Hi·ªÉn th·ªã: ƒêang b√°n</span>');
                    } else if (currentView === 'active') {
                        currentView = 'inactive';
                        $('#inactive-container').fadeIn(200);
                        $btn.html('<i class="fas fa-pause-circle me-1"></i> <span>Hi·ªÉn th·ªã: Ng·ª´ng b√°n</span>');
                    } else {
                        currentView = 'all';
                        $('#all-container').fadeIn(200);
                        $btn.html('<i class="fas fa-layer-group me-1"></i> <span>Hi·ªÉn th·ªã: T·∫•t c·∫£ s·∫£n ph·∫©m</span>');
                    }
                });

                $(document).on('change', '.trang-thai-select', async function () {
                    const id = $(this).data('id');
                    const newStatus = parseInt($(this).val());
                    let confirmMsg = "";

                    if (newStatus === 0)
                        confirmMsg = "B·∫°n c√≥ ch·∫Øc mu·ªën NG·ª™NG B√ÅN s·∫£n ph·∫©m n√†y? To√†n b·ªô bi·∫øn th·ªÉ con s·∫Ω b·ªã ng·ª´ng b√°n.";
                    else if (newStatus === 1)
                        confirmMsg = "B·∫°n c√≥ ch·∫Øc mu·ªën M·ªû B√ÅN l·∫°i s·∫£n ph·∫©m n√†y? To√†n b·ªô bi·∫øn th·ªÉ con s·∫Ω ƒë∆∞·ª£c m·ªü b√°n.";

                    if (confirmMsg && !confirm(confirmMsg)) {
                        // ho√†n t√°c dropdown
                        $(this).val(newStatus === 1 ? 0 : 1);
                        return;
                    }

                    try {
                        await axios.put(`/api/san-pham/update-trang-thai/${id}?trangThai=${newStatus}`);
                        showToast('C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng!');
                    } catch (err) {
                        console.error(err);
                        showToast('L·ªói khi c·∫≠p nh·∫≠t tr·∫°ng th√°i!', 'error');
                    }
                });


                // üöÄ INIT
                loadProducts();
            });
        </script>
    </div>
</body>

</html>