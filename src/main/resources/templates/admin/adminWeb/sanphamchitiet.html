<!DOCTYPE html>
<html lang="vi" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{admin/layout/Layout}">

<head>
    <title layout:title="Qu·∫£n l√Ω s·∫£n ph·∫©m chi ti·∫øt"></title>
    <style>
        /***************************************************
 * 1Ô∏è‚É£  C·∫§U H√åNH CHUNG TO√ÄN TRANG
 ***************************************************/
        html,
        body {
            height: 100%;
            background-color: #f4f6f9;
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
        }

        /* Gi·ªØ h√†ng 3 c√¢n ƒë·ªëi khi c√≥ 4 input */
        #spct-form .form-row .col input.form-control {
            min-width: 0;
            /* NgƒÉn tr√†n */
            padding: 6px 10px;
            /* Nh·ªè g·ªçn h∆°n m·ªôt ch√∫t */
        }

        /* ‚úÖ C√¢n l·∫°i h√†ng 3 c√≥ 4 input, kh√¥ng tr√†n khung */
        #spct-form .form-row:last-child {
            display: flex;
            gap: 8px;
            flex-wrap: nowrap;
            /* ‚ùó Gi·ªØ t·∫•t c·∫£ 4 √¥ tr√™n c√πng 1 h√†ng */
        }

        #spct-form .form-row:last-child .col {
            flex: 1 1 0;
            /* Cho ph√©p co gi√£n ƒë·ªÅu nhau */
            max-width: 25%;
            /* 4 √¥ v·ª´a ƒë·ªß 100% */
            min-width: 0;
            /* NgƒÉn tr√†n khi text d√†i */
        }


        /* N·∫øu m√†n h√¨nh nh·ªè (tablet, mobile) th√¨ t·ª± xu·ªëng h√†ng */
        @media (max-width: 992px) {
            #spct-form .form-row:last-child .col {
                flex: 1 1 50%;
                /* 2 c·ªôt m·ªói h√†ng */
                margin-bottom: 6px;
            }

            #spct-form .form-row:last-child .col {
                flex: 1 1 48%;
                /* 2 √¥ m·ªói h√†ng */
                max-width: 48%;
                margin-bottom: 6px;
            }
        }


        .page-content-section {
            height: calc(100vh - 60px);
            box-sizing: border-box;
            padding-bottom: 0;
        }

        .card {
            display: flex;
            flex-direction: column;
            height: 100%;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
            background: #fff;
        }

        /***************************************************
         * 2Ô∏è‚É£  PH·∫¶N TI√äU ƒê·ªÄ (CARD HEADER)
         ***************************************************/
        .card-header {
            flex: 0 0 auto;
            position: sticky;
            top: 0;
            z-index: 10;
            background: #007bff;
            color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 15px;
            border-radius: 8px 8px 0 0;
        }

        .card-header h5 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
            letter-spacing: 0.3px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.08);
        }

        /***************************************************
         * 3Ô∏è‚É£  B·ªê C·ª§C CH√çNH ‚Äì FORM 2 C·ªòT
         ***************************************************/
        .card-body {
            flex: 1;
            padding: 10px 16px !important;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            overflow: visible !important;
        }

        /* Layout t·ªïng */
        .spct-form {
            display: flex;
            flex-wrap: nowrap;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 10px;
        }

        /* C·ªôt tr√°i (form 3 h√†ng) */
        .col-left {
            flex: 0 0 58%;
            /* Chi·∫øm kho·∫£ng 58% */
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* C·ªôt ph·∫£i (upload ·∫£nh + n√∫t d·ªçc) */
        .col-right {
            flex: 0 0 42%;
            /* Upload chi·∫øm 42% */
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            gap: 10px;
        }

        /***************************************************
         * 4Ô∏è‚É£  √î NH·∫¨P LI·ªÜU & DROPDOWN
         ***************************************************/
        .form-row {
            display: flex;
            gap: 8px;
            justify-content: flex-start;
        }

        .form-row .col {
            flex: 1;
        }

        .form-row .form-control,
        .dropdown-input {
            height: 34px;
            font-size: 0.9rem;
        }

        /* Input ch·ªçn */
        .dropdown-input {
            cursor: pointer;
            background-color: #fff;
            border: 1px solid #ced4da;
            border-radius: 6px;
            transition: box-shadow 0.2s ease-in-out;
        }

        .dropdown-input:focus {
            outline: none;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
        }

        /* Danh s√°ch th·∫£ xu·ªëng */
        .dropdown-list {
            display: none;
            position: absolute;
            top: 36px;
            left: 0;
            width: 100%;
            background: #fff;
            border: 1px solid #ced4da;
            border-radius: 6px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            max-height: 180px;
            overflow-y: auto;
            z-index: 50;
            padding: 4px 0;
            opacity: 0;
            transform: translateY(-5px);
            transition: all 0.2s ease-in-out;
        }

        .dropdown-list.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .dropdown-item {
            padding: 6px 12px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background: #e7f1ff;
        }

        /* üé® √î dropdown S·∫Øp x·∫øp ‚Äì gi·ªëng √¥ m√†u s·∫Øc */
        #sortSelectInput {
            cursor: pointer;
            background-color: #fff;
            border: 1.5px solid #d0d7de;
            border-radius: 8px;
            height: 34px;
            font-size: 0.9rem;
            color: #001f3f;
            transition: all 0.2s ease;
            padding-right: 28px;
            position: relative;
        }

        /* M≈©i t√™n xu·ªëng ·∫£o */
        #sortSelectInput::after {
            content: "\f078";
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            color: #6b7280;
            pointer-events: none;
        }

        /* Hover & Focus */
        #sortSelectInput:hover,
        #sortSelectInput:focus {
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.15);
            outline: none;
        }

        /* Danh s√°ch dropdown */
        #sortSelectList {
            display: none;
            position: absolute;
            top: 38px;
            left: 0;
            width: 100%;
            background: #fff;
            border: 1px solid #ced4da;
            border-radius: 8px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            z-index: 99;
            opacity: 0;
            transform: translateY(-5px);
            transition: all 0.2s ease;
            max-height: 220px; /* ‚úÖ Gi·ªõi h·∫°n chi·ªÅu cao, b·∫Øt ƒë·∫ßu c√≥ thanh cu·ªôn */
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 123, 255, 0.3) transparent; /* Firefox */
        }

        #sortSelectList.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        #sortSelectList .dropdown-item {
            padding: 6px 12px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        #sortSelectList .dropdown-item:hover {
            background-color: #e7f1ff;
            color: #007bff;
        }
        /* üé® Scrollbar ƒë·∫πp cho dropdown "S·∫Øp x·∫øp theo" */
        /*#sortSelectList {*/
        /*    max-height: 220px; !* ‚úÖ Gi·ªõi h·∫°n chi·ªÅu cao, b·∫Øt ƒë·∫ßu c√≥ thanh cu·ªôn *!*/
        /*    overflow-y: auto;*/
        /*    scrollbar-width: thin;*/
        /*    scrollbar-color: rgba(0, 123, 255, 0.3) transparent; !* Firefox *!*/
        /*}*/

        /* Chrome / Edge / Safari */
        #sortSelectList::-webkit-scrollbar {
            width: 6px;
        }

        #sortSelectList::-webkit-scrollbar-track {
            background: transparent;
        }

        #sortSelectList::-webkit-scrollbar-thumb {
            background: rgba(0, 123, 255, 0.25);
            border-radius: 10px;
            transition: background 0.25s ease;
        }

        #sortSelectList::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 123, 255, 0.5);
        }



        /***************************************************
 * 5Ô∏è‚É£  KHU V·ª∞C UPLOAD ·∫¢NH ‚Äì GIAO DI·ªÜN SHOPEE STYLE
 ***************************************************/

        /* üì¶ Khu v·ª±c upload ·∫£nh ki·ªÉu Shopee */
        .upload-container {
            flex: 1;
            position: relative;
            background: #fff;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 10px;
            height: 130px;
            /* ‚úÖ Chi·ªÅu cao c·ªë ƒë·ªãnh */
            width: calc(3 * 80px + 2 * 10px + 20px);
            /* ‚úÖ R·ªông v·ª´a 3 ·∫£nh + kho·∫£ng c√°ch */
            max-width: 100%;
            transition: all .3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
            /* ‚úÖ ·∫®n ph·∫ßn tr√†n ra ngo√†i */
            box-sizing: border-box;
        }

        .upload-container:hover {
            border-color: #007bff;
            background-color: #f8fbff;
        }

        /* Placeholder */
        .upload-placeholder {
            position: absolute;
            /* ‚úÖ Cho ph√©p cƒÉn gi·ªØa tuy·ªát ƒë·ªëi */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            /* ‚úÖ ƒê∆∞a icon + ch·ªØ ch√≠nh gi·ªØa khung */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #6b7280;
            font-size: 0.9rem;
            line-height: 1.3;
            gap: 6px;
            pointer-events: none;
        }

        .upload-placeholder i {
            display: block;
            font-size: 26px;
            margin-bottom: 4px;
            color: #007bff;
        }

        .upload-container.has-images .upload-placeholder {
            display: none;
        }

        /* Input file ph·ªß to√†n khung khi CH∆ØA c√≥ ·∫£nh */
        #image-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 2;
            pointer-events: auto;
        }

        /* Khi ƒë√£ c√≥ ·∫£nh: input kh√¥ng nh·∫≠n click v√† ‚Äúra kh·ªèi ƒë∆∞·ªùng b·∫Øn chu·ªôt‚Äù */
        .upload-container.has-images #image-input {
            pointer-events: none;
            width: 1px;
            height: 1px;
            left: -9999px;
            top: auto;
        }

        /***************************************************
         * üå´ B√ìNG M·ªú G·ª¢I √ù CU·ªòN ‚Äì B√ÅM M√âP NGO√ÄI KHUNG
         ***************************************************/

        /* B√≥ng m·ªù b√™n tr√°i */
        .upload-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 45px;
            height: 100%;
            pointer-events: none;
            background: linear-gradient(to right, rgba(180, 180, 180, 0.55), rgba(255, 255, 255, 0));
            opacity: 0;
            transition: opacity 0.6s ease-in-out;
            z-index: 3;
        }

        /* B√≥ng m·ªù b√™n ph·∫£i */
        .upload-container::after {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 45px;
            height: 100%;
            pointer-events: none;
            background: linear-gradient(to left, rgba(180, 180, 180, 0.55), rgba(255, 255, 255, 0));
            opacity: 0;
            transition: opacity 0.6s ease-in-out;
            z-index: 3;
        }

        /* Khi c·∫ßn hi·ªÉn th·ªã */
        .upload-container.shadow-left::before {
            opacity: 1;
        }

        .upload-container.shadow-right::after {
            opacity: 1;
        }

        /***************************************************
         * 6Ô∏è‚É£  ·∫¢NH XEM TR∆Ø·ªöC (PREVIEW) ‚Äì HI·ªÜU ·ª®NG CU·ªòN M∆Ø·ª¢T
         ***************************************************/

        /* Container hi·ªÉn th·ªã ·∫£nh theo h√†ng ngang, c√≥ cu·ªôn m∆∞·ª£t */
        .preview-container {
            position: relative;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            padding: 6px;
            scroll-behavior: smooth;
            /* ‚úÖ Cu·ªôn m∆∞·ª£t */
            scroll-snap-type: x mandatory;
            /* ‚úÖ C·∫£m gi√°c b√°m t·ª´ng ·∫£nh */
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            transition: all 0.3s ease;
            scrollbar-width: thin;
            scrollbar-color: #ccc transparent;
        }

        .preview-container::-webkit-scrollbar {
            height: 6px;
        }

        .preview-container::-webkit-scrollbar-thumb {
            background-color: #bbb;
            border-radius: 3px;
        }

        /* Box ·∫£nh ‚Äî c√≥ hi·ªáu ·ª©ng ‚Äúsnap‚Äù khi cu·ªôn */
        .image-box,
        .image-add-box {
            scroll-snap-align: start;
        }

        /* Box ·∫£nh ‚Äî v·ª´a khung */
        .image-box {
            width: 80px;
            height: 80px;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            background: #fff;
            flex-shrink: 0;
            transition: transform .2s ease, opacity .3s ease;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .image-box:hover {
            transform: scale(1.05);
        }

        .image-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-box.cover {
            outline: 2px solid #22c55e;
        }

        .image-actions {
            position: absolute;
            right: 4px;
            top: 4px;
            display: flex;
            gap: 2px;
        }

        .image-badge {
            position: absolute;
            left: 4px;
            bottom: 4px;
            font-size: 9px;
            padding: 1px 5px;
        }

        /* N√∫t th√™m ·∫£nh (+) ‚Äì c√πng k√≠ch th∆∞·ªõc, n·∫±m cu·ªëi c√πng, cu·ªôn theo ·∫£nh */
        .image-add-box {
            width: 80px;
            height: 80px;
            border: 2px dashed #007bff;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #007bff;
            font-size: 28px;
            cursor: pointer;
            flex-shrink: 0;
            transition: all .2s;
            background-color: #fff;
        }

        .image-add-box:hover {
            background-color: #e9f3ff;
        }

        /* Hi·ªáu ·ª©ng m·ªù khi reset */
        .preview-container.resetting {
            opacity: 0.4;
            transition: opacity .3s;
        }

        /***************************************************
 * 7Ô∏è‚É£  N√öT H√ÄNH ƒê·ªòNG (TH√äM / L∆ØU / M·ªöI)
 ***************************************************/
        .btn-group-vertical {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            margin-right: 15px;
        }

        /* C·∫•u tr√∫c chung c·ªßa n√∫t */
        .btn-group-vertical .btn {
            width: 68px;
            height: 30px;
            font-size: 0.78rem;
            padding: 3px 6px;
            border-radius: 8px !important;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            transition: all 0.15s ease-in-out;
            white-space: nowrap;
        }

        /* icon nh·ªè g·ªçn */
        .btn-group-vertical .btn i {
            font-size: 13px;
        }

        /* Hi·ªáu ·ª©ng hover nh·∫π */
        .btn-group-vertical .btn:hover {
            transform: scale(1.05);
            opacity: 0.95;
        }

        /* Khi ƒëang nh·∫•n (chu·ªôt ch∆∞a th·∫£): t·ªëi nh·∫π */
        .btn:active {
            filter: brightness(0.9);
            transform: scale(0.97);
            transition: none;
        }

        /* Khi th·∫£ chu·ªôt ra: s√°ng l·∫°i ngay */
        .btn:focus:not(:active) {
            filter: brightness(1) !important;
            transform: scale(1) !important;
            transition: all 0.1s ease-out;
        }

        /* X√≥a b√≥ng m·∫∑c ƒë·ªãnh Bootstrap */
        .btn:focus,
        .btn:active {
            box-shadow: none !important;
            outline: none !important;
        }

        /* Responsive nh·ªè: ch·ªâ hi·ªán icon */
        @media (max-width: 992px) {
            .btn-group-vertical .btn {
                width: 38px;
                padding: 0;
            }

            .btn-group-vertical .btn span {
                display: none;
            }

            .btn-group-vertical .btn i {
                margin: 0;
            }
        }

        /***************************************************
 * üé®  B·∫¢NG D·ªÆ LI·ªÜU S·∫¢N PH·∫®M CHI TI·∫æT ‚Äî PHONG C√ÅCH ADMINLTE NH·∫∏
 ***************************************************/
        /***************************************************
 * üé® B·∫¢NG S·∫¢N PH·∫®M CHI TI·∫æT ‚Äì PHONG C√ÅCH TINH G·ªåN
 * Gi·ªØ tone s√°ng (#f8f9fa, #007bff), bo m·ªÅm, b√≥ng nh·∫π
 ***************************************************/
        .table-container {
            background: #fff;
            margin-top: 12px;
            flex: 1;
            border: none;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            overflow: hidden;
        }

        /* Thanh cu·ªôn m·∫£nh, tinh t·∫ø */
        .table-container::-webkit-scrollbar {
            height: 6px;
        }
        .table-container::-webkit-scrollbar-thumb {
            background-color: #cfd4da;
            border-radius: 3px;
        }

        /***************************************************
         * üß≠ HEADER B·∫¢NG
         ***************************************************/
        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.88rem;
            color: #333;
        }

        .table thead th {
            background: linear-gradient(180deg, #f8f9fa, #f1f3f5);
            color: #001f3f;
            font-weight: 600;
            text-align: center;
            padding: 8px 6px;
            border-bottom: 2px solid #dee2e6;
            height: 34px;
            vertical-align: middle;
            position: sticky;
            top: 0;
            z-index: 5;
            line-height: 1.2;
            white-space: nowrap;
            user-select: none;
        }

        /* Checkbox ch·ªçn t·∫•t c·∫£ */
        .table thead th input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #007bff;
        }

        /***************************************************
         * üìã BODY B·∫¢NG
         ***************************************************/
        .table tbody tr {
            background-color: #fff;
            border-bottom: 1px solid #e9ecef;
            transition: background-color 0.2s ease-in-out;
        }

        .table tbody tr:hover {
            background-color: #f3f7ff;
        }

        .table td {
            text-align: center;
            vertical-align: middle !important;
            padding: 8px 6px;
            height: 44px;
            white-space: nowrap;
            color: #212529;
        }

        /* C·ªôt t√™n s·∫£n ph·∫©m r√∫t g·ªçn */
        .table td.truncate {
            max-width: 160px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            vertical-align: middle;
            cursor: default;
        }

        /* Khi hover v√†o √¥ truncate */
        .table td.truncate:hover {
            background-color: #f1f6ff;
        }

        /***************************************************
         * üñºÔ∏è ·∫¢NH, CHECKBOX, N√öT
         ***************************************************/
        /* ·∫¢nh b√¨a nh·ªè */
        .table td img {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            object-fit: cover;
            border: 1px solid #ddd;
            background-color: #fff;
        }

        /* Checkbox t·ª´ng h√†ng */
        .table td input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #007bff;
        }

        /* N√∫t thao t√°c */
        .table td .btn {
            padding: 4px 6px;
            font-size: 0.78rem;
            border-radius: 6px;
            transition: all 0.15s ease-in-out;
            box-shadow: none !important;
        }
        .table td .btn:hover {
            transform: scale(1.08);
            background-color: #f0f4ff;
        }

        /***************************************************
         * üìè ƒê·ªò R·ªòNG C·ªòT (11 C·ªòT)
         ***************************************************/
        .table th:nth-child(1),
        .table td:nth-child(1) { width: 42px; }   /* Tick */
        .table th:nth-child(2),
        .table td:nth-child(2) { width: 50px; }   /* STT */
        .table th:nth-child(3),
        .table td:nth-child(3) { width: 150px; }   /* ·∫¢nh b√¨a */
        .table th:nth-child(4),
        .table td:nth-child(4) { min-width: 180px; } /* T√™n s·∫£n ph·∫©m */
        .table th:nth-child(5),
        .table td:nth-child(5) { width: 90px; }   /* S·ªë l∆∞·ª£ng */
        .table th:nth-child(6),
        .table td:nth-child(6) { width: 110px; }  /* Gi√° nh·∫≠p */
        .table th:nth-child(7),
        .table td:nth-child(7) { width: 110px; }  /* Gi√° b√°n */
        .table th:nth-child(8),
        .table td:nth-child(8) { width: 90px; }   /* M√†u s·∫Øc */
        .table th:nth-child(9),
        .table td:nth-child(9) { width: 90px; }   /* K√≠ch c·ª° */
        .table th:nth-child(10),
        .table td:nth-child(10) { width: 120px; }  /* Tr·∫°ng th√°i */
        .table th:nth-child(11),
        .table td:nth-child(11) { width: 100px; } /* Thao t√°c */

        /***************************************************
         * üåà D√íNG ƒê∆Ø·ª¢C CH·ªåN
         ***************************************************/
        .spct-row.selected {
            background-color: #e0f0ff !important;
            box-shadow: inset 0 0 0 1px #007bff;
            transition: background-color 0.25s ease-in-out;
        }

        /***************************************************
         * üì± RESPONSIVE
         ***************************************************/
        @media (max-width: 992px) {
            .table {
                font-size: 0.82rem;
                min-width: 950px;
            }
        }
        @media (max-width: 576px) {
            .table th,
            .table td {
                padding: 6px 4px;
            }
            .table-container {
                border-radius: 6px;
            }
        }


        /***************************************************
 * üìÑ THANH PH√ÇN TRANG
 ***************************************************/
        #pagination {
            margin-top: 8px;
        }

        .pagination .page-item .page-link {
            color: #007bff;
            border: none;
            background: transparent;
        }

        .pagination .page-item.active .page-link {
            background-color: #007bff;
            color: #fff;
            border-radius: 6px;
        }

        .pagination .page-item.disabled .page-link {
            color: #aaa;
            pointer-events: none;
        }





        /***************************************************
         * 9Ô∏è‚É£  HI·ªÜU ·ª®NG LOADING SHIMMER
         ***************************************************/
        .shimmer {
            position: relative;
            overflow: hidden;
            background: #f6f7f8;
            background-image: linear-gradient(to right,
                    #f6f7f8 0%,
                    #edeef1 20%,
                    #f6f7f8 40%,
                    #f6f7f8 100%);
            background-repeat: no-repeat;
            background-size: 800px 100%;
            animation: shimmer 1.2s linear infinite forwards;
        }

        @keyframes shimmer {
            0% {
                background-position: -800px 0;
            }

            100% {
                background-position: 800px 0;
            }
        }

        .skeleton-row {
            height: 36px;
        }

        .skeleton-cell {
            height: 14px;
            width: 80%;
            border-radius: 6px;
            margin: 6px auto;
        }

        /***************************************************
 * üîç  T√åM KI·∫æM & N√öT L·ªåC TR·∫†NG TH√ÅI TR√äN B·∫¢NG SPCT
 ***************************************************/
        .search-filter-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
            padding: 4px 2px;
        }

        /* üé® Dropdown s·∫Øp x·∫øp hi·ªán ƒë·∫°i */
        #sort-select {
            min-width: 200px;
            height: 36px;
            padding: 4px 32px 4px 12px;
            /* t·∫°o kh√¥ng gian cho icon m≈©i t√™n */
            font-size: 0.9rem;
            font-weight: 500;
            color: #001f3f;
            /* xanh ƒë·∫≠m ƒë·ªÉ ƒë·ªìng b·ªô header */
            background: #fff;
            border: 1.5px solid #d0d7de;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            appearance: none;
            /* ·∫©n m≈©i t√™n m·∫∑c ƒë·ªãnh */
            background-image: linear-gradient(45deg, transparent 50%, #007bff 50%),
                linear-gradient(135deg, #007bff 50%, transparent 50%);
            background-position: calc(100% - 18px) 13px, calc(100% - 13px) 13px;
            /* v·ªã tr√≠ m≈©i t√™n */
            background-size: 6px 6px, 6px 6px;
            background-repeat: no-repeat;
            transition: all 0.25s ease;
        }

        /* üü¶ Hover: s√°ng nh·∫π vi·ªÅn + ƒë·ªï b√≥ng */
        #sort-select:hover {
            border-color: #007bff;
            box-shadow: 0 0 6px rgba(0, 123, 255, 0.15);
        }

        /* üü© Focus: vi·ªÅn ƒë·∫≠m v√† b√≥ng m·ªù */
        #sort-select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 6px rgba(0, 123, 255, 0.25);
        }

        /* üåô Dark mode (n·∫øu b·∫°n d√πng theme t·ªëi sau n√†y) */
        body.dark-mode #sort-select {
            background-color: #1f2937;
            color: #f3f4f6;
            border-color: #374151;
        }


        /*#sort-select {*/
        /*    min-width: 150px;*/
        /*    height: 34px;*/
        /*    font-size: 0.85rem;*/
        /*    border: 1px solid #ced4da;*/
        /*    border-radius: 6px;*/
        /*    background-color: #fff;*/
        /*    color: #333;*/
        /*    cursor: pointer;*/
        /*    transition: all 0.2s ease;*/
        /*}*/
        /*#sort-select:focus {*/
        /*    border-color: #80bdff;*/
        /*    box-shadow: 0 0 4px rgba(0, 123, 255, 0.3);*/
        /*}*/


        /* √î t√¨m ki·∫øm */
        #search-input {
            flex: 1 1 320px;
            max-width: 240px;
            height: 34px;
            font-size: 0.9rem;
            border-radius: 8px;
            border: 1px solid #ced4da;
            padding-left: 34px;
            background: #fff url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="%23aaa" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85Zm-5.242 1.156a5 5 0 1 1 0-10.001 5 5 0 0 1 0 10Z"/></svg>') no-repeat 10px center;
            background-size: 14px;
            transition: all 0.2s ease;
        }

        #search-input:focus {
            outline: none;
            border-color: #80bdff;
            box-shadow: 0 0 4px rgba(0, 123, 255, 0.3);
        }

        /* Nh√≥m n√∫t l·ªçc */
        #status-filters {
            display: flex;
            gap: 4px;
        }

        #status-filters .btn {
            min-width: 90px;
            font-size: 0.82rem;
            border-radius: 6px;
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            white-space: nowrap;
        }

        /* Hi·ªáu ·ª©ng hover nh·∫π */
        #status-filters .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
        }

        /* N√∫t ƒëang ch·ªçn */
        #status-filters .btn.active {
            color: #fff !important;
            background-color: #007bff !important;
            border-color: #007bff !important;
            box-shadow: 0 1px 3px rgba(0, 123, 255, 0.3);
        }

        /* Responsive ‚Äî khi thu nh·ªè */
        @media (max-width: 768px) {
            .search-filter-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 6px;
            }

            #search-input {
                max-width: 100%;
            }

            #status-filters {
                justify-content: center;
                width: 100%;
            }

            #status-filters .btn {
                flex: 1;
                min-width: 0;
                font-size: 0.8rem;
            }
        }


        /***************************************************
         * üîü  RESPONSIVE
         ***************************************************/
        @media (max-width: 992px) {
            .spct-form {
                flex-direction: column;
            }

            .col-right {
                flex-direction: column;
            }

            .btn-group-vertical {
                flex-direction: row;
                justify-content: center;
            }

            .btn-group-vertical .btn {
                width: auto;
                margin-right: 6px;
            }
        }

        @media (max-width: 768px) {
            .table-container {
                overflow-x: auto;
            }

            .table {
                min-width: 900px;
            }
        }

        @media (max-width: 576px) {
            .card-header {
                flex-direction: column;
                align-items: flex-start !important;
            }

            .table td,
            .table th {
                font-size: 0.8rem;
                padding: 4px;
            }
        }

        /***************************************************
 * üé® N√öT H√ÄNH ƒê·ªòNG (SUCCESS / WARNING / DANGER)
 *  - Gi·ªØ m√†u g·ªëc Bootstrap
 *  - Hover t·ªëi nh·∫π, kh√¥ng ƒë·ªïi m√†u
 *  - G·ªçn ƒë·∫πp, icon tr·∫Øng trung t√¢m
 ***************************************************/
        .btn-success,
        .btn-warning,
        .btn-danger {
            width: 36px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: none;
            border-radius: 6px;
            color: #fff !important;
            font-size: 14px;
            transition: filter 0.2s ease;
            box-shadow: none !important;
        }

        /* Gi·ªØ m√†u g·ªëc Bootstrap */
        .btn-success {
            background-color: #28a745 !important;
        }

        .btn-warning {
            background-color: #ffc107 !important;
            color: #212529 !important;
        }

        .btn-danger {
            background-color: #dc3545 !important;
        }

        /* Hover ‚Äì ch·ªâ t·ªëi ƒëi nh·∫π */
        .btn-success:hover,
        .btn-warning:hover,
        .btn-danger:hover {
            filter: brightness(0.85);
        }

        /* Khi click ‚Äì t·ªëi th√™m m·ªôt ch√∫t */
        .btn-success:active,
        .btn-warning:active,
        .btn-danger:active {
            filter: brightness(0.75);
        }

        /* Icon cƒÉn gi·ªØa */
        .btn-success i,
        .btn-warning i,
        .btn-danger i {
            font-size: 14px;
        }

        #upload-container.loading {
            opacity: 0.6;
            pointer-events: none;
            position: relative;
        }

        #upload-container.loading::after {
            content: "ƒêang x·ª≠ l√Ω...";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.8);
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 13px;
            color: #007bff;
        }

        /* üåü Hi·ªáu ·ª©ng m·ªü popup m∆∞·ª£t */
        .modal.fade .modal-dialog {
            transform: translateY(-20px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .modal.fade.show .modal-dialog {
            transform: translateY(0);
            opacity: 1;
        }

        /* üì¶ Popup form r·ªông h∆°n v√† tho√°ng */
        #spctModal .modal-content {
            border-radius: 10px;
            overflow: hidden;
            background: #fff;
        }

        /* üí° Header n·ªïi b·∫≠t */
        #spctModal .modal-header {
            background: linear-gradient(90deg, #007bff, #0056b3);
            color: #fff;
            border-bottom: none;
        }

        /* ‚öôÔ∏è N√∫t h√†nh ƒë·ªông gi·ªëng trang ch√≠nh */
        #spctModal .btn-group-vertical .btn {
            width: 72px;
            height: 32px;
            font-size: 0.8rem;
            border-radius: 8px;
            font-weight: 500;
        }

        .table input[readonly] {
            background-color: #f9f9f9;
            border-color: #e0e0e0;
            cursor: not-allowed;
            color: #666;
        }

        .table input.editable {
            background-color: #ffffff;
            border-color: var(--bs-alert-border, #007bff);
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
        }

        .btn-toggle-status {
            padding: 4px 6px;
            border-radius: 6px;
            transition: all 0.15s ease-in-out;
        }
        .btn-toggle-status:hover {
            transform: scale(1.05);
            opacity: 0.9;
        }

        /* üîµ Badge tr·∫°ng th√°i */
        .badge {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
        }

        .bg-success-subtle {
            background-color: #e6f9ed !important;
        }

        .bg-danger-subtle {
            background-color: #fdeaea !important;
        }
        .input-giaban[readonly] {
            background-color: #fafafa;
            color: #333;
        }


    </style>
</head>
<body>
    <section layout:fragment="content" class="page-content-section container-fluid">
        <div class="card shadow-sm border-0">
            <div class="card-header text-white py-2 d-flex justify-content-between align-items-center"
                style="background: linear-gradient(135deg, #007bff, #14F5F1)">
                <h5 class="mb-1 mt-1"><i class="fas fa-boxes"></i> Qu·∫£n l√Ω s·∫£n ph·∫©m chi ti·∫øt</h5>
            </div>

            <div class="card-body">
                <div class="table-container mt-3">
                    <!-- üîç √î t√¨m ki·∫øm + N√∫t l·ªçc tr·∫°ng th√°i -->
                    <div class="search-filter-bar">
                        <input type="text" id="search-input" class="form-control form-control-sm"
                            placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m chi ti·∫øt">
                        <button class="btn btn-primary btn-sm" id="btnBulkUpdateSPCT">
                            <i class="fas fa-save"></i> C·∫≠p nh·∫≠t
                        </button>

                        <div class="d-flex align-items-center gap-2">
                            <div class="position-relative" style="min-width:180px;">
                                <input type="text" class="form-control dropdown-input" id="sortSelectInput"
                                    placeholder="S·∫Øp x·∫øp theo" readonly value="Ng√†y c·∫≠p nh·∫≠t m·ªõi nh·∫•t">
                                <div class="dropdown-list" id="sortSelectList">
                                    <!-- M√£ SPCT -->
                                    <div class="dropdown-item" data-value="maSPCT-asc">M√£ SPCT ‚Üë (A ‚Üí Z)</div>
                                    <div class="dropdown-item" data-value="maSPCT-desc">M√£ SPCT ‚Üì (Z ‚Üí A)</div>
                                    <hr class="dropdown-divider my-1">
                                    <!-- Gi√° nh·∫≠p -->
                                    <div class="dropdown-item" data-value="giaNhap-asc">Gi√° nh·∫≠p ‚Üë (th·∫•p ‚Üí cao)</div>
                                    <div class="dropdown-item" data-value="giaNhap-desc">Gi√° nh·∫≠p ‚Üì (cao ‚Üí th·∫•p)</div>
                                    <!-- Gi√° b√°n -->
                                    <div class="dropdown-item" data-value="giaBan-asc">Gi√° b√°n ‚Üë (th·∫•p ‚Üí cao)</div>
                                    <div class="dropdown-item" data-value="giaBan-desc">Gi√° b√°n ‚Üì (cao ‚Üí th·∫•p)</div>
                                    <!-- S·ªë l∆∞·ª£ng -->
                                    <div class="dropdown-item" data-value="soLuong-asc">S·ªë l∆∞·ª£ng ‚Üë (√≠t ‚Üí nhi·ªÅu)</div>
                                    <div class="dropdown-item" data-value="soLuong-desc">S·ªë l∆∞·ª£ng ‚Üì (nhi·ªÅu ‚Üí √≠t)</div>
                                    <!-- K√≠ch c·ª° -->
                                    <div class="dropdown-item" data-value="kichCo-asc">K√≠ch c·ª° ‚Üë (nh·ªè ‚Üí l·ªõn)</div>
                                    <div class="dropdown-item" data-value="kichCo-desc">K√≠ch c·ª° ‚Üì (l·ªõn ‚Üí nh·ªè)</div>
                                    <hr class="dropdown-divider my-1">
                                    <!-- Ng√†y c·∫≠p nh·∫≠t -->
                                    <div class="dropdown-item" data-value="date-desc">Ng√†y c·∫≠p nh·∫≠t m·ªõi nh·∫•t</div>
                                    <div class="dropdown-item" data-value="date-asc">Ng√†y c·∫≠p nh·∫≠t c≈© nh·∫•t</div>
                                </div>
                            </div>

                            <div class="btn-group btn-group-sm" role="group" id="status-filters">
                                <button type="button" class="btn btn-outline-secondary active" data-status="all">
                                    <i class="fas fa-list"></i> T·∫•t c·∫£
                                </button>
                                <button type="button" class="btn btn-success" data-status="1">
                                    <i class="fas fa-check-circle"></i> ƒêang KD
                                </button>
                                <button type="button" class="btn btn-warning" data-status="0">
                                    <i class="fas fa-ban"></i> Ng·ª´ng KD
                                </button>
                            </div>
                        </div>
                    </div>

                    <table class="table table-bordered table-hover mb-0">
                        <thead class="thead-light text-center">
                        <tr>
                            <th><input type="checkbox" id="selectAllSPCT"></th>
                            <th>STT</th>
                            <th>·∫¢nh b√¨a</th>
                            <th>T√™n s·∫£n ph·∫©m</th>
                            <th>S·ªë l∆∞·ª£ng t·ªìn</th>
                            <th>Gi√° nh·∫≠p</th>
                            <th>Gi√° b√°n</th>
                            <th>M√†u s·∫Øc</th>
                            <th>K√≠ch c·ª°</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Thao t√°c</th>
                        </tr>
                        </thead>
                        <tbody id="spctTable">
                            <tr>
                                <td colspan="11" class="text-center text-muted">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- üìÑ Thanh ph√¢n trang -->
                    <div id="pagination" class="d-flex justify-content-center align-items-center mt-2"></div>
                </div>
            </div>
        </div>



    </section>
    <!-- ü™ü POPUP TH√äM / S·ª¨A S·∫¢N PH·∫®M CHI TI·∫æT -->
    <div class="modal fade" id="spctModal" tabindex="-1" aria-labelledby="spctModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content rounded-3 shadow-lg border-0">
                <div class="modal-header bg-primary text-white py-2">
                    <h6 class="modal-title fw-semibold" id="spctModalLabel">
                        <i class="fas fa-box-open"></i> Th√™m / C·∫≠p nh·∫≠t s·∫£n ph·∫©m chi ti·∫øt
                    </h6>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>

                <div class="modal-body p-3">
                    <!-- ‚úÖ GI·ªÆ NGUY√äN TO√ÄN B·ªò FORM G·ªêC -->
                    <form id="spct-form" class="spct-form">
                        <!-- C·ªôt tr√°i -->
                        <div class="col-left">
                            <!-- H√†ng 1 -->
                            <div class="form-row">
                                <div class="col">
                                    <input type="text" class="form-control" id="maSPCT" placeholder="M√£ SPCT (auto)"
                                        readonly>
                                </div>
                                <div class="col position-relative">
                                    <input type="text" class="form-control dropdown-input" id="sanPhamInput"
                                        placeholder="Ch·ªçn s·∫£n ph·∫©m" readonly>
                                    <div class="dropdown-list" id="sanPhamList"></div>
                                </div>
                            </div>

                            <!-- H√†ng 2 -->
                            <div class="form-row">
                                <div class="col position-relative">
                                    <input type="text" class="form-control dropdown-input" id="mauSacInput"
                                        placeholder="Ch·ªçn m√†u s·∫Øc" readonly>
                                    <div class="dropdown-list" id="mauSacList"></div>
                                </div>
                                <div class="col position-relative">
                                    <input type="text" class="form-control dropdown-input" id="kichCoInput"
                                        placeholder="Ch·ªçn k√≠ch c·ª°" readonly>
                                    <div class="dropdown-list" id="kichCoList"></div>
                                </div>
                                <div class="col position-relative">
                                    <input type="text" class="form-control dropdown-input" id="trangThaiInput"
                                        placeholder="Tr·∫°ng th√°i" readonly>
                                    <div class="dropdown-list" id="trangThaiList">
                                        <div class="dropdown-item" data-id="1">ƒêang kinh doanh</div>
                                        <div class="dropdown-item" data-id="0">Ng·ª´ng kinh doanh</div>
                                    </div>
                                </div>
                            </div>

                            <!-- H√†ng 3 -->
                            <div class="form-row">
                                <div class="col">
                                    <input type="number" class="form-control" id="giaBan" placeholder="ƒê∆°n gi√°">
                                </div>
                                <div class="col">
                                    <input type="number" class="form-control" id="soLuongTon"
                                        placeholder="S·ªë l∆∞·ª£ng t·ªìn">
                                </div>
                                <div class="col">
                                    <input type="text" class="form-control" id="nguoiTao" placeholder="Ng∆∞·ªùi t·∫°o"
                                        readonly>
                                </div>
                                <div class="col">
                                    <input type="text" class="form-control" id="nguoiCapNhat"
                                        placeholder="Ng∆∞·ªùi c·∫≠p nh·∫≠t" readonly>
                                </div>
                            </div>
                        </div>

                        <!-- C·ªôt ph·∫£i -->
                        <div class="col-right">
                            <div class="upload-container" id="upload-container">
                                <input type="file" id="image-input" multiple accept="image/*">
                                <div class="upload-placeholder">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <span>K√©o ho·∫∑c ch·ªçn ·∫£nh</span>
                                </div>
                                <div id="preview-container" class="preview-container"></div>
                            </div>

                            <div class="btn-group-vertical mt-2">
                                <button type="button" class="btn btn-primary btn-sm mb-2" id="btn-add">
                                    <i class="fas fa-plus"></i> <span>Th√™m</span>
                                </button>
                                <button type="button" class="btn btn-success btn-sm mb-2" id="btn-update">
                                    <i class="fas fa-save"></i> <span>L∆∞u</span>
                                </button>
                                <button type="reset" class="btn btn-warning btn-sm text-white" id="btn-reset">
                                    <i class="fas fa-undo"></i> <span>M·ªõi</span>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div layout:fragment="scripts">
<!--        <script th:inline="javascript">-->
<!--            const PRODUCT_ID = /*[[${sanPhamId}]]*/ null;-->
<!--        </script>-->

        <script>
            $(function () {

                // üß≠ ƒê·ªçc sanPhamId t·ª´ URL n·∫øu c√≥
                function getSanPhamIdFromUrl() {
                    const params = new URLSearchParams(window.location.search);
                    const id = params.get('id');
                    return id ? Number(id) : null;
                }

                const PRODUCT_ID = getSanPhamIdFromUrl();

                /* =====================================================
                * 1Ô∏è‚É£ H·∫∞NG S·ªê & API (CHU·∫®N H√ìA)
                * ===================================================== */

                // üë§ T√™n ng∆∞·ªùi thao t√°c m·∫∑c ƒë·ªãnh
                const ADMIN_NAME = 'Qu·∫£n tr·ªã vi√™n';

                // üåê T·∫≠p h·ª£p c√°c endpoint API RESTful
                const API = {
                    // üß© S·∫£n ph·∫©m chi ti·∫øt
                    SPCT_LIST: '/api/san-pham-chi-tiet/getAll',
                    SPCT_BY_SP: spId => `/api/san-pham-chi-tiet/by-san-pham?sanPhamId=${spId}`,
                    SPCT_ADD: '/api/san-pham-chi-tiet/add',
                    SPCT_UPDATE: '/api/san-pham-chi-tiet/bulk-update',
                    SPCT_DELETE: id => `/api/san-pham-chi-tiet/delete/${id}`,

                    // üè∑Ô∏è Danh m·ª•c c∆° b·∫£n
                    SP_LIST: '/api/san-pham/getAll',
                    MS_LIST: '/api/mau-sac/getAll',
                    KC_LIST: '/api/kich-co/getAll',

                    // üñºÔ∏è ·∫¢nh s·∫£n ph·∫©m
                    IMGS_BY_SPCT: id => `/api/san-pham-chi-tiet/anh/${id}`,
                    IMGS_UPLOAD: id => `/api/san-pham-chi-tiet/anh/upload/${id}`,
                    IMG_DELETE: imgId => `/api/san-pham-chi-tiet/anh/${imgId}`,
                    IMG_SET_COVER: (spctId, imgId) =>
                        `/api/san-pham-chi-tiet/anh/set-cover?spctId=${spctId}&imageId=${imgId}`
                };

                /* =====================================================
                * 2Ô∏è‚É£ DOM & STATE (CHU·∫®N H√ìA)
                * ===================================================== */

                // üß© Tham chi·∫øu c√°c ph·∫ßn t·ª≠ DOM ch√≠nh
                const $table = $('#spctTable');          // B·∫£ng d·ªØ li·ªáu s·∫£n ph·∫©m chi ti·∫øt
                const $upload = $('#upload-container');   // Khu v·ª±c upload ·∫£nh
                const $preview = $('#preview-container');  // V√πng hi·ªÉn th·ªã ·∫£nh preview
                const $fileInp = $('#image-input');        // Input file ·∫£nh

                // üß† Bi·∫øn tr·∫°ng th√°i
                let selectedId = null;     // ID c·ªßa SPCT ƒëang ch·ªçn
                let selectedFiles = [];       // Danh s√°ch ·∫£nh local ng∆∞·ªùi d√πng v·ª´a ch·ªçn
                let selectedCover = null;     // ·∫¢nh n√†o ƒë∆∞·ª£c ch·ªçn l√†m "·∫¢nh b√¨a"
                let cachedSpctList = [];       // Cache danh s√°ch SPCT t·ª´ API
                let searchKeyword = '';         // T√¨m ki·∫øm
                let currentStatus = 'all'; // all | 1 | 0
                let currentPage = 1;
                const pageSize = 8;
                let PRODUCT_INDEX = new Map(); // Map: id s·∫£n ph·∫©m ‚Üí m√£ s·∫£n ph·∫©m (d√πng ƒë·ªÉ sinh m√£ SPCT)

                /* =====================================================
                * 3Ô∏è‚É£ TI·ªÜN √çCH (CHU·∫®N H√ìA)
                * ===================================================== */

                // üß† H√†m ti·ªán √≠ch: sinh th√¥ng tin ng∆∞·ªùi t·∫°o / c·∫≠p nh·∫≠t chu·∫©n
                function buildAuditFields(isCreate = false) {
                    const CURRENT_ADMIN = window.ADMIN_NAME
                        || localStorage.getItem('adminName')
                        || 'ADMIN';

                    const now = new Date().toISOString().slice(0, 19); // chu·∫©n ISO yyyy-MM-dd'T'HH:mm:ss

                    // N·∫øu l√† t·∫°o m·ªõi
                    if (isCreate) {
                        return {
                            nguoiTao: CURRENT_ADMIN,
                            nguoiCapNhat: CURRENT_ADMIN,
                            ngayTao: now,
                            ngayCapNhat: now
                        };
                    }

                    // N·∫øu ch·ªâ c·∫≠p nh·∫≠t
                    return {
                        nguoiCapNhat: CURRENT_ADMIN,
                        ngayCapNhat: now
                    };
                }


                // üí∞ ƒê·ªãnh d·∫°ng ti·ªÅn t·ªá Vi·ªát Nam
                const formatVnd = n => {
                    if (n == null || Number.isNaN(Number(n))) return '-';
                    return Number(n).toLocaleString('vi-VN') + ' ‚Ç´';
                };


                /* =====================================================
                * 9Ô∏è‚É£ B·∫¢NG D·ªÆ LI·ªÜU
                * ===================================================== */

                function showSkeleton(tableId, rowCount = 6, colCount = 11) {
                    const $t = $(tableId).empty();
                    for (let i = 0; i < rowCount; i++) {
                        let row = '<tr class="skeleton-row">';
                        for (let j = 0; j < colCount; j++) {
                            row += `<td><div class="shimmer skeleton-cell"></div></td>`;
                        }
                        row += '</tr>';
                        $t.append(row);
                    }
                }

                /* =====================================================
                * üì¶ LOAD D·ªÆ LI·ªÜU CH√çNH & RENDER B·∫¢NG SPCT (11 C·ªòT) (NEW)
                * ===================================================== */

                // üîπ G·ªçi API l·∫•y to√†n b·ªô SPCT (ho·∫∑c theo s·∫£n ph·∫©m)
                async function fetchSPCTList(spId = null) {
                    const url = spId ? API.SPCT_BY_SP(spId) : API.SPCT_LIST;
                    console.log("üì° G·ªçi API:", url); // üëà ki·ªÉm tra log
                    const res = await axios.get(url);
                    return res.data || [];
                }

                // üß© H√†m s·∫Øp x·∫øp theo m√£ c√≥ c·∫£ ch·ªØ v√† s·ªë
                function compareMixedCode(a, b) {
                    if (!a) return -1;
                    if (!b) return 1;

                    // T√°ch ph·∫ßn ch·ªØ v√† s·ªë ƒë·∫ßu ti√™n
                    const matchA = a.match(/^([A-Za-z]+)(\d+)/);
                    const matchB = b.match(/^([A-Za-z]+)(\d+)/);

                    if (matchA && matchB) {
                        const prefixA = matchA[1];
                        const prefixB = matchB[1];
                        const numA = parseInt(matchA[2]);
                        const numB = parseInt(matchB[2]);

                        // So s√°nh ph·∫ßn ch·ªØ tr∆∞·ªõc
                        const cmpPrefix = prefixA.localeCompare(prefixB);
                        if (cmpPrefix !== 0) return cmpPrefix;

                        // N·∫øu ph·∫ßn ch·ªØ gi·ªëng ‚Üí so s√°nh ph·∫ßn s·ªë
                        if (numA !== numB) return numA - numB;
                    }

                    // N·∫øu kh√¥ng kh·ªõp ƒë·ªãnh d·∫°ng (fallback)
                    return a.localeCompare(b);
                }

                function compareKichCo(a, b) {
                    if (!a) return -1;
                    if (!b) return 1;

                    const numA = parseFloat(a);
                    const numB = parseFloat(b);

                    // N·∫øu c·∫£ hai l√† s·ªë (VD: 38, 39, 40)
                    if (!isNaN(numA) && !isNaN(numB)) {
                        return numA - numB;
                    }

                    // N·∫øu l√† k√Ω hi·ªáu (S, M, L, XL, XXL, v.v.)
                    const sizeOrder = ['XS', 'S', 'M', 'L', 'XL', 'XXL', 'XXXL'];
                    const idxA = sizeOrder.indexOf(a.toUpperCase());
                    const idxB = sizeOrder.indexOf(b.toUpperCase());
                    if (idxA >= 0 && idxB >= 0) return idxA - idxB;

                    // Fallback: s·∫Øp x·∫øp ch·ªØ th∆∞·ªùng
                    return a.localeCompare(b);
                }



                // üîπ L·ªçc, t√¨m ki·∫øm, s·∫Øp x·∫øp danh s√°ch
                function filterSPCTData() {
                    let data = [...cachedSpctList];

                    // T√¨m ki·∫øm theo t·ª´ kh√≥a
                    if (searchKeyword.trim() !== '') {
                        const kw = searchKeyword.toLowerCase();
                        data = data.filter(sp =>
                            (sp.tenSanPham || '').toLowerCase().includes(kw) ||
                            (sp.tenMau || '').toLowerCase().includes(kw) ||
                            (sp.tenKichCo || '').toLowerCase().includes(kw)
                        );
                    }

                    // L·ªçc theo tr·∫°ng th√°i
                    if (currentStatus !== 'all') {
                        data = data.filter(sp => String(sp.trangThai) === String(currentStatus));
                    }

                    // S·∫Øp x·∫øp
                    const sortVal = $('#sortSelectInput').data('value');
                    if (sortVal) {
                        switch (sortVal) {
                            /* üîπ M√É SPCT */
                            case 'maSPCT-asc':
                                data.sort((a, b) => compareMixedCode(a.maSpct, b.maSpct));
                                break;
                            case 'maSPCT-desc':
                                data.sort((a, b) => compareMixedCode(b.maSpct, a.maSpct));
                                break;

                            /* üîπ GI√Å NH·∫¨P */
                            case 'giaNhap-asc':
                                data.sort((a, b) => (a.giaNhap ?? 0) - (b.giaNhap ?? 0));
                                break;
                            case 'giaNhap-desc':
                                data.sort((a, b) => (b.giaNhap ?? 0) - (a.giaNhap ?? 0));
                                break;

                            /* üîπ GI√Å B√ÅN */
                            case 'giaBan-asc':
                                data.sort((a, b) => (a.giaBan ?? 0) - (b.giaBan ?? 0));
                                break;
                            case 'giaBan-desc':
                                data.sort((a, b) => (b.giaBan ?? 0) - (a.giaBan ?? 0));
                                break;

                            /* üîπ S·ªê L∆Ø·ª¢NG T·ªíN */
                            case 'soLuong-asc':
                                data.sort((a, b) => (a.soLuongTon ?? 0) - (b.soLuongTon ?? 0));
                                break;
                            case 'soLuong-desc':
                                data.sort((a, b) => (b.soLuongTon ?? 0) - (a.soLuongTon ?? 0));
                                break;

                            /* üîπ K√çCH C·ª† (x·ª≠ l√Ω ƒë∆∞·ª£c c·∫£ d·∫°ng "38", "39", "40" l·∫´n "S", "M", "L") */
                            case 'kichCo-asc':
                                data.sort((a, b) => compareKichCo(a.tenKichCo, b.tenKichCo));
                                break;
                            case 'kichCo-desc':
                                data.sort((a, b) => compareKichCo(b.tenKichCo, a.tenKichCo));
                                break;

                            /* üîπ NG√ÄY C·∫¨P NH·∫¨T */
                            case 'date-desc':
                                data.sort((a, b) => new Date(b.ngayCapNhat) - new Date(a.ngayCapNhat));
                                break;
                            case 'date-asc':
                                data.sort((a, b) => new Date(a.ngayCapNhat) - new Date(b.ngayCapNhat));
                                break;
                        }

                    }

                    return data;
                }

                // üîπ Ph√¢n trang & render b·∫£ng
                function renderSPCTTable() {
                    const data = filterSPCTData();
                    const total = data.length;
                    const start = (currentPage - 1) * pageSize;
                    const pageData = data.slice(start, start + pageSize);

                    $table.empty();

                    if (pageData.length === 0) {
                        $table.append(`<tr><td colspan="11" class="text-center text-muted py-3">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>`);
                        $('#pagination').html('');
                        return;
                    }

                    pageData.forEach((spct, idx) => {
                        const {
                            id,
                            tenSanPham,
                            tenMau,
                            tenKichCo,
                            giaNhap,
                            giaBan,
                            soLuongTon,
                            trangThai,
                            anhBiaUrl
                        } = spct;
                        const trangThaiText = trangThai === 1 ? 'ƒêang b√°n' : 'Ng·ª´ng b√°n';
                        const trangThaiClass = trangThai === 1
                            ? 'badge bg-success-subtle text-success border border-success'
                            : 'badge bg-danger-subtle text-danger border border-danger';
                        $table.append(`
        <tr class="text-center spct-row" data-id="${id}">
            <td><input type="checkbox" class="spct-checkbox" data-id="${id}"></td>
            <td>${start + idx + 1}</td>
            <td><img src="${anhBiaUrl || '/img/no-image.png'}"></td>
            <td class="truncate">${tenSanPham || '-'}</td>
            <td>
                <input type="number"
                            class="form-control form-control-sm input-slt"
                            data-id="${id}"
                            value="${soLuongTon ?? 0}"
                            min="0" readonly />
            </td>
            <td>${formatVnd(giaNhap)}</td>
            <td>
                <input type="text"
           class="form-control form-control-sm input-giaban text-end"
           data-id="${id}"
           value="${formatVnd(giaBan)}"
           data-raw="${giaBan ?? 0}"
           readonly />
            </td>
            <td>${tenMau || '-'}</td>
            <td>${tenKichCo || '-'}</td>
            <td><span class="${trangThaiClass}">${trangThaiText}</span></td>
            <td>
    <button class="btn btn-success btn-sm btn-edit" title="S·ª≠a">
        <i class="fas fa-edit"></i>
    </button>
    <button class="btn btn-sm ${trangThai === 1 ? 'btn-warning' : 'btn-success'} btn-toggle-status"
            data-id="${id}"
            data-status="${trangThai}"
            title="${trangThai === 1 ? 'Ng·ª´ng kinh doanh' : 'Kh√¥i ph·ª•c kinh doanh'}">
        <i class="fas ${trangThai === 1 ? 'fa-ban' : 'fa-undo'}"></i>
    </button>
</td>
        </tr>`);
                    });
                    renderPagination(total);
                }

                // üîπ Ph√¢n trang
                function renderPagination(total) {
                    const totalPages = Math.ceil(total / pageSize);
                    if (totalPages <= 1) return $('#pagination').empty();

                    let html = '<ul class="pagination pagination-sm mb-0">';
                    for (let i = 1; i <= totalPages; i++) {
                        html += `
        <li class="page-item ${i === currentPage ? 'active' : ''}">
            <a class="page-link" href="#">${i}</a>
        </li>`;
                    }
                    html += '</ul>';

                    $('#pagination').html(html);
                }

                // üîπ S·ª± ki·ªán click chuy·ªÉn trang
                $(document).off('click.paginate').on('click.paginate', '.page-link', function (e) {
                    e.preventDefault();
                    const page = parseInt($(this).text());
                    if (!isNaN(page)) {
                        currentPage = page;
                        renderSPCTTable();
                    }
                });

                // üîπ Load d·ªØ li·ªáu t·ªïng (g·ªçi API m·ªôt l·∫ßn r·ªìi render)
                async function loadSPCTData(spId = null) {
                    showSkeleton('#spctTable', 8, 11);
                    cachedSpctList = await fetchSPCTList(spId);
                    renderSPCTTable();
                    $('#selectAllSPCT').prop('checked', false);
                }

                // Khi t√¨m ki·∫øm
                $('#search-input').on('input', function() {
                    searchKeyword = $(this).val().trim();
                    currentPage = 1;
                    renderSPCTTable();
                });

                // Khi l·ªçc tr·∫°ng th√°i
                $('#status-filters .btn').on('click', function() {
                    $('#status-filters .btn').removeClass('active');
                    $(this).addClass('active');
                    currentStatus = $(this).data('status');
                    currentPage = 1;
                    renderSPCTTable();
                });

                // Khi ƒë·ªïi s·∫Øp x·∫øp
                $('#sortSelectList .dropdown-item').on('click', function() {
                    const val = $(this).data('value');
                    $('#sortSelectInput').data('value', val).val($(this).text().trim());
                    currentPage = 1;
                    renderSPCTTable();
                });

                //  üîΩ DROPDOWN "S·∫ÆP X·∫æP THEO" (HO·∫†T ƒê·ªòNG CHU·∫®N)

                // üü© M·ªü / ƒë√≥ng danh s√°ch khi click v√†o √¥ "S·∫Øp x·∫øp theo"
                $(document).off('click.sortOpen').on('click.sortOpen', '#sortSelectInput', function (e) {
                    e.stopPropagation();
                    $('#sortSelectList').toggleClass('show');
                });

                // üü® Khi ch·ªçn m·ªôt m·ª•c trong dropdown
                $(document).off('click.sortPick').on('click.sortPick', '#sortSelectList .dropdown-item', function (e) {
                    e.stopPropagation();
                    const value = $(this).data('value');
                    const text = $(this).text().trim();

                    // ‚úÖ G√°n gi√° tr·ªã v√† text v√†o input
                    $('#sortSelectInput').val(text).data('value', value);
                    $('#sortSelectList').removeClass('show');

                    // ‚úÖ G·ªçi l·∫°i render b·∫£ng v·ªõi th·ª© t·ª± m·ªõi
                    currentPage = 1;
                    renderSPCTTable();
                });

                // üü• ƒê√≥ng dropdown khi click ra ngo√†i
                $(document).off('click.sortClose').on('click.sortClose', function (e) {
                    if (!$(e.target).closest('#sortSelectInput, #sortSelectList').length) {
                        $('#sortSelectList').removeClass('show');
                    }
                });


                // L·∫Øng nghe s·ª± ki·ªán thay ƒë·ªïi
                $(document).on('input', '.input-slt, .input-giaban', function () {
                    const $input = $(this);
                    $input.addClass('changed'); // ƒë√°nh d·∫•u l√† c√≥ thay ƒë·ªïi
                });

                // Khi g√µ
                $(document).on('input', '.input-giaban', function () {
                    const val = Number($(this).val().replace(/[^\d]/g, '') || 0);
                    $(this).attr('data-raw', val);
                });

                // Khi blur
                $(document).on('blur', '.input-giaban', function () {
                    const val = Number($(this).val().replace(/[^\d]/g, '') || 0);
                    $(this).attr('data-raw', val);
                });

                // C·∫≠p nh·∫≠t h√†ng lo·∫°t
                $(document).on('click', '#btnBulkUpdateSPCT', async function () {

                    // ‚úÖ B·∫Øt bu·ªôc ƒë·ªìng b·ªô l·∫°i 1 l·∫ßn to√†n b·ªô gi√° tr∆∞·ªõc khi g·ª≠i
                    $('.input-giaban').each(function () {
                        const val = Number($(this).val().replace(/[^\d]/g, '') || 0);
                        $(this).attr('data-raw', val);
                    });
                    const reqs = [];
                    $('.spct-checkbox:checked').each(function () {
                        const id = $(this).data('id');
                        const soLuongTon = parseInt($(`.input-slt[data-id="${id}"]`).val() || 0);
                        const giaBan = Number($(`.input-giaban[data-id="${id}"]`).attr('data-raw') || 0);


                        reqs.push({
                            id,
                            soLuongTon,
                            giaBan,
                            ...buildAuditFields(false)
                        });
                    });
                    if (reqs.length === 0) {
                        alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m ƒë·ªÉ c·∫≠p nh·∫≠t!');
                        return;
                    }
                    if (!confirm(`X√°c nh·∫≠n c·∫≠p nh·∫≠t ${reqs.length} s·∫£n ph·∫©m chi ti·∫øt?`)) return;
                    try {
                        await axios.put('/api/san-pham-chi-tiet/bulk-update', reqs);
                        alert('‚úÖ ƒê√£ c·∫≠p nh·∫≠t th√†nh c√¥ng!');
                        loadSPCTData(PRODUCT_ID || null);
                    } catch (err) {
                        console.error(err);
                        alert('‚ùå L·ªói khi c·∫≠p nh·∫≠t!');
                    }
                });

                // ‚úÖ Khi click checkbox t·ª´ng d√≤ng
                // ‚úÖ Tick ch·ªçn ƒë·ªÉ ch·ªânh, b·ªè tick ƒë·ªÉ format l·∫°i
                $(document).on('change', '.spct-checkbox', function () {
                    const id = $(this).data('id');
                    const checked = $(this).is(':checked');
                    const $inputSLT = $(`.input-slt[data-id="${id}"]`);
                    const $inputGia = $(`.input-giaban[data-id="${id}"]`);

                    if (checked) {
                        // üü¢ Cho nh·∫≠p ‚Äî hi·ªÉn th·ªã s·ªë th√¥
                        const rawVal = String($inputGia.attr('data-raw') || $inputGia.val().replace(/[^\d]/g, '') || 0);
                        $inputGia.val(rawVal).prop('readonly', false).addClass('editable');
                        $inputSLT.prop('readonly', false).addClass('editable');
                    } else {
                        // üîµ Khi b·ªè tick ‚Äî l∆∞u l·∫°i gi√° m·ªõi, format v√† kh√≥a l·∫°i
                        const newRaw = Number($inputGia.val().replace(/[^\d]/g, '') || 0);
                        $inputGia.attr('data-raw', newRaw);
                        $inputGia.val(formatVnd(newRaw)).prop('readonly', true).removeClass('editable');
                        $inputSLT.prop('readonly', true).removeClass('editable');
                    }
                    // ‚úÖ Highlight d√≤ng khi tick
                    const $row = $(`tr.spct-row[data-id="${id}"]`);
                    if (checked) $row.addClass('selected');
                    else $row.removeClass('selected');

                });

                // üü¢ Khi ng∆∞·ªùi d√πng nh·∫≠p v√†o √¥ Gi√° b√°n ‚Äî c·∫≠p nh·∫≠t ngay data-raw ƒë·ªÉ ƒë·∫£m b·∫£o g·ª≠i ƒë√∫ng gi√° m·ªõi
                $(document).on('input', '.input-giaban', function () {
                    const val = Number($(this).val().replace(/[^\d]/g, '') || 0);
                    $(this).attr('data-raw', val);
                });

                // ‚úÖ Tick ch·ªçn t·∫•t c·∫£ (phi√™n b·∫£n m·ªõi)
                $(document).off('change.selectAllSPCT').on('change.selectAllSPCT', '#selectAllSPCT', function () {
                    const isChecked = $(this).is(':checked');
                    const $checkboxes = $('.spct-checkbox');

                    // NgƒÉn trigger ch·ªìng ch√©o: b·ªè trigger('change'), ch·ªâ ƒë·ªïi tr·∫°ng th√°i v√† x·ª≠ l√Ω th·ªß c√¥ng
                    $checkboxes.prop('checked', isChecked);

                    $checkboxes.each(function () {
                        const id = $(this).data('id');
                        const $inputSLT = $(`.input-slt[data-id="${id}"]`);
                        const $inputGia = $(`.input-giaban[data-id="${id}"]`);

                        if (isChecked) {
                            // ‚úÖ B·ªè format ƒë·ªÉ nh·∫≠p th√¥
                            const rawVal = String($inputGia.attr('data-raw') || $inputGia.val().replace(/[^\d]/g, '') || 0);
                            $inputGia.val(rawVal).prop('readonly', false).addClass('editable');
                            $inputSLT.prop('readonly', false).addClass('editable');
                        } else {
                            // ‚úÖ Reformat l·∫°i
                            const newRaw = Number($inputGia.val().replace(/[^\d]/g, '') || 0);
                            $inputGia.attr('data-raw', newRaw);
                            $inputGia.val(formatVnd(newRaw)).prop('readonly', true).removeClass('editable');
                            $inputSLT.prop('readonly', true).removeClass('editable');
                        }
                    });
                });

                // ‚úÖ ƒê·ªìng b·ªô gi√° tr·ªã gi·ªØa c√°c d√≤ng ƒë∆∞·ª£c ch·ªçn
                $(document).on('input', '.input-slt, .input-giaban', function () {
                    const $this = $(this);
                    const val = $this.val();
                    const cls = $this.hasClass('input-slt') ? '.input-slt' : '.input-giaban';

                    // Ch·ªâ ch·∫°y n·∫øu d√≤ng hi·ªán t·∫°i ƒëang ƒë∆∞·ª£c tick
                    const id = $this.data('id');
                    const isChecked = $(`.spct-checkbox[data-id="${id}"]`).is(':checked');
                    if (!isChecked) return;

                    // L·∫∑p qua c√°c d√≤ng kh√°c ƒë√£ tick ƒë·ªÉ ƒë·ªìng b·ªô
                    $('.spct-checkbox:checked').each(function () {
                        const otherId = $(this).data('id');
                        if (otherId !== id) {
                            $(`${cls}[data-id="${otherId}"]`).val(val);
                        }
                    });
                });

                // üîÅ CHUY·ªÇN ƒê·ªîI TR·∫†NG TH√ÅI SPCT
                $(document).on('click', '.btn-toggle-status', async function () {
                    const id = $(this).data('id');
                    const currentStatus = Number($(this).data('status'));
                    const newStatus = currentStatus === 1 ? 0 : 1;
                    const confirmMsg = currentStatus === 1
                        ? '‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën NG·ª™NG kinh doanh s·∫£n ph·∫©m n√†y kh√¥ng?'
                        : '‚úÖ B·∫°n c√≥ mu·ªën KINH DOANH L·∫†I s·∫£n ph·∫©m n√†y kh√¥ng?';
                    if (!confirm(confirmMsg)) return;
                    try {
                        await axios.put('/api/san-pham-chi-tiet/bulk-update', [{
                            id: id,
                            trangThai: newStatus,
                            ...buildAuditFields(false)
                        }]);
                        alert('‚úÖ C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng!');
                        await loadSPCTData(PRODUCT_ID || null);
                    } catch (err) {
                        console.error('‚ùå L·ªói khi c·∫≠p nh·∫≠t tr·∫°ng th√°i:', err);
                        alert('‚ùå Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i. Vui l√≤ng th·ª≠ l·∫°i!');
                    }
                });

                /* =====================================================
                * üöÄ KH·ªûI T·∫†O TRANG (INIT)
                * ===================================================== */
                async function init() {
                    try {
                        console.log('üöÄ Kh·ªüi t·∫°o trang Qu·∫£n l√Ω S·∫£n ph·∫©m Chi ti·∫øt.');
                        // 2Ô∏è‚É£ Hi·ªÉn th·ªã skeleton loading b·∫£ng tr∆∞·ªõc khi d·ªØ li·ªáu ƒë∆∞·ª£c t·∫£i
                        showSkeleton('#spctTable', 8, 11);
                        // // 3Ô∏è‚É£ T·∫£i d·ªØ li·ªáu dropdown (S·∫£n ph·∫©m / M√†u s·∫Øc / K√≠ch c·ª°)
                        // await loadDropdownData();
                        // 4Ô∏è‚É£ T·∫£i danh s√°ch s·∫£n ph·∫©m chi ti·∫øt (theo s·∫£n ph·∫©m n·∫øu c√≥)
                        console.log('üîé PRODUCT_ID =', PRODUCT_ID);
                        await loadSPCTData(PRODUCT_ID || null);
                        // // 5Ô∏è‚É£ Reset v√πng upload ·∫£nh (tr√°nh b·ªã g√°n tr·∫°ng th√°i c≈©)
                        // clearUploadState();
                        // $upload.removeClass('has-images');
                        // 6Ô∏è‚É£ G√°n s·∫Øp x·∫øp m·∫∑c ƒë·ªãnh
                        $('#sortSelectInput').data('value', 'date-desc').val('Ng√†y c·∫≠p nh·∫≠t m·ªõi nh·∫•t');
                        console.log('‚úÖ Trang Qu·∫£n l√Ω SPCT ƒë√£ kh·ªüi t·∫°o xong.');
                    } catch (err) {
                        console.error('‚ùå L·ªói khi kh·ªüi t·∫°o trang:', err);
                        alert('‚ùå Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu kh·ªüi t·∫°o. Vui l√≤ng th·ª≠ l·∫°i ho·∫∑c ki·ªÉm tra k·∫øt n·ªëi!');
                    }
                }

                // üëâ G·ªçi h√†m init() khi DOM ƒë√£ s·∫µn s√†ng
                $(document).ready(() => {
                    init();
                });

                // üßπ D·ªçn s·∫°ch khu v·ª±c upload ·∫£nh
                // function clearUploadState() {
                //     selectedFiles = [];
                //     selectedCover = null;
                //
                //     // N·∫øu v√πng preview t·ªìn t·∫°i, l√†m s·∫°ch n√≥
                //     if ($preview && $preview.length) $preview.empty();
                //
                //     // Reset input file ƒë·ªÉ c√≥ th·ªÉ ch·ªçn l·∫°i c√πng t√™n ·∫£nh
                //     if ($fileInp && $fileInp.length) $fileInp.val('');
                //
                //     // B·ªè tr·∫°ng th√°i ‚Äúc√≥ ·∫£nh‚Äù
                //     if ($upload && $upload.length) $upload.removeClass('has-images');
                // }

                // üßΩ D·ªçn s·∫°ch to√†n b·ªô form th√™m/s·ª≠a SPCT
                // function clearFormInputs() {
                //     // 1Ô∏è‚É£ Reset c√°c input text / number
                //     $('#maSPCT, #giaBan, #soLuongTon, #nguoiTao, #nguoiCapNhat').val('');
                //
                //     // 2Ô∏è‚É£ Reset dropdown t√πy ch·ªânh
                //     const dropdowns = ['#sanPhamInput', '#mauSacInput', '#kichCoInput', '#trangThaiInput'];
                //     dropdowns.forEach(sel => {
                //         const $el = $(sel);
                //         if ($el.length) {
                //             $el.val('').data('id', null);
                //             $el.trigger('input'); // bu·ªôc re-render UI n·∫øu c√≥ binding
                //         }
                //     });
                //
                //     // 3Ô∏è‚É£ X√≥a ·∫£nh preview n·∫øu c√≥
                //     clearUploadState();
                //
                //     // 4Ô∏è‚É£ Reset bi·∫øn tr·∫°ng th√°i trong JS
                //     selectedId = null;
                // }

                // // üñ±Ô∏è FIX: Khi th·∫£ chu·ªôt, n√∫t tr·ªü l·∫°i b√¨nh th∆∞·ªùng (tr√°nh stuck ‚Äúactive‚Äù)
                // $(document).off('mouseup.btnReset').on('mouseup.btnReset', '.btn', function () {
                //     const $btn = $(this);
                //     $btn.removeClass('active').blur();
                // });


                /* =====================================================
                * 4Ô∏è‚É£ HI·ªÜU ·ª®NG B√ìNG M·ªú KHI CU·ªòN ·∫¢NH (CHU·∫®N H√ìA)
                * ===================================================== */
                // let shadowTimeout = null;
                // let lastScrollLeft = 0;
                //
                // function updatePreviewShadow() {
                //     const el = $preview.get(0);
                //     if (!el) return;
                //
                //     const maxScroll = el.scrollWidth - el.clientWidth;
                //     const scrollLeft = el.scrollLeft;
                //
                //     // üßπ Reset tr·∫°ng th√°i c≈©
                //     $upload.removeClass('shadow-left shadow-right');
                //
                //     // N·∫øu kh√¥ng th·ªÉ cu·ªôn (√≠t ·∫£nh) ‚Üí b·ªè b√≥ng
                //     if (maxScroll <= 5) return;
                //
                //     // üü© Th√™m b√≥ng b√™n tr√°i / ph·∫£i t√πy v·ªã tr√≠ cu·ªôn
                //     if (scrollLeft > 5 && scrollLeft < maxScroll - 5) {
                //         $upload.addClass('shadow-left shadow-right');
                //     } else if (scrollLeft <= 5) {
                //         $upload.addClass('shadow-right');
                //     } else if (scrollLeft >= maxScroll - 5) {
                //         $upload.addClass('shadow-left');
                //     }
                //
                //     // üïì Debounce x√≥a b√≥ng sau khi d·ª´ng cu·ªôn ~1 gi√¢y
                //     clearTimeout(shadowTimeout);
                //     shadowTimeout = setTimeout(() => {
                //         if (Math.abs(el.scrollLeft - lastScrollLeft) < 2) {
                //             $upload.removeClass('shadow-left shadow-right');
                //         }
                //     }, 1000);
                //
                //     lastScrollLeft = scrollLeft;
                // }
                //
                // // üñ±Ô∏è G·ªçi update m·ªói khi ng∆∞·ªùi d√πng cu·ªôn ho·∫∑c t∆∞∆°ng t√°c
                // $preview
                //     .off('scroll wheel touchmove mouseup resize')
                //     .on('scroll', updatePreviewShadow)
                //     .on('wheel touchmove mouseup', () => setTimeout(updatePreviewShadow, 100));
                //
                // // ü™Ñ G·ªçi l·∫°i khi window resize (ph√≤ng tr∆∞·ªùng h·ª£p chi·ªÅu r·ªông thay ƒë·ªïi)
                // $(window).off('resize.previewShadow').on('resize.previewShadow', () => {
                //     setTimeout(updatePreviewShadow, 150);
                // });



                /* =====================================================
                * 5Ô∏è‚É£ RENDER PREVIEW ·∫¢NH LOCAL (CHU·∫®N H√ìA)
                * ===================================================== */
            //     function renderPreviewFromFiles(files) {
            //         if (!files || files.length === 0) return;
            //
            //         // üß© N·∫øu ch∆∞a c√≥ n√∫t ‚Äú+‚Äù th√¨ th√™m v√†o ƒë·∫ßu preview container
            //         if ($preview.find('.image-add-box').length === 0) {
            //             const $addBox = $('<div class="image-add-box"><i class="fas fa-plus"></i></div>');
            //             $addBox.off('click').on('click', () => $fileInp.trigger('click'));
            //             $preview.prepend($addBox);
            //         }
            //
            //         const $addBox = $preview.find('.image-add-box');
            //
            //         // üñºÔ∏è Duy·ªát danh s√°ch file m·ªõi ƒë·ªÉ render preview
            //         files.forEach(file => {
            //             const reader = new FileReader();
            //
            //             reader.onload = e => {
            //                 // üß± T·∫°o ph·∫ßn t·ª≠ preview
            //                 const $box = $(`
            //     <div class="image-box" data-local="true" title="${file.name}">
            //         <img src="${e.target.result}" alt="${file.name}">
            //         <div class="image-actions">
            //             <button type="button" class="btn btn-xs btn-warning btn-del-local" title="X√≥a ·∫£nh n√†y">
            //                 <i class="fas fa-times"></i>
            //             </button>
            //         </div>
            //         <span class="badge badge-light border image-badge btn-mark-cover" title="ƒê·∫∑t l√†m ·∫£nh b√¨a" style="cursor:pointer">
            //             ·∫¢nh b√¨a
            //         </span>
            //     </div>
            // `);
            //
            //                 // ‚ùå X√≥a ·∫£nh local
            //                 $box.find('.btn-del-local').off('click').on('click', () => {
            //                     selectedFiles = selectedFiles.filter(f => f !== file);
            //                     $box.fadeOut(200, () => $box.remove());
            //                     if ($preview.find('.image-box').length <= 1) {
            //                         $upload.removeClass('has-images');
            //                     }
            //                 });
            //
            //                 // üåü Ch·ªçn ·∫£nh b√¨a (local)
            //                 $box.find('.btn-mark-cover').off('click').on('click', () => {
            //                     $preview.find('.image-box').removeClass('cover');
            //                     $box.addClass('cover');
            //                     selectedCover = file.name; // ‚úÖ Ghi nh·∫≠n t√™n file ·∫£nh b√¨a
            //                 });
            //
            //                 // ‚úÖ Th√™m ·∫£nh sau n√∫t "+"
            //                 $addBox.after($box);
            //             };
            //
            //             // üöÄ ƒê·ªçc file th√†nh base64
            //             reader.readAsDataURL(file);
            //         });
            //
            //         // üü© C·∫≠p nh·∫≠t tr·∫°ng th√°i v√πng upload
            //         $upload.addClass('has-images');
            //         updatePreviewShadow();
            //     }


                /* =====================================================
                * 6Ô∏è‚É£ S·ª∞ KI·ªÜN UPLOAD ·∫¢NH LOCAL (CHU·∫®N H√ìA - FIX V√íNG L·∫∂P, TR√ôNG FILE)
                * ===================================================== */

                // üü© Khi click v√†o v√πng upload (ch·ªâ cho ph√©p khi ch∆∞a c√≥ ·∫£nh)
                // $upload.off('click').on('click', function (e) {
                //     // N·∫øu ƒë√£ c√≥ ·∫£nh trong v√πng => KH√îNG m·ªü h·ªôp ch·ªçn file
                //     if ($upload.hasClass('has-images')) return;
                //
                //     // N·∫øu ng∆∞·ªùi d√πng click tr·ª±c ti·∫øp v√†o input file => b·ªè qua (tr√°nh v√≤ng l·∫∑p)
                //     if ($(e.target).is('#image-input')) return;
                //
                //     // M·ªü h·ªôp ch·ªçn file an to√†n
                //     $fileInp.trigger('click');
                // });

                // üü¶ Khi ng∆∞·ªùi d√πng ch·ªçn file
                // $fileInp.off('change').on('change', function () {
                //     const newFiles = Array.from(this.files || []);
                //     if (newFiles.length === 0) return;
                //
                //     // üß© G·ªôp file m·ªõi + file c≈© (n·∫øu c√≥) v√† lo·∫°i b·ªè tr√πng theo t√™n ho·∫∑c size
                //     const allFiles = [...selectedFiles, ...newFiles];
                //     selectedFiles = allFiles.filter(
                //         (f, index, arr) =>
                //             index === arr.findIndex(x => x.name === f.name && x.size === f.size)
                //     );
                //
                //     // üßπ Reset input ƒë·ªÉ l·∫ßn sau ch·ªçn c√πng file v·∫´n trigger ƒë∆∞·ª£c "change" event
                //     this.value = '';
                //
                //     // üñºÔ∏è Render l·∫°i preview
                //     renderPreviewFromFiles(selectedFiles);
                // });



                /* =====================================================
                * 7Ô∏è‚É£ DROPDOWN CH·ªåN D·ªÆ LI·ªÜU (ƒê√É FIX HO·∫†T ƒê·ªòNG C·ª¶A "S·∫ÆP X·∫æP THEO")
                * ===================================================== */

                // üü© M·ªü/ƒë√≥ng danh s√°ch dropdown khi click v√†o input
                // $(document).off('click.dd').on('click.dd', '.dropdown-input', function (e) {
                //     e.stopPropagation();
                //     const listId = '#' + $(this).attr('id').replace('Input', 'List');
                //
                //     // N·∫øu l√† dropdown S·∫Øp x·∫øp -> ƒë·ªÉ handler ri√™ng x·ª≠ l√Ω
                //     if (listId === '#sortSelectList') return;
                //
                //     // ·∫®n t·∫•t c·∫£ danh s√°ch kh√°c
                //     $('.dropdown-list').not(listId).removeClass('show');
                //
                //     // Toggle danh s√°ch t∆∞∆°ng ·ª©ng
                //     $(listId).toggleClass('show');
                // });

                // üü® Khi ng∆∞·ªùi d√πng ch·ªçn m·ªôt item trong dropdown th∆∞·ªùng (SP, M√†u, K√≠ch c·ª°, Tr·∫°ng th√°i)
                // $(document).off('click.ddItem').on('click.ddItem', '.dropdown-list:not(#sortSelectList) .dropdown-item', function (e) {
                //     e.stopPropagation();
                //
                //     const id = $(this).data('id');
                //     const text = $(this).text().trim();
                //     const listId = $(this).parent().attr('id');
                //     const inputId = '#' + listId.replace('List', 'Input');
                //
                //     // G√°n gi√° tr·ªã v√† id v√†o input
                //     $(inputId).val(text).data('id', id);
                //
                //     // ·∫®n dropdown sau khi ch·ªçn
                //     $(this).parent().removeClass('show');
                // });

                // üü• ·∫®n dropdown khi click ra ngo√†i
                // $(document).off('click.ddClose').on('click.ddClose', function (e) {
                //     if (!$(e.target).closest('.dropdown-input, .dropdown-list').length) {
                //         $('.dropdown-list').removeClass('show');
                //     }
                // });


                /* =====================================================
                 * 7.1Ô∏è‚É£ DROPDOWN "S·∫ÆP X·∫æP THEO" (RI√äNG BI·ªÜT)
                 * ===================================================== */

                // üü© M·ªü dropdown s·∫Øp x·∫øp
                // $(document).off('click.sortOpen').on('click.sortOpen', '#sortSelectInput', function (e) {
                //     e.stopPropagation();
                //     $('#sortSelectList').toggleClass('show');
                // });

                // üü® Khi ch·ªçn item trong dropdown s·∫Øp x·∫øp
                // $(document).off('click.sortPick').on('click.sortPick', '#sortSelectList .dropdown-item', function (e) {
                //     e.stopPropagation();
                //     const value = $(this).data('value');
                //     const text = $(this).text().trim();
                //
                //     $('#sortSelectInput').val(text).data('value', value);
                //     $('#sortSelectList').removeClass('show');
                //
                //     // G·ªçi l·∫°i h√†m render b·∫£ng sau khi ƒë·ªïi th·ª© t·ª± s·∫Øp x·∫øp
                //     filterAndRenderTable();
                // });

                // üü• Click ngo√†i ƒë·ªÉ ƒë√≥ng dropdown
                // $(document).off('click.sortClose').on('click.sortClose', function (e) {
                //     if (!$(e.target).closest('#sortSelectInput, #sortSelectList').length) {
                //         $('#sortSelectList').removeClass('show');
                //     }
                // });


                /* =====================================================
                * 8Ô∏è‚É£ LOAD D·ªÆ LI·ªÜU DROPDOWN T·ª™ API (CHU·∫®N)
                * ===================================================== */
        //         async function loadDropdownData() {
        //             const [sp, ms, kc] = await Promise.all([
        //                 axios.get(API.SP_LIST),
        //                 axios.get(API.MS_LIST),
        //                 axios.get(API.KC_LIST)
        //             ]);
        //
        //             // üß© L√†m tr·ªëng danh s√°ch c≈©
        //             $('#sanPhamList').empty();
        //             $('#mauSacList').empty();
        //             $('#kichCoList').empty();
        //
        //             // üß© L√†m m·ªõi PRODUCT_INDEX (map id -> m√£ s·∫£n ph·∫©m)
        //             PRODUCT_INDEX.clear();
        //
        //             // üîπ Duy·ªát danh s√°ch s·∫£n ph·∫©m
        //             sp.data.forEach(p => {
        //                 PRODUCT_INDEX.set(p.id, p.maSanPham || p.maSP || 'SP');
        //                 $('#sanPhamList').append(`
        //     <div class="dropdown-item"
        //          data-id="${p.id}"
        //          data-code="${p.maSanPham || p.maSP || ''}"
        //          data-name="${p.tenSanPham || ''}">
        //          ${p.tenSanPham}
        //     </div>
        // `);
        //             });
        //
        //             // üîπ Duy·ªát m√†u s·∫Øc
        //             ms.data.forEach(m => {
        //                 $('#mauSacList').append(`
        //     <div class="dropdown-item" data-id="${m.id}">
        //         ${m.tenMau}
        //     </div>
        // `);
        //             });
        //
        //             // üîπ Duy·ªát k√≠ch c·ª°
        //             kc.data.forEach(k => {
        //                 $('#kichCoList').append(`
        //     <div class="dropdown-item" data-id="${k.id}">
        //         ${k.tenKichCo}
        //     </div>
        // `);
        //             });
        //         }







                /* =====================================================
                *  H√ÄM T·∫†O THANH PH√ÇN TRANG (1, 2, 3, ...)
                * ===================================================== */
                // function renderPagination(totalPages) {
                //     const $pg = $('#pagination');
                //     $pg.empty();
                //
                //     // if (totalPages <= 1) return; // ·∫©n n·∫øu ch·ªâ 1 trang
                //
                //     let html = `<nav><ul class="pagination pagination-sm mb-0">`;
                //
                //     // N√∫t tr∆∞·ªõc
                //     html += `<li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                //     <a class="page-link" href="#" data-page="${currentPage - 1}">&laquo;</a>
                //     </li>`;
                //
                //     // C√°c s·ªë trang
                //     for (let i = 1; i <= totalPages; i++) {
                //         html += `<li class="page-item ${i === currentPage ? 'active' : ''}">
                //     <a class="page-link" href="#" data-page="${i}">${i}</a>
                //     </li>`;
                //     }
                //
                //     // N√∫t sau
                //     html += `<li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                //     <a class="page-link" href="#" data-page="${currentPage + 1}">&raquo;</a>
                //     </li>`;
                //
                //     html += `</ul></nav>`;
                //     $pg.html(html);
                // }

                /* =====================================================
                 *  S·ª∞ KI·ªÜN CLICK PH√ÇN TRANG
                 * ===================================================== */
                // $(document).on('click', '#pagination .page-link', function (e) {
                //     e.preventDefault();
                //     const page = Number($(this).data('page'));
                //     if (!page || page === currentPage) return;
                //     currentPage = page;
                //     filterAndRenderTable();
                // });




                /* =====================================================
                * üîü CRUD HANDLERS (TH√äM / L∆ØU / X√ìA / XEM)
                * ===================================================== */

                // üü© TH√äM M·ªöI SPCT (c√≥ ki·ªÉm tra tr√πng v√† c·ªông d·ªìn SLT)
                // $('#btn-add').on('click', async function () {
                //     try {
                //         const sanPhamId = $('#sanPhamInput').data('id');
                //         const mauSacId = $('#mauSacInput').data('id');
                //         const kichCoId = $('#kichCoInput').data('id');
                //         const trangThai = $('#trangThaiInput').data('id') ?? 1;
                //
                //         if (!sanPhamId || !mauSacId || !kichCoId) {
                //             alert('‚ö†Ô∏è Vui l√≤ng ch·ªçn ƒë·∫ßy ƒë·ªß S·∫£n ph·∫©m, M√†u s·∫Øc, K√≠ch c·ª°!');
                //             return;
                //         }
                //
                //         const dto = {
                //             maSPCT: $('#maSPCT').val(),
                //             giaBan: Number($('#giaBan').val() || 0),
                //             soLuongTon: Number($('#soLuongTon').val() || 0),
                //             trangThai,
                //             sanPhamId, mauSacId, kichCoId,
                //             nguoiTao: ADMIN_NAME,
                //             nguoiCapNhat: ADMIN_NAME,
                //             ngayTao: nowIso(),
                //             ngayCapNhat: nowIso()
                //         };
                //
                //         // üîç 1Ô∏è‚É£ Ki·ªÉm tra xem ƒë√£ t·ªìn t·∫°i SPCT c√≥ c√πng S·∫£n ph·∫©m - M√†u s·∫Øc - K√≠ch c·ª° ch∆∞a
                //         const resAll = await axios.get(API.SPCT_LIST);
                //         const existing = (resAll.data || []).find(spct =>
                //             spct.sanPhamId === sanPhamId &&
                //             spct.mauSacId === mauSacId &&
                //             spct.kichCoId === kichCoId
                //         );
                //
                //         // üîπ N·∫øu ƒë√£ t·ªìn t·∫°i
                //         if (existing) {
                //             const confirmAdd = confirm(`‚ö†Ô∏è S·∫£n ph·∫©m chi ti·∫øt n√†y ƒë√£ t·ªìn t·∫°i!\nB·∫°n c√≥ mu·ªën C·ªòNG D·ªíN s·ªë l∆∞·ª£ng t·ªìn kh√¥ng?\n\n‚Ä¢ Hi·ªán t·∫°i: ${existing.soLuongTon}\n‚Ä¢ Nh·∫≠p th√™m: ${dto.soLuongTon}`);
                //             if (confirmAdd) {
                //                 // üßÆ C·ªông d·ªìn s·ªë l∆∞·ª£ng t·ªìn
                //                 const newQty = Number(existing.soLuongTon) + Number(dto.soLuongTon);
                //                 await axios.put(API.SPCT_UPDATE, {
                //                     id: existing.id,
                //                     sanPhamId: existing.sanPhamId,
                //                     mauSacId: existing.mauSacId,
                //                     kichCoId: existing.kichCoId,
                //                     giaBan: dto.giaBan || existing.giaBan,
                //                     soLuongTon: newQty,
                //                     trangThai: existing.trangThai,
                //                     nguoiCapNhat: ADMIN_NAME,
                //                     ngayCapNhat: nowIso()
                //                 });
                //                 alert(`‚úÖ ƒê√£ c·ªông d·ªìn s·ªë l∆∞·ª£ng t·ªìn th√†nh c√¥ng!\nS·ªë l∆∞·ª£ng m·ªõi: ${newQty}`);
                //                 await loadSPCTFiltered();
                //             } else {
                //                 alert('‚ö†Ô∏è S·∫£n ph·∫©m chi ti·∫øt n√†y ƒë√£ t·ªìn t·∫°i, d·ªØ li·ªáu ƒë∆∞·ª£c gi·ªØ nguy√™n!');
                //             }
                //             return;
                //         }
                //
                //         // üîπ N·∫øu ch∆∞a t·ªìn t·∫°i ‚Üí th√™m m·ªõi b√¨nh th∆∞·ªùng
                //         const res = await axios.post(API.SPCT_ADD, dto);
                //         const savedId = res?.data?.id;
                //         if (savedId) {
                //             await uploadImages(savedId);
                //         }
                //
                //         alert('‚úÖ Th√™m s·∫£n ph·∫©m chi ti·∫øt th√†nh c√¥ng!');
                //         clearUploadState();
                //         clearFormInputs();
                //         fillCreatorUpdaterDefaults();
                //         await loadSPCTFiltered();
                //
                //     } catch (err) {
                //         console.error('‚ùå L·ªói khi th√™m SPCT:', err);
                //         alert('‚ùå Kh√¥ng th·ªÉ th√™m s·∫£n ph·∫©m chi ti·∫øt. Vui l√≤ng ki·ªÉm tra l·∫°i d·ªØ li·ªáu!');
                //     }
                // });



                // üü¶ C·∫¨P NH·∫¨T SPCT
                // $('#btn-update').on('click', async function () {
                //     try {
                //         if (!selectedId) return alert('‚ö†Ô∏è H√£y ch·ªçn m·ªôt d√≤ng ƒë·ªÉ c·∫≠p nh·∫≠t!');
                //
                //         const dto = {
                //             id: selectedId,
                //             sanPhamId: $('#sanPhamInput').data('id'),
                //             mauSacId: $('#mauSacInput').data('id'),
                //             kichCoId: $('#kichCoInput').data('id'),
                //             giaBan: Number($('#giaBan').val() || 0),
                //             soLuongTon: Number($('#soLuongTon').val() || 0),
                //             trangThai: $('#trangThaiInput').data('id') ?? 1,
                //             nguoiCapNhat: ADMIN_NAME,
                //             ngayCapNhat: nowIso()
                //         };
                //
                //         await axios.put(API.SPCT_UPDATE, dto);
                //         await uploadImages(selectedId);
                //
                //         alert('‚úÖ C·∫≠p nh·∫≠t s·∫£n ph·∫©m chi ti·∫øt th√†nh c√¥ng!');
                //         await loadSPCTFiltered();
                //
                //     } catch (err) {
                //         console.error('‚ùå L·ªói khi c·∫≠p nh·∫≠t SPCT:', err);
                //         alert('‚ùå C·∫≠p nh·∫≠t th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i!');
                //     }
                // });





                // üü® XEM CHI TI·∫æT / CH·ªåN D√íNG
                // $(document).on('click', '.btn-detail, .spct-row', async function () {
                //     const $row = $(this).closest('tr');
                //     const id = $row.data('id');
                //     const spct = cachedSpctList.find(x => String(x.id) === String(id));
                //     if (!spct) return;
                //
                //     selectedId = id;
                //     $('.spct-row').removeClass('selected');
                //     $row.addClass('selected');
                //
                //     $('#maSPCT').val(spct.maSPCT || '');
                //     $('#sanPhamInput').val(spct.tenSanPham).data('id', spct.sanPhamId);
                //     $('#mauSacInput').val(spct.tenMau).data('id', spct.mauSacId);
                //     $('#kichCoInput').val(spct.tenKichCo).data('id', spct.kichCoId);
                //     $('#trangThaiInput').val(spct.trangThai === 1 ? 'ƒêang kinh doanh' : 'Ng·ª´ng kinh doanh')
                //         .data('id', spct.trangThai);
                //     $('#giaBan').val(spct.giaBan || '');
                //     $('#soLuongTon').val(spct.soLuongTon || '');
                //     $('#nguoiTao').val(spct.nguoiTao || ADMIN_NAME);
                //     $('#nguoiCapNhat').val(ADMIN_NAME);
                //
                //     // üñºÔ∏è Load to√†n b·ªô ·∫£nh li√™n quan
                //     await loadExistingImagesFor(id);
                // });


                // üßπ N√öT L√ÄM M·ªöI FORM
                // $('#btn-reset').on('click', function (e) {
                //     e.preventDefault();
                //     clearFormInputs();
                //     clearUploadState();
                //     fillCreatorUpdaterDefaults();
                //     $('.spct-row').removeClass('selected');
                // });


                /* =====================================================
                * 11Ô∏è‚É£ UPLOAD ·∫¢NH L√äN SERVER (CHU·∫®N H√ìA)
                * ===================================================== */
                /* =====================================================
                * ‚úÖ FIXED FINAL v4 ‚Äî KH·∫ÆC PH·ª§C NH·∫§P NH√ÅY ·∫¢NH B√åA
                * ===================================================== */
                // async function uploadImages(spctId) {
                //     try {
                //         if (!spctId) return console.warn('‚ö†Ô∏è uploadImages() b·ªã g·ªçi khi ch∆∞a c√≥ spctId.');
                //         if (!selectedFiles || selectedFiles.length === 0) return console.info('üìÅ Kh√¥ng c√≥ ·∫£nh m·ªõi ƒë·ªÉ upload.');
                //
                //         const formData = new FormData();
                //         selectedFiles.forEach(f => formData.append('files', f));
                //
                //         // Hi·ªÉn th·ªã tr·∫°ng th√°i ch·ªù (UX)
                //         $upload.addClass('loading');
                //
                //         const res = await axios.post(API.IMGS_UPLOAD(spctId), formData, {
                //             headers: { 'Content-Type': 'multipart/form-data' },
                //             onUploadProgress: (evt) => {
                //                 const percent = Math.round((evt.loaded * 100) / evt.total);
                //                 console.log(`Uploading... ${percent}%`);
                //             }
                //         });
                //
                //         if (res.status === 200) console.log('‚úÖ Upload ·∫£nh th√†nh c√¥ng.');
                //
                //         // üßπ D·ªçn state local
                //         $fileInp.val('');
                //         const lastCover = selectedCover;
                //         selectedFiles = [];
                //         selectedCover = null;
                //
                //         // üîπ N·∫øu c√≥ ch·ªçn ·∫£nh b√¨a local ‚Üí ƒë·∫∑t cover ngay, KH√îNG render l·∫°i tr∆∞·ªõc khi set
                //         if (lastCover) {
                //             try {
                //                 const res2 = await axios.get(API.IMGS_BY_SPCT(spctId));
                //                 const uploaded = Array.isArray(res2.data) ? res2.data : [];
                //                 const matched = uploaded.find(i =>
                //                     i.tenTapTin && lastCover && i.tenTapTin.includes(lastCover)
                //                 );
                //
                //                 if (matched) {
                //                     // üü¢ G·ªçi API set-cover v√† CH·ªú ho√†n t·∫•t tr∆∞·ªõc khi render l·∫°i
                //                     await axios.post(API.IMG_SET_COVER(spctId, matched.id));
                //                     console.log('‚úÖ ƒê√£ ƒë·∫∑t ·∫£nh b√¨a m·ªõi:', matched.tenTapTin);
                //                 }
                //             } catch (err) {
                //                 console.warn('‚ö†Ô∏è Kh√¥ng th·ªÉ ƒë·∫∑t ·∫£nh b√¨a t·ª± ƒë·ªông sau upload:', err);
                //             }
                //         }
                //
                //         // üü© Sau khi ch·∫Øc ch·∫Øn cover ƒë√£ c·∫≠p nh·∫≠t ‚Üí render l·∫°i preview 1 l·∫ßn duy nh·∫•t
                //         await loadExistingImagesFor(spctId);
                //
                //     } catch (err) {
                //         console.error('‚ùå L·ªói upload ·∫£nh:', err);
                //         alert('‚ùå Kh√¥ng th·ªÉ t·∫£i ·∫£nh l√™n m√°y ch·ªß. Vui l√≤ng th·ª≠ l·∫°i!');
                //     } finally {
                //         $upload.removeClass('loading');
                //     }
                // }



                /* =====================================================
                * 12Ô∏è‚É£ LOAD ·∫¢NH C≈® T·ª™ SERVER (CHU·∫®N H√ìA)
                * ===================================================== */
            //     async function loadExistingImagesFor(spctId) {
            //         if (!spctId) {
            //             console.warn('‚ö†Ô∏è loadExistingImagesFor() ƒë∆∞·ª£c g·ªçi m√† kh√¥ng c√≥ spctId.');
            //             return;
            //         }
            //
            //         try {
            //             // üü¶ G·ªçi API l·∫•y danh s√°ch ·∫£nh
            //             const res = await axios.get(API.IMGS_BY_SPCT(spctId));
            //             const images = Array.isArray(res.data) ? res.data : [];
            //
            //             // üßπ Reset bi·∫øn & giao di·ªán preview
            //             selectedCover = null;
            //             $preview.empty();
            //
            //             // üü© ƒê·∫£m b·∫£o lu√¥n c√≥ n√∫t th√™m ·∫£nh
            //             const $addBox = $('<div class="image-add-box"><i class="fas fa-plus"></i></div>');
            //             $addBox.off('click').on('click', () => $fileInp.trigger('click'));
            //             $preview.append($addBox);
            //
            //             // üü® N·∫øu kh√¥ng c√≥ ·∫£nh => ch·ªâ hi·ªán n√∫t +
            //             if (images.length === 0) {
            //                 $upload.removeClass('has-images');
            //                 updatePreviewShadow();
            //                 return;
            //             }
            //
            //             // üü™ C√≥ ·∫£nh => b·∫≠t tr·∫°ng th√°i c√≥ ·∫£nh
            //             $upload.addClass('has-images');
            //
            //             // ‚ùó Tr∆∞·ªõc khi render m·ªõi ‚Üí ƒë·∫£m b·∫£o kh√¥ng c√≤n .cover c≈©
            //             $preview.find('.image-box').removeClass('cover');
            //
            //             // üñºÔ∏è Render danh s√°ch ·∫£nh
            //             images.forEach(img => {
            //                 // const isCover = img.isCover === true || img.isCover === 1;
            //                 const isCover = img.laAnhBia === true || img.laAnhBia === 1;
            //                 const $box = $(`
            //     <div class="image-box ${isCover ? 'cover' : ''}"
            //          data-id="${img.id}"
            //          data-server="true">
            //         <img src="${img.duongDan || '/img/no-image.png'}"
            //              alt="·∫¢nh s·∫£n ph·∫©m"
            //              onerror="this.src='/img/no-image.png';">
            //         <div class="image-actions">
            //             <button type="button"
            //                     class="btn btn-xs btn-warning btn-del-server"
            //                     title="X√≥a ·∫£nh">
            //                 <i class="fas fa-times"></i>
            //             </button>
            //         </div>
            //         <span class="badge badge-light border image-badge btn-mark-cover"
            //               style="cursor:pointer"
            //               title="ƒê·∫∑t l√†m ·∫£nh b√¨a">
            //             ·∫¢nh b√¨a
            //         </span>
            //     </div>
            // `);
            //
            //                 // üóëÔ∏è X√≥a ·∫£nh tr√™n server
            //                 $box.find('.btn-del-server').off('click').on('click', async () => {
            //                     if (!confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ·∫£nh n√†y?')) return;
            //                     try {
            //                         await axios.delete(API.IMG_DELETE(img.id));
            //                         $box.fadeOut(200, () => $box.remove());
            //                         if ($preview.find('.image-box').length <= 1) {
            //                             $upload.removeClass('has-images');
            //                         }
            //                     } catch (err) {
            //                         console.error('‚ùå L·ªói x√≥a ·∫£nh:', err);
            //                         alert('‚ùå Kh√¥ng th·ªÉ x√≥a ·∫£nh. Vui l√≤ng th·ª≠ l·∫°i!');
            //                     }
            //                 });
            //
            //                 // üåü ƒê·∫∑t ·∫£nh b√¨a
            //                 $box.find('.btn-mark-cover').off('click').on('click', async () => {
            //                     try {
            //                         await axios.post(API.IMG_SET_COVER(spctId, img.id));
            //                         // üßπ Reset to√†n b·ªô cover tr∆∞·ªõc khi set m·ªõi
            //                         $preview.find('.image-box').removeClass('cover');
            //                         $box.addClass('cover');
            //                     } catch (err) {
            //                         console.error('‚ùå L·ªói ƒë·∫∑t ·∫£nh b√¨a:', err);
            //                         alert('‚ùå Kh√¥ng th·ªÉ ƒë·∫∑t ·∫£nh b√¨a. Vui l√≤ng th·ª≠ l·∫°i!');
            //                     }
            //                 });
            //
            //                 // ‚úÖ Ch√®n sau n√∫t "+"
            //                 $addBox.after($box);
            //             });
            //
            //             // ü™Ñ C·∫≠p nh·∫≠t hi·ªáu ·ª©ng b√≥ng m·ªù cu·ªôn ngang
            //             updatePreviewShadow();
            //
            //         } catch (err) {
            //             console.error('‚ùå L·ªói load ·∫£nh s·∫£n ph·∫©m chi ti·∫øt:', err);
            //             alert('‚ùå Kh√¥ng th·ªÉ t·∫£i ·∫£nh s·∫£n ph·∫©m. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi ho·∫∑c th·ª≠ l·∫°i sau!');
            //         }
            //     }



            });
        </script>
    </div>


</body>

</html>