<!DOCTYPE html>
<html lang="vi" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{admin/layout/Layout}">

<head>
    <title layout:title="Qu·∫£n l√Ω s·∫£n ph·∫©m chi ti·∫øt"></title>
    <style>
        /***************************************************
 * 1Ô∏è‚É£  C·∫§U H√åNH CHUNG TO√ÄN TRANG
 ***************************************************/
        html,
        body {
            height: 100%;
            background-color: #f4f6f9;
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
        }

        /* Gi·ªØ h√†ng 3 c√¢n ƒë·ªëi khi c√≥ 4 input */
        #spct-form .form-row .col input.form-control {
            min-width: 0;
            /* NgƒÉn tr√†n */
            padding: 6px 10px;
            /* Nh·ªè g·ªçn h∆°n m·ªôt ch√∫t */
        }

        /* ‚úÖ C√¢n l·∫°i h√†ng 3 c√≥ 4 input, kh√¥ng tr√†n khung */
        #spct-form .form-row:last-child {
            display: flex;
            gap: 8px;
            flex-wrap: nowrap;
            /* ‚ùó Gi·ªØ t·∫•t c·∫£ 4 √¥ tr√™n c√πng 1 h√†ng */
        }

        #spct-form .form-row:last-child .col {
            flex: 1 1 0;
            /* Cho ph√©p co gi√£n ƒë·ªÅu nhau */
            max-width: 25%;
            /* 4 √¥ v·ª´a ƒë·ªß 100% */
            min-width: 0;
            /* NgƒÉn tr√†n khi text d√†i */
        }


        /* N·∫øu m√†n h√¨nh nh·ªè (tablet, mobile) th√¨ t·ª± xu·ªëng h√†ng */
        @media (max-width: 992px) {
            #spct-form .form-row:last-child .col {
                flex: 1 1 50%;
                /* 2 c·ªôt m·ªói h√†ng */
                margin-bottom: 6px;
            }

            #spct-form .form-row:last-child .col {
                flex: 1 1 48%;
                /* 2 √¥ m·ªói h√†ng */
                max-width: 48%;
                margin-bottom: 6px;
            }
        }


        .page-content-section {
            height: calc(100vh - 60px);
            box-sizing: border-box;
            padding-bottom: 0;
        }

        .card {
            display: flex;
            flex-direction: column;
            height: 100%;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
            background: #fff;
        }

        /***************************************************
         * 2Ô∏è‚É£  PH·∫¶N TI√äU ƒê·ªÄ (CARD HEADER)
         ***************************************************/
        .card-header {
            flex: 0 0 auto;
            position: sticky;
            top: 0;
            z-index: 10;
            background: #007bff;
            color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 15px;
            border-radius: 8px 8px 0 0;
        }

        .card-header h5 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
            letter-spacing: 0.3px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
        }

        /***************************************************
         * 3Ô∏è‚É£  B·ªê C·ª§C CH√çNH ‚Äì FORM 2 C·ªòT
         ***************************************************/
        .card-body {
            flex: 1;
            padding: 10px 16px !important;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            overflow: visible !important;
        }

        /* Layout t·ªïng */
        .spct-form {
            display: flex;
            flex-wrap: nowrap;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 10px;
        }

        /* C·ªôt tr√°i (form 3 h√†ng) */
        .col-left {
            flex: 0 0 58%;
            /* Chi·∫øm kho·∫£ng 58% */
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* C·ªôt ph·∫£i (upload ·∫£nh + n√∫t d·ªçc) */
        .col-right {
            flex: 0 0 42%;
            /* Upload chi·∫øm 42% */
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            gap: 10px;
        }

        /***************************************************
         * 4Ô∏è‚É£  √î NH·∫¨P LI·ªÜU & DROPDOWN
         ***************************************************/
        .form-row {
            display: flex;
            gap: 8px;
            justify-content: flex-start;
        }

        .form-row .col {
            flex: 1;
        }

        .form-row .form-control,
        .dropdown-input {
            height: 34px;
            font-size: 0.9rem;
        }

        /* Input ch·ªçn */
        .dropdown-input {
            cursor: pointer;
            background-color: #fff;
            border: 1px solid #ced4da;
            border-radius: 6px;
            transition: box-shadow 0.2s ease-in-out;
        }

        .dropdown-input:focus {
            outline: none;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
        }

        /* Danh s√°ch th·∫£ xu·ªëng */
        .dropdown-list {
            display: none;
            position: absolute;
            top: 36px;
            left: 0;
            width: 100%;
            background: #fff;
            border: 1px solid #ced4da;
            border-radius: 6px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            max-height: 180px;
            overflow-y: auto;
            z-index: 50;
            padding: 4px 0;
            opacity: 0;
            transform: translateY(-5px);
            transition: all 0.2s ease-in-out;
        }

        .dropdown-list.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .dropdown-item {
            padding: 6px 12px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background: #e7f1ff;
        }

        /* üé® √î dropdown S·∫Øp x·∫øp ‚Äì gi·ªëng √¥ m√†u s·∫Øc */
        #sortSelectInput {
            cursor: pointer;
            background-color: #fff;
            border: 1.5px solid #d0d7de;
            border-radius: 8px;
            height: 34px;
            font-size: 0.9rem;
            color: #001f3f;
            transition: all 0.2s ease;
            padding-right: 28px;
            position: relative;
        }

        /* M≈©i t√™n xu·ªëng ·∫£o */
        #sortSelectInput::after {
            content: "\f078";
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            color: #6b7280;
            pointer-events: none;
        }

        /* Hover & Focus */
        #sortSelectInput:hover,
        #sortSelectInput:focus {
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.15);
            outline: none;
        }

        /* Danh s√°ch dropdown */
        #sortSelectList {
            display: none;
            position: absolute;
            top: 38px;
            left: 0;
            width: 100%;
            background: #fff;
            border: 1px solid #ced4da;
            border-radius: 8px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            z-index: 99;
            opacity: 0;
            transform: translateY(-5px);
            transition: all 0.2s ease;
            max-height: 220px; /* ‚úÖ Gi·ªõi h·∫°n chi·ªÅu cao, b·∫Øt ƒë·∫ßu c√≥ thanh cu·ªôn */
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 123, 255, 0.3) transparent; /* Firefox */
        }

        #sortSelectList.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        #sortSelectList .dropdown-item {
            padding: 6px 12px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        #sortSelectList .dropdown-item:hover {
            background-color: #e7f1ff;
            color: #007bff;
        }

        /* üé® Scrollbar ƒë·∫πp cho dropdown "S·∫Øp x·∫øp theo" */
        /*#sortSelectList {*/
        /*    max-height: 220px; !* ‚úÖ Gi·ªõi h·∫°n chi·ªÅu cao, b·∫Øt ƒë·∫ßu c√≥ thanh cu·ªôn *!*/
        /*    overflow-y: auto;*/
        /*    scrollbar-width: thin;*/
        /*    scrollbar-color: rgba(0, 123, 255, 0.3) transparent; !* Firefox *!*/
        /*}*/

        /* Chrome / Edge / Safari */
        #sortSelectList::-webkit-scrollbar {
            width: 6px;
        }

        #sortSelectList::-webkit-scrollbar-track {
            background: transparent;
        }

        #sortSelectList::-webkit-scrollbar-thumb {
            background: rgba(0, 123, 255, 0.25);
            border-radius: 10px;
            transition: background 0.25s ease;
        }

        #sortSelectList::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 123, 255, 0.5);
        }


        /***************************************************
 * 5Ô∏è‚É£  KHU V·ª∞C UPLOAD ·∫¢NH ‚Äì GIAO DI·ªÜN SHOPEE STYLE
 ***************************************************/

        /* üì¶ Khu v·ª±c upload ·∫£nh ki·ªÉu Shopee */
        .upload-container {
            flex: 1;
            position: relative;
            background: #fff;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 10px;
            height: 130px;
            /* ‚úÖ Chi·ªÅu cao c·ªë ƒë·ªãnh */
            width: calc(3 * 80px + 2 * 10px + 20px);
            /* ‚úÖ R·ªông v·ª´a 3 ·∫£nh + kho·∫£ng c√°ch */
            max-width: 100%;
            transition: all .3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
            /* ‚úÖ ·∫®n ph·∫ßn tr√†n ra ngo√†i */
            box-sizing: border-box;
        }

        .upload-container:hover {
            border-color: #007bff;
            background-color: #f8fbff;
        }

        /* Placeholder */
        .upload-placeholder {
            position: absolute;
            /* ‚úÖ Cho ph√©p cƒÉn gi·ªØa tuy·ªát ƒë·ªëi */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            /* ‚úÖ ƒê∆∞a icon + ch·ªØ ch√≠nh gi·ªØa khung */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #6b7280;
            font-size: 0.9rem;
            line-height: 1.3;
            gap: 6px;
            pointer-events: none;
        }

        .upload-placeholder i {
            display: block;
            font-size: 26px;
            margin-bottom: 4px;
            color: #007bff;
        }

        .upload-container.has-images .upload-placeholder {
            display: none;
        }

        /* Input file ph·ªß to√†n khung khi CH∆ØA c√≥ ·∫£nh */
        #image-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 2;
            pointer-events: auto;
        }

        /* Khi ƒë√£ c√≥ ·∫£nh: input kh√¥ng nh·∫≠n click v√† ‚Äúra kh·ªèi ƒë∆∞·ªùng b·∫Øn chu·ªôt‚Äù */
        .upload-container.has-images #image-input {
            pointer-events: none;
            width: 1px;
            height: 1px;
            left: -9999px;
            top: auto;
        }

        /***************************************************
         * üå´ B√ìNG M·ªú G·ª¢I √ù CU·ªòN ‚Äì B√ÅM M√âP NGO√ÄI KHUNG
         ***************************************************/

        /* B√≥ng m·ªù b√™n tr√°i */
        .upload-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 45px;
            height: 100%;
            pointer-events: none;
            background: linear-gradient(to right, rgba(180, 180, 180, 0.55), rgba(255, 255, 255, 0));
            opacity: 0;
            transition: opacity 0.6s ease-in-out;
            z-index: 3;
        }

        /* B√≥ng m·ªù b√™n ph·∫£i */
        .upload-container::after {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 45px;
            height: 100%;
            pointer-events: none;
            background: linear-gradient(to left, rgba(180, 180, 180, 0.55), rgba(255, 255, 255, 0));
            opacity: 0;
            transition: opacity 0.6s ease-in-out;
            z-index: 3;
        }

        /* Khi c·∫ßn hi·ªÉn th·ªã */
        .upload-container.shadow-left::before {
            opacity: 1;
        }

        .upload-container.shadow-right::after {
            opacity: 1;
        }

        /***************************************************
         * 6Ô∏è‚É£  ·∫¢NH XEM TR∆Ø·ªöC (PREVIEW) ‚Äì HI·ªÜU ·ª®NG CU·ªòN M∆Ø·ª¢T
         ***************************************************/

        /* Container hi·ªÉn th·ªã ·∫£nh theo h√†ng ngang, c√≥ cu·ªôn m∆∞·ª£t */
        .preview-container {
            position: relative;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            padding: 6px;
            scroll-behavior: smooth;
            /* ‚úÖ Cu·ªôn m∆∞·ª£t */
            scroll-snap-type: x mandatory;
            /* ‚úÖ C·∫£m gi√°c b√°m t·ª´ng ·∫£nh */
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            transition: all 0.3s ease;
            scrollbar-width: thin;
            scrollbar-color: #ccc transparent;
        }

        .preview-container::-webkit-scrollbar {
            height: 6px;
        }

        .preview-container::-webkit-scrollbar-thumb {
            background-color: #bbb;
            border-radius: 3px;
        }

        /* Box ·∫£nh ‚Äî c√≥ hi·ªáu ·ª©ng ‚Äúsnap‚Äù khi cu·ªôn */
        .image-box,
        .image-add-box {
            scroll-snap-align: start;
        }

        /* Box ·∫£nh ‚Äî v·ª´a khung */
        .image-box {
            width: 80px;
            height: 80px;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            background: #fff;
            flex-shrink: 0;
            transition: transform .2s ease, opacity .3s ease;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .image-box:hover {
            transform: scale(1.05);
        }

        .image-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-box.cover {
            outline: 2px solid #22c55e;
        }

        .image-actions {
            position: absolute;
            right: 4px;
            top: 4px;
            display: flex;
            gap: 2px;
        }

        .image-badge {
            position: absolute;
            left: 4px;
            bottom: 4px;
            font-size: 9px;
            padding: 1px 5px;
        }

        /* N√∫t th√™m ·∫£nh (+) ‚Äì c√πng k√≠ch th∆∞·ªõc, n·∫±m cu·ªëi c√πng, cu·ªôn theo ·∫£nh */
        .image-add-box {
            width: 80px;
            height: 80px;
            border: 2px dashed #007bff;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #007bff;
            font-size: 28px;
            cursor: pointer;
            flex-shrink: 0;
            transition: all .2s;
            background-color: #fff;
        }

        .image-add-box:hover {
            background-color: #e9f3ff;
        }

        /* Hi·ªáu ·ª©ng m·ªù khi reset */
        .preview-container.resetting {
            opacity: 0.4;
            transition: opacity .3s;
        }

        /***************************************************
 * 7Ô∏è‚É£  N√öT H√ÄNH ƒê·ªòNG (TH√äM / L∆ØU / M·ªöI)
 ***************************************************/
        .btn-group-vertical {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            margin-right: 15px;
        }

        /* C·∫•u tr√∫c chung c·ªßa n√∫t */
        .btn-group-vertical .btn {
            width: 68px;
            height: 30px;
            font-size: 0.78rem;
            padding: 3px 6px;
            border-radius: 8px !important;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            transition: all 0.15s ease-in-out;
            white-space: nowrap;
        }

        /* icon nh·ªè g·ªçn */
        .btn-group-vertical .btn i {
            font-size: 13px;
        }

        /* Hi·ªáu ·ª©ng hover nh·∫π */
        .btn-group-vertical .btn:hover {
            transform: scale(1.05);
            opacity: 0.95;
        }

        /* Khi ƒëang nh·∫•n (chu·ªôt ch∆∞a th·∫£): t·ªëi nh·∫π */
        .btn:active {
            filter: brightness(0.9);
            transform: scale(0.97);
            transition: none;
        }

        /* Khi th·∫£ chu·ªôt ra: s√°ng l·∫°i ngay */
        .btn:focus:not(:active) {
            filter: brightness(1) !important;
            transform: scale(1) !important;
            transition: all 0.1s ease-out;
        }

        /* X√≥a b√≥ng m·∫∑c ƒë·ªãnh Bootstrap */
        .btn:focus,
        .btn:active {
            box-shadow: none !important;
            outline: none !important;
        }

        /* Responsive nh·ªè: ch·ªâ hi·ªán icon */
        @media (max-width: 992px) {
            .btn-group-vertical .btn {
                width: 38px;
                padding: 0;
            }

            .btn-group-vertical .btn span {
                display: none;
            }

            .btn-group-vertical .btn i {
                margin: 0;
            }
        }

        /***************************************************
 * üé®  B·∫¢NG D·ªÆ LI·ªÜU S·∫¢N PH·∫®M CHI TI·∫æT ‚Äî PHONG C√ÅCH ADMINLTE NH·∫∏
 ***************************************************/
        /***************************************************
 * üé® B·∫¢NG S·∫¢N PH·∫®M CHI TI·∫æT ‚Äì PHONG C√ÅCH TINH G·ªåN
 * Gi·ªØ tone s√°ng (#f8f9fa, #007bff), bo m·ªÅm, b√≥ng nh·∫π
 ***************************************************/
        .table-container {
            background: #fff;
            margin-top: 12px;
            flex: 1;
            border: none;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            overflow: hidden;
        }

        /* Thanh cu·ªôn m·∫£nh, tinh t·∫ø */
        .table-container::-webkit-scrollbar {
            height: 6px;
        }

        .table-container::-webkit-scrollbar-thumb {
            background-color: #cfd4da;
            border-radius: 3px;
        }

        /***************************************************
         * üß≠ HEADER B·∫¢NG
         ***************************************************/
        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.88rem;
            color: #333;
        }

        .table thead th {
            background: linear-gradient(180deg, #f8f9fa, #f1f3f5);
            color: #001f3f;
            font-weight: 600;
            text-align: center;
            padding: 8px 6px;
            border-bottom: 2px solid #dee2e6;
            height: 34px;
            vertical-align: middle;
            position: sticky;
            top: 0;
            z-index: 5;
            line-height: 1.2;
            white-space: nowrap;
            user-select: none;
        }

        /* Checkbox ch·ªçn t·∫•t c·∫£ */
        .table thead th input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #007bff;
        }

        /***************************************************
         * üìã BODY B·∫¢NG
         ***************************************************/
        .table tbody tr {
            background-color: #fff;
            border-bottom: 1px solid #e9ecef;
            transition: background-color 0.2s ease-in-out;
        }

        .table tbody tr:hover {
            background-color: #f3f7ff;
        }

        .table td {
            text-align: center;
            vertical-align: middle !important;
            padding: 8px 6px;
            height: 44px;
            white-space: nowrap;
            color: #212529;
        }

        /* C·ªôt t√™n s·∫£n ph·∫©m r√∫t g·ªçn */
        .table td.truncate {
            max-width: 160px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            vertical-align: middle;
            cursor: default;
        }

        /* Khi hover v√†o √¥ truncate */
        .table td.truncate:hover {
            background-color: #f1f6ff;
        }

        /***************************************************
         * üñºÔ∏è ·∫¢NH, CHECKBOX, N√öT
         ***************************************************/
        /* ·∫¢nh b√¨a nh·ªè */
        .table td img {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            object-fit: cover;
            border: 1px solid #ddd;
            background-color: #fff;
        }

        /* Checkbox t·ª´ng h√†ng */
        .table td input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #007bff;
        }

        /* N√∫t thao t√°c */
        .table td .btn {
            padding: 4px 6px;
            font-size: 0.78rem;
            border-radius: 6px;
            transition: all 0.15s ease-in-out;
            box-shadow: none !important;
        }

        .table td .btn:hover {
            transform: scale(1.08);
            background-color: #f0f4ff;
        }

        /***************************************************
         * üìè ƒê·ªò R·ªòNG C·ªòT (11 C·ªòT)
         ***************************************************/
        /* üìè ƒê·ªò R·ªòNG C·ªòT (11 C·ªòT - M·ªöI) */
        .table th:nth-child(1),
        .table td:nth-child(1) {
            width: 42px;
        }

        /* Tick */
        .table th:nth-child(2),
        .table td:nth-child(2) {
            width: 50px;
        }

        /* STT */
        .table th:nth-child(3),
        .table td:nth-child(3) {
            width: 150px;
        }

        /* ·∫¢nh b√¨a */
        .table th:nth-child(4),
        .table td:nth-child(4) {
            width: 120px;
        }

        /* M√£ SPCT */
        .table th:nth-child(5),
        .table td:nth-child(5) {
            min-width: 180px;
        }

        /* T√™n s·∫£n ph·∫©m */
        .table th:nth-child(6),
        .table td:nth-child(6) {
            width: 90px;
        }

        /* S·ªë l∆∞·ª£ng */
        .table th:nth-child(7),
        .table td:nth-child(7) {
            width: 110px;
        }

        /* Gi√° b√°n */
        .table th:nth-child(8),
        .table td:nth-child(8) {
            width: 90px;
        }

        /* M√†u s·∫Øc */
        .table th:nth-child(9),
        .table td:nth-child(9) {
            width: 90px;
        }

        /* K√≠ch c·ª° */
        .table th:nth-child(10),
        .table td:nth-child(10) {
            width: 120px;
        }

        /* Tr·∫°ng th√°i */
        .table th:nth-child(11),
        .table td:nth-child(11) {
            width: 100px;
        }

        /* Thao t√°c */

        /***************************************************
         * üåà D√íNG ƒê∆Ø·ª¢C CH·ªåN
         ***************************************************/
        .spct-row.selected {
            background-color: #e0f0ff !important;
            box-shadow: inset 0 0 0 1px #007bff;
            transition: background-color 0.25s ease-in-out;
        }

        /***************************************************
         * üì± RESPONSIVE
         ***************************************************/
        @media (max-width: 992px) {
            .table {
                font-size: 0.82rem;
                min-width: 950px;
            }
        }

        @media (max-width: 576px) {
            .table th,
            .table td {
                padding: 6px 4px;
            }

            .table-container {
                border-radius: 6px;
            }
        }


        /***************************************************
 * üìÑ THANH PH√ÇN TRANG
 ***************************************************/
        #pagination {
            margin-top: 8px;
        }

        .pagination .page-item .page-link {
            color: #007bff;
            border: none;
            background: transparent;
        }

        .pagination .page-item.active .page-link {
            background-color: #007bff;
            color: #fff;
            border-radius: 6px;
        }

        .pagination .page-item.disabled .page-link {
            color: #aaa;
            pointer-events: none;
        }


        /***************************************************
         * 9Ô∏è‚É£  HI·ªÜU ·ª®NG LOADING SHIMMER
         ***************************************************/
        .shimmer {
            position: relative;
            overflow: hidden;
            background: #f6f7f8;
            background-image: linear-gradient(to right,
            #f6f7f8 0%,
            #edeef1 20%,
            #f6f7f8 40%,
            #f6f7f8 100%);
            background-repeat: no-repeat;
            background-size: 800px 100%;
            animation: shimmer 1.2s linear infinite forwards;
        }

        @keyframes shimmer {
            0% {
                background-position: -800px 0;
            }

            100% {
                background-position: 800px 0;
            }
        }

        .skeleton-row {
            height: 36px;
        }

        .skeleton-cell {
            height: 14px;
            width: 80%;
            border-radius: 6px;
            margin: 6px auto;
        }

        /***************************************************
 * üîç  T√åM KI·∫æM & N√öT L·ªåC TR·∫†NG TH√ÅI TR√äN B·∫¢NG SPCT
 ***************************************************/
        .search-filter-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
            padding: 4px 2px;
        }

        /* üé® Dropdown s·∫Øp x·∫øp hi·ªán ƒë·∫°i */
        #sort-select {
            min-width: 200px;
            height: 36px;
            padding: 4px 32px 4px 12px;
            /* t·∫°o kh√¥ng gian cho icon m≈©i t√™n */
            font-size: 0.9rem;
            font-weight: 500;
            color: #001f3f;
            /* xanh ƒë·∫≠m ƒë·ªÉ ƒë·ªìng b·ªô header */
            background: #fff;
            border: 1.5px solid #d0d7de;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            appearance: none;
            /* ·∫©n m≈©i t√™n m·∫∑c ƒë·ªãnh */
            background-image: linear-gradient(45deg, transparent 50%, #007bff 50%),
            linear-gradient(135deg, #007bff 50%, transparent 50%);
            background-position: calc(100% - 18px) 13px, calc(100% - 13px) 13px;
            /* v·ªã tr√≠ m≈©i t√™n */
            background-size: 6px 6px, 6px 6px;
            background-repeat: no-repeat;
            transition: all 0.25s ease;
        }

        /* üü¶ Hover: s√°ng nh·∫π vi·ªÅn + ƒë·ªï b√≥ng */
        #sort-select:hover {
            border-color: #007bff;
            box-shadow: 0 0 6px rgba(0, 123, 255, 0.15);
        }

        /* üü© Focus: vi·ªÅn ƒë·∫≠m v√† b√≥ng m·ªù */
        #sort-select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 6px rgba(0, 123, 255, 0.25);
        }

        /* üåô Dark mode (n·∫øu b·∫°n d√πng theme t·ªëi sau n√†y) */
        body.dark-mode #sort-select {
            background-color: #1f2937;
            color: #f3f4f6;
            border-color: #374151;
        }


        /*#sort-select {*/
        /*    min-width: 150px;*/
        /*    height: 34px;*/
        /*    font-size: 0.85rem;*/
        /*    border: 1px solid #ced4da;*/
        /*    border-radius: 6px;*/
        /*    background-color: #fff;*/
        /*    color: #333;*/
        /*    cursor: pointer;*/
        /*    transition: all 0.2s ease;*/
        /*}*/
        /*#sort-select:focus {*/
        /*    border-color: #80bdff;*/
        /*    box-shadow: 0 0 4px rgba(0, 123, 255, 0.3);*/
        /*}*/


        /* √î t√¨m ki·∫øm */
        #search-input {
            flex: 1 1 320px;
            max-width: 240px;
            height: 34px;
            font-size: 0.9rem;
            border-radius: 8px;
            border: 1px solid #ced4da;
            padding-left: 34px;
            background: #fff url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="%23aaa" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85Zm-5.242 1.156a5 5 0 1 1 0-10.001 5 5 0 0 1 0 10Z"/></svg>') no-repeat 10px center;
            background-size: 14px;
            transition: all 0.2s ease;
        }

        #search-input:focus {
            outline: none;
            border-color: #80bdff;
            box-shadow: 0 0 4px rgba(0, 123, 255, 0.3);
        }

        /* Nh√≥m n√∫t l·ªçc */
        #status-filters {
            display: flex;
            gap: 4px;
        }

        #status-filters .btn {
            min-width: 90px;
            font-size: 0.82rem;
            border-radius: 6px;
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            white-space: nowrap;
        }

        /* Hi·ªáu ·ª©ng hover nh·∫π */
        #status-filters .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
        }

        /* N√∫t ƒëang ch·ªçn */
        #status-filters .btn.active {
            color: #fff !important;
            background-color: #007bff !important;
            border-color: #007bff !important;
            box-shadow: 0 1px 3px rgba(0, 123, 255, 0.3);
        }

        /* Responsive ‚Äî khi thu nh·ªè */
        @media (max-width: 768px) {
            .search-filter-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 6px;
            }

            #search-input {
                max-width: 100%;
            }

            #status-filters {
                justify-content: center;
                width: 100%;
            }

            #status-filters .btn {
                flex: 1;
                min-width: 0;
                font-size: 0.8rem;
            }
        }


        /***************************************************
         * üîü  RESPONSIVE
         ***************************************************/
        @media (max-width: 992px) {
            .spct-form {
                flex-direction: column;
            }

            .col-right {
                flex-direction: column;
            }

            .btn-group-vertical {
                flex-direction: row;
                justify-content: center;
            }

            .btn-group-vertical .btn {
                width: auto;
                margin-right: 6px;
            }
        }

        @media (max-width: 768px) {
            .table-container {
                overflow-x: auto;
            }

            .table {
                min-width: 900px;
            }
        }

        @media (max-width: 576px) {
            .card-header {
                flex-direction: column;
                align-items: flex-start !important;
            }

            .table td,
            .table th {
                font-size: 0.8rem;
                padding: 4px;
            }
        }

        /***************************************************
 * üé® N√öT H√ÄNH ƒê·ªòNG (SUCCESS / WARNING / DANGER)
 *  - Gi·ªØ m√†u g·ªëc Bootstrap
 *  - Hover t·ªëi nh·∫π, kh√¥ng ƒë·ªïi m√†u
 *  - G·ªçn ƒë·∫πp, icon tr·∫Øng trung t√¢m
 ***************************************************/
        .btn-success,
        .btn-warning,
        .btn-danger {
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: none;
            border-radius: 6px;
            color: #fff !important;
            font-size: 14px;
            transition: filter 0.2s ease;
            box-shadow: none !important;
        }

        /* Gi·ªØ m√†u g·ªëc Bootstrap */
        .btn-success {
            background-color: #28a745 !important;
        }

        .btn-warning {
            background-color: #ffc107 !important;
            color: #212529 !important;
        }

        .btn-danger {
            background-color: #dc3545 !important;
        }

        /* Hover ‚Äì ch·ªâ t·ªëi ƒëi nh·∫π */
        .btn-success:hover,
        .btn-warning:hover,
        .btn-danger:hover {
            filter: brightness(0.85);
        }

        /* Khi click ‚Äì t·ªëi th√™m m·ªôt ch√∫t */
        .btn-success:active,
        .btn-warning:active,
        .btn-danger:active {
            filter: brightness(0.75);
        }

        /* Icon cƒÉn gi·ªØa */
        .btn-success i,
        .btn-warning i,
        .btn-danger i {
            font-size: 14px;
        }

        /* üé® N√∫t "S·ª≠a" ‚Äî ƒë·ªìng b·ªô m√†u xanh h·ªá th·ªëng Aurora */
        .btn-edit {
            background-color: #007bff !important;
            color: #fff !important;
            border: none !important;
            box-shadow: 0 1px 3px rgba(0, 123, 255, 0.3);
            transition: all 0.2s ease-in-out;
        }

        /* Hi·ªáu ·ª©ng hover m∆∞·ª£t, s√°ng h∆°n nh·∫π */
        .btn-edit:hover {
            filter: brightness(1.1);
            transform: scale(1.05);
        }

        /* Khi click (active) ‚Äî t·ªëi nh·∫π ƒë·ªÉ c√≥ ph·∫£n h·ªìi */
        .btn-edit:active {
            filter: brightness(0.9);
            transform: scale(0.95);
        }


        #upload-container.loading {
            opacity: 0.6;
            pointer-events: none;
            position: relative;
        }

        #upload-container.loading::after {
            content: "ƒêang x·ª≠ l√Ω...";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.8);
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 13px;
            color: #007bff;
        }

        /* üåü Hi·ªáu ·ª©ng m·ªü popup m∆∞·ª£t */
        .modal.fade .modal-dialog {
            transform: translateY(-20px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .modal.fade.show .modal-dialog {
            transform: translateY(0);
            opacity: 1;
        }

        /* üì¶ Popup form r·ªông h∆°n v√† tho√°ng */
        #spctModal .modal-content {
            border-radius: 10px;
            overflow: hidden;
            background: #fff;
        }

        /* üí° Header n·ªïi b·∫≠t */
        #spctModal .modal-header {
            background: linear-gradient(90deg, #007bff, #0056b3);
            color: #fff;
            border-bottom: none;
        }

        /* ‚öôÔ∏è N√∫t h√†nh ƒë·ªông gi·ªëng trang ch√≠nh */
        #spctModal .btn-group-vertical .btn {
            width: 72px;
            height: 32px;
            font-size: 0.8rem;
            border-radius: 8px;
            font-weight: 500;
        }

        .table input[readonly] {
            background-color: #f9f9f9;
            border-color: #e0e0e0;
            cursor: not-allowed;
            color: #666;
        }

        .table input.editable {
            background-color: #ffffff;
            border-color: var(--bs-accordion-active-bg #007bff);
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
        }

        .btn-toggle-status {
            padding: 4px 6px;
            border-radius: 6px;
            transition: all 0.15s ease-in-out;
        }

        .btn-toggle-status:hover {
            transform: scale(1.05);
            opacity: 0.9;
        }

        /* üîµ Badge tr·∫°ng th√°i */
        .badge {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
        }

        .bg-success-subtle {
            background-color: #e6f9ed !important;
        }

        .bg-danger-subtle {
            background-color: #fdeaea !important;
        }

        .input-giaban[readonly] {
            background-color: #fafafa;
            color: #333;
        }


    </style>
</head>
<body>
<section layout:fragment="content" class="page-content-section container-fluid">
    <div class="card shadow-sm border-0">
        <div class="card-header text-white py-2 d-flex justify-content-between align-items-center"
             style="background: linear-gradient(135deg, #007bff, #14F5F1)">
            <h5 class="mb-1 mt-1"><i class="fas fa-boxes"></i> Qu·∫£n l√Ω s·∫£n ph·∫©m chi ti·∫øt</h5>
        </div>

        <div class="card-body">
            <div class="table-container mt-3">
                <!-- üîç √î t√¨m ki·∫øm + N√∫t l·ªçc tr·∫°ng th√°i -->
                <div class="search-filter-bar">
                    <input type="text" id="search-input" class="form-control form-control-sm"
                           placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m chi ti·∫øt">
                    <button class="btn btn-primary btn-sm" id="btnBulkUpdateSPCT">
                        <i class="fas fa-save"></i> C·∫≠p nh·∫≠t
                    </button>

                    <div class="d-flex align-items-center gap-2">
                        <div class="position-relative" style="min-width:180px;">
                            <input type="text" class="form-control dropdown-input" id="sortSelectInput"
                                   placeholder="S·∫Øp x·∫øp theo" readonly value="Ng√†y c·∫≠p nh·∫≠t m·ªõi nh·∫•t">
                            <div class="dropdown-list" id="sortSelectList">
                                <!-- M√£ SPCT -->
                                <div class="dropdown-item" data-value="maSPCT-asc">M√£ SPCT ‚Üë (A ‚Üí Z)</div>
                                <div class="dropdown-item" data-value="maSPCT-desc">M√£ SPCT ‚Üì (Z ‚Üí A)</div>
                                <hr class="dropdown-divider my-1">
                                <!-- Gi√° nh·∫≠p -->
                                <div class="dropdown-item" data-value="giaNhap-asc">Gi√° nh·∫≠p ‚Üë (th·∫•p ‚Üí cao)</div>
                                <div class="dropdown-item" data-value="giaNhap-desc">Gi√° nh·∫≠p ‚Üì (cao ‚Üí th·∫•p)</div>
                                <!-- Gi√° b√°n -->
                                <div class="dropdown-item" data-value="giaBan-asc">Gi√° b√°n ‚Üë (th·∫•p ‚Üí cao)</div>
                                <div class="dropdown-item" data-value="giaBan-desc">Gi√° b√°n ‚Üì (cao ‚Üí th·∫•p)</div>
                                <!-- S·ªë l∆∞·ª£ng -->
                                <div class="dropdown-item" data-value="soLuong-asc">S·ªë l∆∞·ª£ng ‚Üë (√≠t ‚Üí nhi·ªÅu)</div>
                                <div class="dropdown-item" data-value="soLuong-desc">S·ªë l∆∞·ª£ng ‚Üì (nhi·ªÅu ‚Üí √≠t)</div>
                                <!-- K√≠ch c·ª° -->
                                <div class="dropdown-item" data-value="kichCo-asc">K√≠ch c·ª° ‚Üë (nh·ªè ‚Üí l·ªõn)</div>
                                <div class="dropdown-item" data-value="kichCo-desc">K√≠ch c·ª° ‚Üì (l·ªõn ‚Üí nh·ªè)</div>
                                <hr class="dropdown-divider my-1">
                                <!-- Ng√†y c·∫≠p nh·∫≠t -->
                                <div class="dropdown-item" data-value="date-desc">Ng√†y c·∫≠p nh·∫≠t m·ªõi nh·∫•t</div>
                                <div class="dropdown-item" data-value="date-asc">Ng√†y c·∫≠p nh·∫≠t c≈© nh·∫•t</div>
                            </div>
                        </div>

                        <div class="btn-group btn-group-sm" role="group" id="status-filters">
                            <button type="button" class="btn btn-outline-secondary active" data-status="all">
                                <i class="fas fa-list"></i> T·∫•t c·∫£
                            </button>
                            <button type="button" class="btn btn-success" data-status="1">
                                <i class="fas fa-check-circle"></i> ƒêang KD
                            </button>
                            <button type="button" class="btn btn-warning" data-status="0">
                                <i class="fas fa-ban"></i> Ng·ª´ng KD
                            </button>
                        </div>
                    </div>
                </div>

                <table class="table table-bordered table-hover mb-0">
                    <thead class="thead-light text-center">
                    <tr>
                        <th><input type="checkbox" id="selectAllSPCT"></th>
                        <th>STT</th>
                        <th>·∫¢nh b√¨a</th>
                        <th>Gi√° nh·∫≠p</th>
                        <th>T√™n s·∫£n ph·∫©m</th>
                        <th>S·ªë l∆∞·ª£ng t·ªìn</th>
                        <!--                            <th>Gi√° nh·∫≠p</th>-->
                        <th>Gi√°</th>
                        <th>M√†u s·∫Øc</th>
                        <th>K√≠ch c·ª°</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>Thao t√°c</th>
                    </tr>
                    </thead>
                    <tbody id="spctTable">
                    <tr>
                        <td colspan="11" class="text-center text-muted">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                    </tr>
                    </tbody>
                </table>
                <!-- üìÑ Thanh ph√¢n trang -->
                <div id="pagination" class="d-flex justify-content-center align-items-center mt-2"></div>
            </div>
        </div>
    </div>

    <!-- ü™ü POPUP TH√äM / S·ª¨A S·∫¢N PH·∫®M CHI TI·∫æT -->
    <div class="modal fade" id="spctModal" tabindex="-1" aria-labelledby="spctModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content rounded-3 shadow-lg border-0">
                <div class="modal-header bg-primary text-white py-2">
                    <h6 class="modal-title fw-semibold" id="spctModalLabel">
                        <i class="fas fa-box-open"></i> Th√™m / C·∫≠p nh·∫≠t s·∫£n ph·∫©m chi ti·∫øt
                    </h6>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>

                <div class="modal-body p-3">
                    <!-- ‚úÖ GI·ªÆ NGUY√äN TO√ÄN B·ªò FORM G·ªêC -->
                    <form id="spct-form" class="spct-form">
                        <div class="row g-3">
                            <!-- C·ªôt tr√°i -->
                            <div class="col-md-8">
                                <!-- M√£ SPCT + M√£ s·∫£n ph·∫©m -->
                                <div class="row mb-2">
                                    <div class="col">
                                        <label class="form-label fw-semibold">M√£ SPCT</label>
                                        <input type="text" class="form-control" id="maSPCT" readonly>
                                    </div>
                                    <div class="col">
                                        <label class="form-label fw-semibold">M√£ s·∫£n ph·∫©m</label>
                                        <input type="text" class="form-control" id="maSanPham" readonly>
                                    </div>
                                </div>

                                <!-- T√™n SP + M√†u + K√≠ch c·ª° -->
                                <div class="row mb-2">
                                    <div class="col">
                                        <label class="form-label fw-semibold">T√™n s·∫£n ph·∫©m</label>
                                        <input type="text" class="form-control" id="tenSanPham" readonly>
                                    </div>
                                    <div class="col">
                                        <label class="form-label fw-semibold">M√†u s·∫Øc</label>
                                        <input type="text" class="form-control" id="tenMau" readonly>
                                    </div>
                                    <div class="col">
                                        <label class="form-label fw-semibold">K√≠ch c·ª°</label>
                                        <input type="text" class="form-control" id="tenKichCo" readonly>
                                    </div>
                                </div>

                                <!-- Gi√° + S·ªë l∆∞·ª£ng + Tr·∫°ng th√°i -->
                                <div class="row mb-2">
                                    <div class="col">
                                        <label class="form-label fw-semibold">Gi√° b√°n</label>
                                        <input type="text" class="form-control" id="giaBan" readonly>
                                    </div>
                                    <div class="col">
                                        <label class="form-label fw-semibold">S·ªë l∆∞·ª£ng t·ªìn</label>
                                        <input type="text" class="form-control" id="soLuongTon" readonly>
                                    </div>
                                    <div class="col">
                                        <label class="form-label fw-semibold">Tr·∫°ng th√°i</label>
                                        <input type="text" class="form-control" id="trangThai" readonly>
                                    </div>
                                </div>

                                <!-- Ng∆∞·ªùi t·∫°o / c·∫≠p nh·∫≠t / ng√†y t·∫°o / ng√†y c·∫≠p nh·∫≠t -->
                                <div class="row mb-2">
                                    <div class="col">
                                        <label class="form-label fw-semibold">Ng∆∞·ªùi t·∫°o</label>
                                        <input type="text" class="form-control" id="nguoiTao" readonly>
                                    </div>
                                    <div class="col">
                                        <label class="form-label fw-semibold">Ng√†y t·∫°o</label>
                                        <input type="text" class="form-control" id="ngayTao" readonly>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col">
                                        <label class="form-label fw-semibold">Ng∆∞·ªùi c·∫≠p nh·∫≠t</label>
                                        <input type="text" class="form-control" id="nguoiCapNhat" readonly>
                                    </div>
                                    <div class="col">
                                        <label class="form-label fw-semibold">Ng√†y c·∫≠p nh·∫≠t</label>
                                        <input type="text" class="form-control" id="ngayCapNhat" readonly>
                                    </div>
                                </div>
                            </div>

                            <!-- C·ªôt ph·∫£i: ·∫£nh -->
                            <div class="col-md-4">
                                <label class="form-label fw-semibold d-block">·∫¢nh b√¨a</label>
                                <div id="preview-container" class="border rounded p-2 text-center" style="min-height: 200px;">
                                    <p class="text-muted fst-italic">Ch∆∞a c√≥ ·∫£nh</p>
                                </div>
                            </div>
                        </div>
                    </form>
S·ª≠a
                </div>
            </div>
        </div>
    </div>


</section>


<div layout:fragment="scripts">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>

        // üß≠ ƒê·ªçc sanPhamId t·ª´ URL n·∫øu c√≥
        function getSanPhamIdFromUrl() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            return id ? Number(id) : null;
        }

        const PRODUCT_ID = getSanPhamIdFromUrl();

        /* =====================================================
        * 1Ô∏è‚É£ H·∫∞NG S·ªê & API (CHU·∫®N H√ìA)
        * ===================================================== */

        // üë§ T√™n ng∆∞·ªùi thao t√°c m·∫∑c ƒë·ªãnh
        const ADMIN_NAME = 'Qu·∫£n tr·ªã vi√™n';

        // üåê T·∫≠p h·ª£p c√°c endpoint API RESTful
        const API = {
            // üß© S·∫£n ph·∫©m chi ti·∫øt
            SPCT_LIST: '/api/san-pham-chi-tiet/getAll',
            SPCT_BY_SP: spId => `/api/san-pham-chi-tiet/by-san-pham?sanPhamId=${spId}`,
            SPCT_ADD: '/api/san-pham-chi-tiet/add',
            SPCT_UPDATE: '/api/san-pham-chi-tiet/bulk-update',
            SPCT_DELETE: id => `/api/san-pham-chi-tiet/delete/${id}`,

            // üè∑Ô∏è Danh m·ª•c c∆° b·∫£n
            SP_LIST: '/api/san-pham/getAll',
            MS_LIST: '/api/mau-sac/getAll',
            KC_LIST: '/api/kich-co/getAll',

            // üñºÔ∏è ·∫¢nh s·∫£n ph·∫©m
            IMGS_BY_SPCT: id => `/api/san-pham-chi-tiet/anh/${id}`,
            IMGS_UPLOAD: id => `/api/san-pham-chi-tiet/anh/upload/${id}`,
            IMG_DELETE: imgId => `/api/san-pham-chi-tiet/anh/${imgId}`,
            IMG_SET_COVER: (spctId, imgId) =>
                `/api/san-pham-chi-tiet/anh/set-cover?spctId=${spctId}&imageId=${imgId}`
        };

        // ===========================
        // üåà Aurora Toast Notification
        // ===========================
        function showToast(message, type = 'success') {
            // N·∫øu container ch∆∞a c√≥, t·∫°o 1 c√°i
            let container = document.querySelector('.aurora-toast-container');
            if (!container) {
                container = document.createElement('div');
                container.className = 'aurora-toast-container';
                Object.assign(container.style, {
                    position: 'fixed',
                    top: '20px',
                    right: '20px',
                    display: 'flex',
                    flexDirection: 'column',
                    gap: '10px',
                    zIndex: 9999,
                    pointerEvents: 'none' // kh√¥ng ch·∫∑n click c√°c ph·∫ßn t·ª≠ kh√°c
                });
                document.body.appendChild(container);
            }

            // T·∫°o ph·∫ßn t·ª≠ toast
            const toast = document.createElement('div');
            toast.className = `aurora-toast ${type}`;
            toast.innerHTML = `
        <div class="aurora-toast-content">
            ${message}
        </div>
    `;

            // Style Aurora/iOS-like
            Object.assign(toast.style, {
                minWidth: '240px',
                padding: '10px 16px',
                borderRadius: '12px',
                color: '#fff',
                fontSize: '14px',
                fontWeight: '500',
                boxShadow: '0 4px 20px rgba(0,0,0,0.1)',
                backdropFilter: 'blur(12px)',
                WebkitBackdropFilter: 'blur(12px)',
                opacity: 0,
                transform: 'translateY(-10px)',
                transition: 'all 0.3s ease',
                pointerEvents: 'auto'
            });

            // M√†u theo lo·∫°i
            if (type === 'error') {
                toast.style.background = 'linear-gradient(135deg, #ff5f6d, #d43f8d)';
            } else if (type === 'warning') {
                toast.style.background = 'linear-gradient(135deg, #f7971e, #ffd200)';
                toast.style.color = '#333';
            } else {
                toast.style.background = 'linear-gradient(135deg, var(--aurora-primary, #00b4d8), #007bff)';
            }

            // Th√™m v√†o container
            container.appendChild(toast);

            // Hi·ªán l√™n
            requestAnimationFrame(() => {
                toast.style.opacity = 1;
                toast.style.transform = 'translateY(0)';
            });

            // T·ª± ·∫©n sau 3s
            setTimeout(() => {
                toast.style.opacity = 0;
                toast.style.transform = 'translateY(-10px)';
                setTimeout(() => toast.remove(), 400);
            }, 2000);
        }

        /* =====================================================
        * 2Ô∏è‚É£ DOM & STATE (CHU·∫®N H√ìA)
        * ===================================================== */

        // üß© Tham chi·∫øu c√°c ph·∫ßn t·ª≠ DOM ch√≠nh
        const $table = $('#spctTable');          // B·∫£ng d·ªØ li·ªáu s·∫£n ph·∫©m chi ti·∫øt
        const $upload = $('#upload-container');   // Khu v·ª±c upload ·∫£nh
        const $preview = $('#preview-container');  // V√πng hi·ªÉn th·ªã ·∫£nh preview
        const $fileInp = $('#image-input');        // Input file ·∫£nh

        // üß† Bi·∫øn tr·∫°ng th√°i
        let selectedId = null;     // ID c·ªßa SPCT ƒëang ch·ªçn
        let selectedFiles = [];       // Danh s√°ch ·∫£nh local ng∆∞·ªùi d√πng v·ª´a ch·ªçn
        let selectedCover = null;     // ·∫¢nh n√†o ƒë∆∞·ª£c ch·ªçn l√†m "·∫¢nh b√¨a"
        let cachedSpctList = [];       // Cache danh s√°ch SPCT t·ª´ API
        let searchKeyword = '';         // T√¨m ki·∫øm
        let currentStatus = 'all'; // all | 1 | 0
        let currentPage = 1;
        const pageSize = 8;
        let PRODUCT_INDEX = new Map(); // Map: id s·∫£n ph·∫©m ‚Üí m√£ s·∫£n ph·∫©m (d√πng ƒë·ªÉ sinh m√£ SPCT)

        /* =====================================================
        * 3Ô∏è‚É£ TI·ªÜN √çCH (CHU·∫®N H√ìA)
        * ===================================================== */

        // üß† H√†m ti·ªán √≠ch: sinh th√¥ng tin ng∆∞·ªùi t·∫°o / c·∫≠p nh·∫≠t chu·∫©n
        function buildAuditFields(isCreate = false) {
            const CURRENT_ADMIN = window.ADMIN_NAME
                || localStorage.getItem('adminName')
                || 'ADMIN';

            const now = new Date().toISOString().slice(0, 19); // chu·∫©n ISO yyyy-MM-dd'T'HH:mm:ss

            // N·∫øu l√† t·∫°o m·ªõi
            if (isCreate) {
                return {
                    nguoiTao: CURRENT_ADMIN,
                    nguoiCapNhat: CURRENT_ADMIN,
                    ngayTao: now,
                    ngayCapNhat: now
                };
            }

            // N·∫øu ch·ªâ c·∫≠p nh·∫≠t
            return {
                nguoiCapNhat: CURRENT_ADMIN,
                ngayCapNhat: now
            };
        }


        // üí∞ ƒê·ªãnh d·∫°ng ti·ªÅn t·ªá Vi·ªát Nam
        const formatVnd = n => {
            if (n == null || Number.isNaN(Number(n))) return '-';
            return Number(n).toLocaleString('vi-VN') + ' ‚Ç´';
        };


        /* =====================================================
        * 9Ô∏è‚É£ B·∫¢NG D·ªÆ LI·ªÜU
        * ===================================================== */

        function showSkeleton(tableId, rowCount = 6, colCount = 11) {
            const $t = $(tableId).empty();
            for (let i = 0; i < rowCount; i++) {
                let row = '<tr class="skeleton-row">';
                for (let j = 0; j < colCount; j++) {
                    row += `<td><div class="shimmer skeleton-cell"></div></td>`;
                }
                row += '</tr>';
                $t.append(row);
            }
        }

        /* =====================================================
        * üì¶ LOAD D·ªÆ LI·ªÜU CH√çNH & RENDER B·∫¢NG SPCT (11 C·ªòT) (NEW)
        * ===================================================== */

        // üîπ G·ªçi API l·∫•y to√†n b·ªô SPCT (ho·∫∑c theo s·∫£n ph·∫©m)
        async function fetchSPCTList(spId = null) {
            const url = spId ? API.SPCT_BY_SP(spId) : API.SPCT_LIST;
            console.log("üì° G·ªçi API:", url); // üëà ki·ªÉm tra log
            const res = await axios.get(url);
            return res.data || [];
        }

        // üß© H√†m s·∫Øp x·∫øp theo m√£ c√≥ c·∫£ ch·ªØ v√† s·ªë
        function compareMixedCode(a, b) {
            if (!a) return -1;
            if (!b) return 1;

            // T√°ch ph·∫ßn ch·ªØ v√† s·ªë ƒë·∫ßu ti√™n
            const matchA = a.match(/^([A-Za-z]+)(\d+)/);
            const matchB = b.match(/^([A-Za-z]+)(\d+)/);

            if (matchA && matchB) {
                const prefixA = matchA[1];
                const prefixB = matchB[1];
                const numA = parseInt(matchA[2]);
                const numB = parseInt(matchB[2]);

                // So s√°nh ph·∫ßn ch·ªØ tr∆∞·ªõc
                const cmpPrefix = prefixA.localeCompare(prefixB);
                if (cmpPrefix !== 0) return cmpPrefix;

                // N·∫øu ph·∫ßn ch·ªØ gi·ªëng ‚Üí so s√°nh ph·∫ßn s·ªë
                if (numA !== numB) return numA - numB;
            }

            // N·∫øu kh√¥ng kh·ªõp ƒë·ªãnh d·∫°ng (fallback)
            return a.localeCompare(b);
        }

        function compareKichCo(a, b) {
            if (!a) return -1;
            if (!b) return 1;

            const numA = parseFloat(a);
            const numB = parseFloat(b);

            // N·∫øu c·∫£ hai l√† s·ªë (VD: 38, 39, 40)
            if (!isNaN(numA) && !isNaN(numB)) {
                return numA - numB;
            }

            // N·∫øu l√† k√Ω hi·ªáu (S, M, L, XL, XXL, v.v.)
            const sizeOrder = ['XS', 'S', 'M', 'L', 'XL', 'XXL', 'XXXL'];
            const idxA = sizeOrder.indexOf(a.toUpperCase());
            const idxB = sizeOrder.indexOf(b.toUpperCase());
            if (idxA >= 0 && idxB >= 0) return idxA - idxB;

            // Fallback: s·∫Øp x·∫øp ch·ªØ th∆∞·ªùng
            return a.localeCompare(b);
        }


        // üîπ L·ªçc, t√¨m ki·∫øm, s·∫Øp x·∫øp danh s√°ch
        function filterSPCTData() {
            let data = [...cachedSpctList];

            // T√¨m ki·∫øm theo t·ª´ kh√≥a
            if (searchKeyword.trim() !== '') {
                const kw = searchKeyword.toLowerCase();
                data = data.filter(sp =>
                    (sp.tenSanPham || '').toLowerCase().includes(kw) ||
                    (sp.tenMau || '').toLowerCase().includes(kw) ||
                    (sp.tenKichCo || '').toLowerCase().includes(kw)
                );
            }

            // L·ªçc theo tr·∫°ng th√°i
            if (currentStatus !== 'all') {
                data = data.filter(sp => String(sp.trangThai) === String(currentStatus));
            }

            // S·∫Øp x·∫øp
            const sortVal = $('#sortSelectInput').data('value');
            if (sortVal) {
                switch (sortVal) {
                    /* üîπ M√É SPCT */
                    case 'maSPCT-asc':
                        data.sort((a, b) => compareMixedCode(a.maSpct, b.maSpct));
                        break;
                    case 'maSPCT-desc':
                        data.sort((a, b) => compareMixedCode(b.maSpct, a.maSpct));
                        break;

                    /* üîπ GI√Å NH·∫¨P */
                    case 'giaNhap-asc':
                        data.sort((a, b) => (a.giaNhap ?? 0) - (b.giaNhap ?? 0));
                        break;
                    case 'giaNhap-desc':
                        data.sort((a, b) => (b.giaNhap ?? 0) - (a.giaNhap ?? 0));
                        break;

                    /* üîπ GI√Å B√ÅN */
                    case 'giaBan-asc':
                        data.sort((a, b) => (a.giaBan ?? 0) - (b.giaBan ?? 0));
                        break;
                    case 'giaBan-desc':
                        data.sort((a, b) => (b.giaBan ?? 0) - (a.giaBan ?? 0));
                        break;

                    /* üîπ S·ªê L∆Ø·ª¢NG T·ªíN */
                    case 'soLuong-asc':
                        data.sort((a, b) => (a.soLuongTon ?? 0) - (b.soLuongTon ?? 0));
                        break;
                    case 'soLuong-desc':
                        data.sort((a, b) => (b.soLuongTon ?? 0) - (a.soLuongTon ?? 0));
                        break;

                    /* üîπ K√çCH C·ª† (x·ª≠ l√Ω ƒë∆∞·ª£c c·∫£ d·∫°ng "38", "39", "40" l·∫´n "S", "M", "L") */
                    case 'kichCo-asc':
                        data.sort((a, b) => compareKichCo(a.tenKichCo, b.tenKichCo));
                        break;
                    case 'kichCo-desc':
                        data.sort((a, b) => compareKichCo(b.tenKichCo, a.tenKichCo));
                        break;

                    /* üîπ NG√ÄY C·∫¨P NH·∫¨T */
                    case 'date-desc':
                        data.sort((a, b) => new Date(b.ngayCapNhat) - new Date(a.ngayCapNhat));
                        break;
                    case 'date-asc':
                        data.sort((a, b) => new Date(a.ngayCapNhat) - new Date(b.ngayCapNhat));
                        break;
                }

            }

            return data;
        }

        // üîπ Ph√¢n trang & render b·∫£ng
        function renderSPCTTable() {
            const data = filterSPCTData();
            const total = data.length;
            const start = (currentPage - 1) * pageSize;
            const pageData = data.slice(start, start + pageSize);

            $table.empty();

            if (pageData.length === 0) {
                $table.append(`<tr><td colspan="11" class="text-center text-muted py-3">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>`);
                $('#pagination').html('');
                return;
            }

            pageData.forEach((spct, idx) => {
                const {
                    id,
                    maSpct,
                    tenSanPham,
                    tenMau,
                    tenKichCo,
                    giaNhap,
                    giaBan,
                    soLuongTon,
                    trangThai,
                    anhBiaUrl
                } = spct;
                const trangThaiText = trangThai === 1 ? 'ƒêang b√°n' : 'Ng·ª´ng b√°n';
                const trangThaiClass = trangThai === 1
                    ? 'badge bg-success-subtle text-success border border-success'
                    : 'badge bg-danger-subtle text-danger border border-danger';
                $table.append(`
        <tr class="text-center spct-row" data-id="${id}">
            <td><input type="checkbox" class="spct-checkbox" data-id="${id}"></td>
            <td>${start + idx + 1}</td>
            <td><img src="${anhBiaUrl || '/img/no-image.png'}"></td>
            <td>${maSpct || '-'}</td> <!-- ‚úÖ th√™m m·ªõi -->
            <td class="truncate">${tenSanPham || '-'}</td>
            <td>
                <input type="number"
                            class="form-control form-control-sm input-slt"
                            data-id="${id}"
                            value="${soLuongTon ?? 0}"
                            min="0" readonly />
            </td>

            <td>
                <input type="text"
           class="form-control form-control-sm input-giaban text-end"
           data-id="${id}"
           value="${formatVnd(giaBan)}"
           data-raw="${giaBan ?? 0}"
           readonly />
            </td>
            <td>${tenMau || '-'}</td>
            <td>${tenKichCo || '-'}</td>
            <td><span class="${trangThaiClass}">${trangThaiText}</span></td>
            <td>
    <button class="btn btn-success btn-sm btn-edit"
        title="Xem chi ti·∫øt"
        data-sp-id="${spct.sanPhamId}">
    <i class="fas fa-eye"></i>
</button>

    <button class="btn btn-sm ${trangThai === 1 ? 'btn-warning' : 'btn-success'} btn-toggle-status"
            data-id="${id}"
            data-status="${trangThai}"
            title="${trangThai === 1 ? 'Ng·ª´ng kinh doanh' : 'Kh√¥i ph·ª•c kinh doanh'}">
        <i class="fas ${trangThai === 1 ? 'fa-ban' : 'fa-undo'}"></i>
    </button>
</td>
        </tr>`);
            });
            renderPagination(total);
        }

        // üîπ Ph√¢n trang
        function renderPagination(total) {
            const totalPages = Math.ceil(total / pageSize);
            if (totalPages <= 1) return $('#pagination').empty();

            let html = '<ul class="pagination pagination-sm mb-0">';
            for (let i = 1; i <= totalPages; i++) {
                html += `
        <li class="page-item ${i === currentPage ? 'active' : ''}">
            <a class="page-link" href="#">${i}</a>
        </li>`;
            }
            html += '</ul>';

            $('#pagination').html(html);
        }

        // üîπ S·ª± ki·ªán click chuy·ªÉn trang
        $(document).off('click.paginate').on('click.paginate', '.page-link', function (e) {
            e.preventDefault();
            const page = parseInt($(this).text());
            if (!isNaN(page)) {
                currentPage = page;
                renderSPCTTable();
            }
        });

        // üîπ Load d·ªØ li·ªáu t·ªïng (g·ªçi API m·ªôt l·∫ßn r·ªìi render)
        async function loadSPCTData(spId = null) {
            showSkeleton('#spctTable', 8, 11);
            cachedSpctList = await fetchSPCTList(spId);
            renderSPCTTable();
            $('#selectAllSPCT').prop('checked', false);
        }

        // Khi t√¨m ki·∫øm
        $('#search-input').on('input', function () {
            searchKeyword = $(this).val().trim();
            currentPage = 1;
            renderSPCTTable();
        });

        // Khi l·ªçc tr·∫°ng th√°i
        $('#status-filters .btn').on('click', function () {
            $('#status-filters .btn').removeClass('active');
            $(this).addClass('active');
            currentStatus = $(this).data('status');
            currentPage = 1;
            renderSPCTTable();
        });

        // Khi ƒë·ªïi s·∫Øp x·∫øp
        $('#sortSelectList .dropdown-item').on('click', function () {
            const val = $(this).data('value');
            $('#sortSelectInput').data('value', val).val($(this).text().trim());
            currentPage = 1;
            renderSPCTTable();
        });

        //  üîΩ DROPDOWN "S·∫ÆP X·∫æP THEO" (HO·∫†T ƒê·ªòNG CHU·∫®N)

        // üü© M·ªü / ƒë√≥ng danh s√°ch khi click v√†o √¥ "S·∫Øp x·∫øp theo"
        $(document).off('click.sortOpen').on('click.sortOpen', '#sortSelectInput', function (e) {
            e.stopPropagation();
            $('#sortSelectList').toggleClass('show');
        });

        // üü® Khi ch·ªçn m·ªôt m·ª•c trong dropdown
        $(document).off('click.sortPick').on('click.sortPick', '#sortSelectList .dropdown-item', function (e) {
            e.stopPropagation();
            const value = $(this).data('value');
            const text = $(this).text().trim();

            // ‚úÖ G√°n gi√° tr·ªã v√† text v√†o input
            $('#sortSelectInput').val(text).data('value', value);
            $('#sortSelectList').removeClass('show');

            // ‚úÖ G·ªçi l·∫°i render b·∫£ng v·ªõi th·ª© t·ª± m·ªõi
            currentPage = 1;
            renderSPCTTable();
        });

        // üü• ƒê√≥ng dropdown khi click ra ngo√†i
        $(document).off('click.sortClose').on('click.sortClose', function (e) {
            if (!$(e.target).closest('#sortSelectInput, #sortSelectList').length) {
                $('#sortSelectList').removeClass('show');
            }
        });


        // L·∫Øng nghe s·ª± ki·ªán thay ƒë·ªïi
        $(document).on('input', '.input-slt, .input-giaban', function () {
            const $input = $(this);
            $input.addClass('changed'); // ƒë√°nh d·∫•u l√† c√≥ thay ƒë·ªïi
        });

        // Khi g√µ
        $(document).on('input', '.input-giaban', function () {
            const val = Number($(this).val().replace(/[^\d]/g, '') || 0);
            $(this).attr('data-raw', val);
        });

        // Khi blur
        $(document).on('blur', '.input-giaban', function () {
            const val = Number($(this).val().replace(/[^\d]/g, '') || 0);
            $(this).attr('data-raw', val);
        });

        // C·∫≠p nh·∫≠t h√†ng lo·∫°t
        $(document).on('click', '#btnBulkUpdateSPCT', async function () {

            // ‚úÖ B·∫Øt bu·ªôc ƒë·ªìng b·ªô l·∫°i 1 l·∫ßn to√†n b·ªô gi√° tr∆∞·ªõc khi g·ª≠i
            $('.input-giaban').each(function () {
                const val = Number($(this).val().replace(/[^\d]/g, '') || 0);
                $(this).attr('data-raw', val);
            });
            const reqs = [];
            $('.spct-checkbox:checked').each(function () {
                const id = $(this).data('id');
                const soLuongTon = parseInt($(`.input-slt[data-id="${id}"]`).val() || 0);
                const giaBan = Number($(`.input-giaban[data-id="${id}"]`).attr('data-raw') || 0);


                reqs.push({
                    id,
                    soLuongTon,
                    giaBan,
                    ...buildAuditFields(false)
                });
            });
            if (reqs.length === 0) {
                showToast('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m ƒë·ªÉ c·∫≠p nh·∫≠t!');
                return;
            }
            if (!confirm(`X√°c nh·∫≠n c·∫≠p nh·∫≠t ${reqs.length} s·∫£n ph·∫©m chi ti·∫øt?`)) return;
            try {
                await axios.put('/api/san-pham-chi-tiet/bulk-update', reqs);
                showToast('‚úÖ ƒê√£ c·∫≠p nh·∫≠t th√†nh c√¥ng!');
                loadSPCTData(PRODUCT_ID || null);
            } catch (err) {
                console.error(err);
                showToast('‚ùå L·ªói khi c·∫≠p nh·∫≠t!');
            }
        });

        // ‚úÖ Khi click checkbox t·ª´ng d√≤ng
        // ‚úÖ Tick ch·ªçn ƒë·ªÉ ch·ªânh, b·ªè tick ƒë·ªÉ format l·∫°i
        $(document).on('change', '.spct-checkbox', function () {
            const id = $(this).data('id');
            const checked = $(this).is(':checked');
            const $inputSLT = $(`.input-slt[data-id="${id}"]`);
            const $inputGia = $(`.input-giaban[data-id="${id}"]`);

            if (checked) {
                // üü¢ Cho nh·∫≠p ‚Äî hi·ªÉn th·ªã s·ªë th√¥
                const rawVal = String($inputGia.attr('data-raw') || $inputGia.val().replace(/[^\d]/g, '') || 0);
                $inputGia.val(rawVal).prop('readonly', false).addClass('editable');
                $inputSLT.prop('readonly', false).addClass('editable');
            } else {
                // üîµ Khi b·ªè tick ‚Äî l∆∞u l·∫°i gi√° m·ªõi, format v√† kh√≥a l·∫°i
                const newRaw = Number($inputGia.val().replace(/[^\d]/g, '') || 0);
                $inputGia.attr('data-raw', newRaw);
                $inputGia.val(formatVnd(newRaw)).prop('readonly', true).removeClass('editable');
                $inputSLT.prop('readonly', true).removeClass('editable');
            }
            // ‚úÖ Highlight d√≤ng khi tick
            const $row = $(`tr.spct-row[data-id="${id}"]`);
            if (checked) $row.addClass('selected');
            else $row.removeClass('selected');

        });

        // üü¢ Khi ng∆∞·ªùi d√πng nh·∫≠p v√†o √¥ Gi√° b√°n ‚Äî c·∫≠p nh·∫≠t ngay data-raw ƒë·ªÉ ƒë·∫£m b·∫£o g·ª≠i ƒë√∫ng gi√° m·ªõi
        $(document).on('input', '.input-giaban', function () {
            const val = Number($(this).val().replace(/[^\d]/g, '') || 0);
            $(this).attr('data-raw', val);
        });

        // ‚úÖ Tick ch·ªçn t·∫•t c·∫£ (phi√™n b·∫£n m·ªõi)
        $(document).off('change.selectAllSPCT').on('change.selectAllSPCT', '#selectAllSPCT', function () {
            const isChecked = $(this).is(':checked');
            const $checkboxes = $('.spct-checkbox');

            // NgƒÉn trigger ch·ªìng ch√©o: b·ªè trigger('change'), ch·ªâ ƒë·ªïi tr·∫°ng th√°i v√† x·ª≠ l√Ω th·ªß c√¥ng
            $checkboxes.prop('checked', isChecked);

            $checkboxes.each(function () {
                const id = $(this).data('id');
                const $inputSLT = $(`.input-slt[data-id="${id}"]`);
                const $inputGia = $(`.input-giaban[data-id="${id}"]`);

                if (isChecked) {
                    // ‚úÖ B·ªè format ƒë·ªÉ nh·∫≠p th√¥
                    const rawVal = String($inputGia.attr('data-raw') || $inputGia.val().replace(/[^\d]/g, '') || 0);
                    $inputGia.val(rawVal).prop('readonly', false).addClass('editable');
                    $inputSLT.prop('readonly', false).addClass('editable');
                } else {
                    // ‚úÖ Reformat l·∫°i
                    const newRaw = Number($inputGia.val().replace(/[^\d]/g, '') || 0);
                    $inputGia.attr('data-raw', newRaw);
                    $inputGia.val(formatVnd(newRaw)).prop('readonly', true).removeClass('editable');
                    $inputSLT.prop('readonly', true).removeClass('editable');
                }
            });
        });

        // ‚úÖ ƒê·ªìng b·ªô gi√° tr·ªã gi·ªØa c√°c d√≤ng ƒë∆∞·ª£c ch·ªçn
        $(document).on('input', '.input-slt, .input-giaban', function () {
            const $this = $(this);
            const val = $this.val();
            const cls = $this.hasClass('input-slt') ? '.input-slt' : '.input-giaban';

            // Ch·ªâ ch·∫°y n·∫øu d√≤ng hi·ªán t·∫°i ƒëang ƒë∆∞·ª£c tick
            const id = $this.data('id');
            const isChecked = $(`.spct-checkbox[data-id="${id}"]`).is(':checked');
            if (!isChecked) return;

            // L·∫∑p qua c√°c d√≤ng kh√°c ƒë√£ tick ƒë·ªÉ ƒë·ªìng b·ªô
            $('.spct-checkbox:checked').each(function () {
                const otherId = $(this).data('id');
                if (otherId !== id) {
                    $(`${cls}[data-id="${otherId}"]`).val(val);
                }
            });
        });

        // M·ªü popup s·ª≠a t·ª´ n√∫t "S·ª≠a"



        // üîÅ CHUY·ªÇN ƒê·ªîI TR·∫†NG TH√ÅI SPCT
        $(document).on('click', '.btn-toggle-status', async function () {
            const id = $(this).data('id');
            const currentStatus = Number($(this).data('status'));
            const newStatus = currentStatus === 1 ? 0 : 1;

            const confirmMsg = currentStatus === 1
                ? '‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën NG·ª™NG kinh doanh s·∫£n ph·∫©m n√†y kh√¥ng?'
                : '‚úÖ B·∫°n c√≥ mu·ªën KINH DOANH L·∫†I s·∫£n ph·∫©m n√†y kh√¥ng?';

            if (!confirm(confirmMsg)) return;

            try {
                const body = [{
                    id: id,
                    trangThai: newStatus
                }];

                await axios.put('/api/san-pham-chi-tiet/bulk-update', body);

                showToast('‚úÖ C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng!');
                await loadSPCTData(PRODUCT_ID || null);
            } catch (err) {
                console.error('‚ùå L·ªói khi c·∫≠p nh·∫≠t tr·∫°ng th√°i:', err);
                showToast('‚ùå Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i. Vui l√≤ng th·ª≠ l·∫°i!');
            }
        });
        // üü¢ Khi nh·∫•n n√∫t S·ª≠a
        // üü¢ Khi nh·∫•n n√∫t S·ª≠a
        // ‚ö° Khi nh·∫•n n√∫t "S·ª≠a" ch·ªâ ƒë·ªÉ m·ªü popup
        // ‚ö° Khi nh·∫•n n√∫t "S·ª≠a" ‚Äì m·ªü popup v√† t·ª± ƒë·ªông l·∫•y d·ªØ li·ªáu t·ª´ API
        $(document).off('click.btnEdit').on('click.btnEdit', '.btn-edit', async function (e) {
            e.preventDefault();

            const spId = $(this).data('sp-id');
            console.log('üü¢ Xem chi ti·∫øt s·∫£n ph·∫©m ID:', spId);

            const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('spctModal'));
            modal.show();

            // Reset form
            $('#spct-form')[0].reset();
            $('#preview-container').html('<p class="text-muted fst-italic">ƒêang t·∫£i d·ªØ li·ªáu...</p>');

            try {
                const res = await axios.get(`/api/san-pham-chi-tiet/by-san-pham?sanPhamId=${spId}`);
                const list = res.data || [];

                if (!Array.isArray(list) || list.length === 0) {
                    $('#preview-container').html('<p class="text-muted fst-italic">Kh√¥ng c√≥ bi·∫øn th·ªÉ n√†o.</p>');
                    showToast('Kh√¥ng t√¨m th·∫•y bi·∫øn th·ªÉ n√†o!', 'warning');
                    return;
                }

                const spct = list[0]; // L·∫•y bi·∫øn th·ªÉ ƒë·∫ßu ti√™n
                console.log('üì¶ SPCT:', spct);

                // G√°n d·ªØ li·ªáu v√†o form
                $('#maSPCT').val(spct.maSpct);
                $('#maSanPham').val(spct.maSanPham);
                $('#tenSanPham').val(spct.tenSanPham);
                $('#tenMau').val(spct.tenMau);
                $('#tenKichCo').val(spct.tenKichCo);
                $('#giaBan').val(Number(spct.giaBan).toLocaleString('vi-VN') + ' ‚Ç´');
                $('#soLuongTon').val(spct.soLuongTon);
                $('#trangThai').val(spct.trangThai === 1 ? 'ƒêang kinh doanh' : 'Ng·ª´ng kinh doanh');
                $('#nguoiTao').val(spct.nguoiTao);
                $('#nguoiCapNhat').val(spct.nguoiCapNhat);

                const fmtDate = d => new Date(d).toLocaleString('vi-VN', { hour12: false });
                $('#ngayTao').val(fmtDate(spct.ngayTao));
                $('#ngayCapNhat').val(fmtDate(spct.ngayCapNhat));

                // ·∫¢nh b√¨a
                const $preview = $('#preview-container').empty();
                if (spct.anhBiaUrl) {
                    $preview.html(`
                <img src="${spct.anhBiaUrl}" class="rounded shadow-sm"
                     style="width:100%;height:220px;object-fit:cover">
            `);
                } else {
                    $preview.html('<p class="text-muted fst-italic">Ch∆∞a c√≥ ·∫£nh b√¨a</p>');
                }

            } catch (err) {
                console.error('‚ùå L·ªói API:', err);
                $('#preview-container').html('<p class="text-danger">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu!</p>');
                showToast('‚ùå L·ªói khi t·∫£i d·ªØ li·ªáu!', 'error');
            }
        });





        // üñºÔ∏è H√†m ph·ª• ƒë·ªÉ load ·∫£nh t·ª´ API
        // üñºÔ∏è H√†m ph·ª• ƒë·ªÉ load ·∫£nh t·ª´ API (phi√™n b·∫£n chu·∫©n)
        async function loadImagesForSPCT(spctId) {
            if (!spctId) {
                console.warn('‚ö†Ô∏è Kh√¥ng c√≥ spctId ƒë·ªÉ t·∫£i ·∫£nh!');
                $preview.html('<p class="text-muted">Kh√¥ng t√¨m th·∫•y m√£ s·∫£n ph·∫©m chi ti·∫øt.</p>');
                return;
            }

            try {
                $preview.html('<p class="text-muted">ƒêang t·∫£i ·∫£nh...</p>');
                const res = await axios.get(API.IMGS_BY_SPCT(spctId));
                console.log('üì¶ API tr·∫£ v·ªÅ:', res.data);

                // Chu·∫©n h√≥a m·∫£ng ·∫£nh tr·∫£ v·ªÅ
                let imgs = [];
                if (Array.isArray(res.data)) imgs = res.data;
                else if (Array.isArray(res.data?.data)) imgs = res.data.data;
                else if (Array.isArray(res.data?.images)) imgs = res.data.images;

                $preview.empty();

                if (!imgs.length) {
                    $preview.html('<p class="text-muted fst-italic">Ch∆∞a c√≥ ·∫£nh n√†o cho bi·∫øn th·ªÉ n√†y.</p>');
                    return;
                }

                imgs.forEach(img => {
                    const isCover = img.laAnhBia ? 'cover' : '';
                    $preview.append(`
                <div class="image-box ${isCover}" data-id="${img.id}">
                    <img src="${img.duongDan || '/img/no-image.png'}" alt="${img.tenTapTin || '·∫¢nh'}"
                         onerror="this.src='/img/no-image.png'">
                    <div class="image-actions">
                        <button class="btn btn-sm btn-outline-success btn-set-cover"
                                data-id="${img.id}" title="ƒê·∫∑t l√†m ·∫£nh b√¨a">
                            <i class="fas fa-star"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger btn-delete-img"
                                data-id="${img.id}" title="X√≥a ·∫£nh">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `);
                });

            } catch (err) {
                console.error('‚ùå L·ªói t·∫£i ·∫£nh:', err);
                showToast('‚ùå Kh√¥ng th·ªÉ t·∫£i ·∫£nh s·∫£n ph·∫©m chi ti·∫øt!', 'error');
                $preview.html('<p class="text-danger">Kh√¥ng th·ªÉ t·∫£i ·∫£nh. Ki·ªÉm tra l·∫°i API ho·∫∑c k·∫øt n·ªëi!</p>');
            }
        }





        /* =====================================================
        * üöÄ KH·ªûI T·∫†O TRANG (INIT)
        * ===================================================== */
        async function init() {
            try {
                console.log('üöÄ Kh·ªüi t·∫°o trang Qu·∫£n l√Ω S·∫£n ph·∫©m Chi ti·∫øt.');
                // 2Ô∏è‚É£ Hi·ªÉn th·ªã skeleton loading b·∫£ng tr∆∞·ªõc khi d·ªØ li·ªáu ƒë∆∞·ª£c t·∫£i
                showSkeleton('#spctTable', 8, 11);
                // // 3Ô∏è‚É£ T·∫£i d·ªØ li·ªáu dropdown (S·∫£n ph·∫©m / M√†u s·∫Øc / K√≠ch c·ª°)
                // await loadDropdownData();
                // 4Ô∏è‚É£ T·∫£i danh s√°ch s·∫£n ph·∫©m chi ti·∫øt (theo s·∫£n ph·∫©m n·∫øu c√≥)
                console.log('üîé PRODUCT_ID =', PRODUCT_ID);
                await loadSPCTData(PRODUCT_ID || null);
                // // 5Ô∏è‚É£ Reset v√πng upload ·∫£nh (tr√°nh b·ªã g√°n tr·∫°ng th√°i c≈©)
                // clearUploadState();
                // $upload.removeClass('has-images');
                // 6Ô∏è‚É£ G√°n s·∫Øp x·∫øp m·∫∑c ƒë·ªãnh
                $('#sortSelectInput').data('value', 'date-desc').val('Ng√†y c·∫≠p nh·∫≠t m·ªõi nh·∫•t');
                console.log('‚úÖ Trang Qu·∫£n l√Ω SPCT ƒë√£ kh·ªüi t·∫°o xong.');
            } catch (err) {
                console.error('‚ùå L·ªói khi kh·ªüi t·∫°o trang:', err);
                showToast('‚ùå Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu kh·ªüi t·∫°o. Vui l√≤ng th·ª≠ l·∫°i ho·∫∑c ki·ªÉm tra k·∫øt n·ªëi!');
            }
        }

        // üëâ G·ªçi h√†m init() khi DOM ƒë√£ s·∫µn s√†ng
        $(document).ready(() => {
            init();
        });

    </script>
</div>


</body>

</html>